# Vue ç»„ä»¶å•å…ƒæµ‹è¯•æ–‡æ¡£

## ğŸ“Š æµ‹è¯•æ¦‚è§ˆ

æœ¬ç›®å½•åŒ…å«äº† `@ldesign/http-vue` åŒ…ä¸­æ‰€æœ‰ç»„ä»¶çš„å•å…ƒæµ‹è¯•ã€‚

### æµ‹è¯•æ–‡ä»¶åˆ—è¡¨

| ç»„ä»¶ | æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•ç”¨ä¾‹æ•° | è¦†ç›–èŒƒå›´ |
|------|---------|-----------|---------|
| HttpProvider | `HttpProvider.test.ts` | 30+ | åŸºç¡€åŠŸèƒ½ã€é…ç½®ç®¡ç†ã€åµŒå¥—Providerã€DevToolsã€è¾¹ç•Œæƒ…å†µ |
| HttpLoader | `HttpLoader.test.ts` | 60+ | HTTPæ–¹æ³•ã€çŠ¶æ€ç®¡ç†ã€è½®è¯¢ã€ç¼“å­˜ã€é‡è¯•ã€æ•°æ®è½¬æ¢ |
| HttpError | `HttpError.test.ts` | 50+ | é”™è¯¯ç±»å‹è¯†åˆ«ã€é‡è¯•åŠŸèƒ½ã€è¯¦æƒ…å±•ç¤ºã€è‡ªå®šä¹‰æ ·å¼ |
| HttpRetry | `HttpRetry.test.ts` | 45+ | é‡è¯•çŠ¶æ€ã€è‡ªåŠ¨/æ‰‹åŠ¨é‡è¯•ã€å€’è®¡æ—¶ã€è¿›åº¦æ¡ã€å†å²è®°å½• |
| HttpProgress | `HttpProgress.test.ts` | 70+ | è¿›åº¦ç±»å‹ã€çŠ¶æ€ã€æ–‡ä»¶ä¿¡æ¯ã€é€Ÿåº¦ã€æ—¶é—´ã€æ§åˆ¶æŒ‰é’® |

**æ€»è®¡ï¼š250+ æµ‹è¯•ç”¨ä¾‹**

## ğŸ¯ æµ‹è¯•è¦†ç›–çš„åŠŸèƒ½ç‚¹

### 1. HttpProvider ç»„ä»¶

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… åŸºç¡€æ¸²æŸ“å’Œå­ç»„ä»¶ä¼ é€’
- âœ… HTTP å®¢æˆ·ç«¯æ³¨å…¥
- âœ… é…ç½®å¯¹è±¡ç®¡ç†
- âœ… å“åº”å¼é…ç½®æ›´æ–°

#### é«˜çº§åŠŸèƒ½
- âœ… åµŒå¥— Provider æ”¯æŒ
- âœ… é…ç½®ç»§æ‰¿æœºåˆ¶
- âœ… DevTools é›†æˆ
- âœ… è¾¹ç•Œæƒ…å†µå¤„ç†ï¼ˆnull/undefinedï¼‰

### 2. HttpLoader ç»„ä»¶

#### åŸºç¡€åŠŸèƒ½
- âœ… å››ç§çŠ¶æ€ï¼šloadingã€successã€errorã€empty
- âœ… æ‰€æœ‰ HTTP æ–¹æ³•ï¼ˆGETã€POSTã€PUTã€DELETEç­‰ï¼‰
- âœ… æŸ¥è¯¢å‚æ•°å’Œè¯·æ±‚æ•°æ®

#### é«˜çº§åŠŸèƒ½
- âœ… å“åº”å¼å‚æ•°å˜åŒ–è‡ªåŠ¨é‡æ–°è¯·æ±‚
- âœ… è½®è¯¢åŠŸèƒ½å’Œå®šæ—¶å™¨ç®¡ç†
- âœ… ç¼“å­˜é…ç½®
- âœ… é‡è¯•æœºåˆ¶
- âœ… æ•°æ®è½¬æ¢å‡½æ•°
- âœ… æš´éœ²çš„æ–¹æ³•ï¼ˆrefreshã€cancelï¼‰
- âœ… äº‹ä»¶å‘å°„ï¼ˆsuccessã€errorï¼‰

### 3. HttpError ç»„ä»¶

#### é”™è¯¯è¯†åˆ«
- âœ… ç½‘ç»œé”™è¯¯ï¼ˆNetworkErrorï¼‰
- âœ… è¶…æ—¶é”™è¯¯ï¼ˆTimeoutErrorï¼‰
- âœ… HTTP çŠ¶æ€ç ï¼ˆ401ã€403ã€404ã€5xxï¼‰
- âœ… å–æ¶ˆè¯·æ±‚é”™è¯¯

#### UI åŠŸèƒ½
- âœ… é‡è¯•æŒ‰é’®å’Œäº‹ä»¶
- âœ… é‡è¯•æ¬¡æ•°æ˜¾ç¤º
- âœ… é”™è¯¯è¯¦æƒ…æŠ˜å /å±•å¼€
- âœ… é”™è¯¯å †æ ˆæ˜¾ç¤º
- âœ… è”ç³»æ”¯æŒæŒ‰é’®
- âœ… è‡ªå®šä¹‰æ ·å¼å’Œæ’æ§½

### 4. HttpRetry ç»„ä»¶

#### é‡è¯•çŠ¶æ€
- âœ… 6ç§çŠ¶æ€ï¼šidleã€retryingã€waitingã€successã€failedã€cancelled
- âœ… çŠ¶æ€å›¾æ ‡å’Œæ–‡æœ¬

#### é‡è¯•æ§åˆ¶
- âœ… è‡ªåŠ¨é‡è¯•æ¨¡å¼
- âœ… æ‰‹åŠ¨é‡è¯•æ¨¡å¼
- âœ… å–æ¶ˆé‡è¯•åŠŸèƒ½
- âœ… é‡è¯•æŒ‰é’®çŠ¶æ€ç®¡ç†

#### é«˜çº§åŠŸèƒ½
- âœ… å€’è®¡æ—¶æ˜¾ç¤º
- âœ… è¿›åº¦æ¡å¯è§†åŒ–
- âœ… æŒ‡æ•°é€€é¿ç®—æ³•
- âœ… é‡è¯•å†å²è®°å½•
- âœ… å®šæ—¶å™¨è‡ªåŠ¨æ¸…ç†

### 5. HttpProgress ç»„ä»¶

#### è¿›åº¦å±•ç¤º
- âœ… ä¸‰ç§ç±»å‹ï¼šlineã€circleã€dashboard
- âœ… äº”ç§çŠ¶æ€ï¼šnormalã€activeã€successã€errorã€warning
- âœ… è¿›åº¦ç™¾åˆ†æ¯”æ˜¾ç¤ºå’Œé™åˆ¶

#### æ–‡ä»¶ä¿¡æ¯
- âœ… æ–‡ä»¶åæ˜¾ç¤º
- âœ… æ–‡ä»¶å¤§å°æ ¼å¼åŒ–
- âœ… ä¼ è¾“é€Ÿåº¦æ˜¾ç¤º
- âœ… å‰©ä½™æ—¶é—´è®¡ç®—

#### äº¤äº’æ§åˆ¶
- âœ… æš‚åœ/ç»§ç»­æŒ‰é’®
- âœ… å–æ¶ˆæŒ‰é’®
- âœ… äº‹ä»¶å‘å°„ï¼ˆpauseã€resumeã€cancelï¼‰

#### æ ·å¼åŠŸèƒ½
- âœ… å•è‰²/æ¸å˜è‰²/å‡½æ•°é¢œè‰²
- âœ… åŠ¨ç”»æ•ˆæœ
- âœ… æ¡çº¹æ•ˆæœ

## ğŸ› ï¸ å·¥å…·å‡½æ•°æµ‹è¯•

### HttpError å·¥å…·
- âœ… `getErrorTypeConfig()` - é”™è¯¯ç±»å‹è¯†åˆ«

### HttpRetry å·¥å…·
- âœ… `calculateRetryDelay()` - å»¶è¿Ÿè®¡ç®—ï¼ˆæ”¯æŒæŒ‡æ•°é€€é¿ï¼‰

### HttpProgress å·¥å…·
- âœ… `formatFileSize()` - æ–‡ä»¶å¤§å°æ ¼å¼åŒ–ï¼ˆBã€KBã€MBã€GBã€TBï¼‰
- âœ… `formatSpeed()` - é€Ÿåº¦æ ¼å¼åŒ–
- âœ… `formatProgressTime()` - æ—¶é—´æ ¼å¼åŒ–ï¼ˆç§’ã€åˆ†ã€å°æ—¶ã€å¤©ï¼‰
- âœ… `getProgressColor()` - é¢œè‰²è·å–ï¼ˆå•è‰²ã€æ•°ç»„ã€å‡½æ•°ã€çŠ¶æ€ï¼‰
- âœ… `getCirclePath()` - SVG è·¯å¾„è®¡ç®—

## ğŸ§ª æµ‹è¯•æŠ€æœ¯æ ˆ

- **æµ‹è¯•æ¡†æ¶**: Vitest
- **Vue æµ‹è¯•å·¥å…·**: @vue/test-utils
- **Mock å·¥å…·**: vi (Vitest)
- **æ—¶é—´æ¨¡æ‹Ÿ**: vi.useFakeTimers()
- **å¼‚æ­¥å¤„ç†**: flushPromises(), nextTick()

## ğŸ“ æµ‹è¯•æ¨¡å¼

### 1. å•å…ƒæµ‹è¯•
æ¯ä¸ªç»„ä»¶éƒ½æœ‰ç‹¬ç«‹çš„æµ‹è¯•æ–‡ä»¶ï¼Œæµ‹è¯•ç»„ä»¶çš„æ‰€æœ‰åŠŸèƒ½ç‚¹ã€‚

### 2. é›†æˆæµ‹è¯•
æµ‹è¯•ç»„ä»¶ä¹‹é—´çš„äº¤äº’ï¼Œå¦‚ Provider ä¸å­ç»„ä»¶çš„é€šä¿¡ã€‚

### 3. è¾¹ç•Œæµ‹è¯•
æµ‹è¯•å¼‚å¸¸è¾“å…¥å’Œæç«¯æƒ…å†µï¼š
- null/undefined å€¼
- è´Ÿæ•°/è¶…å¤§æ•°å€¼
- ç©ºå­—ç¬¦ä¸²
- æ— æ•ˆé…ç½®

### 4. äº‹ä»¶æµ‹è¯•
éªŒè¯æ‰€æœ‰ç»„ä»¶äº‹ä»¶çš„æ­£ç¡®å‘å°„ï¼š
- successã€error äº‹ä»¶
- retryã€cancel äº‹ä»¶
- pauseã€resume äº‹ä»¶

## ğŸš€ è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œç»„ä»¶æµ‹è¯•
npm test -- tests/unit/vue/components

# è¿è¡Œå•ä¸ªç»„ä»¶æµ‹è¯•
npm test -- tests/unit/vue/components/HttpProvider.test.ts

# æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡
npm test -- --coverage

# ç›‘å¬æ¨¡å¼
npm test -- --watch
```

## ğŸ“ˆ æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ |
|------|------|------|
| è¯­å¥è¦†ç›–ç‡ | - | 90%+ |
| åˆ†æ”¯è¦†ç›–ç‡ | - | 85%+ |
| å‡½æ•°è¦†ç›–ç‡ | - | 90%+ |
| è¡Œè¦†ç›–ç‡ | - | 90%+ |

## ğŸ”§ Mock ç­–ç•¥

### HttpClient Mock
æ‰€æœ‰æµ‹è¯•ä½¿ç”¨ç»Ÿä¸€çš„ `createMockClient()` å‡½æ•°åˆ›å»ºæ¨¡æ‹Ÿå®¢æˆ·ç«¯ï¼ŒåŒ…å«ï¼š
- æ‰€æœ‰ HTTP æ–¹æ³•ï¼ˆrequestã€getã€postç­‰ï¼‰
- æ‹¦æˆªå™¨æ¥å£
- ç¼“å­˜å’Œå¹¶å‘æ§åˆ¶æ–¹æ³•

### å®šæ—¶å™¨ Mock
ä½¿ç”¨ `vi.useFakeTimers()` æ§åˆ¶æ—¶é—´æµé€ï¼Œç”¨äºæµ‹è¯•ï¼š
- è½®è¯¢åŠŸèƒ½
- å€’è®¡æ—¶
- å»¶è¿Ÿé‡è¯•

## ğŸ“Œ æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•ç»„ç»‡
```typescript
describe('ComponentName', () => {
  describe('åŸºç¡€åŠŸèƒ½', () => {
    it('åº”è¯¥...', () => {})
  })
  
  describe('é«˜çº§åŠŸèƒ½', () => {
    it('åº”è¯¥...', () => {})
  })
  
  describe('è¾¹ç•Œæƒ…å†µ', () => {
    it('åº”è¯¥...', () => {})
  })
})
```

### 2. æ¸…ç†æ“ä½œ
```typescript
beforeEach(() => {
  // è®¾ç½®
})

afterEach(() => {
  vi.clearAllMocks()
  vi.useRealTimers()
})
```

### 3. å¼‚æ­¥å¤„ç†
```typescript
await flushPromises()  // ç­‰å¾…æ‰€æœ‰ Promise å®Œæˆ
await nextTick()       // ç­‰å¾… DOM æ›´æ–°
```

### 4. äº‹ä»¶æ–­è¨€
```typescript
expect(wrapper.emitted('eventName')).toBeTruthy()
expect(wrapper.emitted('eventName')![0]).toEqual([expectedData])
```

## ğŸ› å·²çŸ¥é—®é¢˜

ç›®å‰æ²¡æœ‰å·²çŸ¥é—®é¢˜ã€‚

## ğŸ“š å‚è€ƒèµ„æ–™

- [Vitest æ–‡æ¡£](https://vitest.dev/)
- [Vue Test Utils æ–‡æ¡£](https://test-utils.vuejs.org/)
- [Vue 3 æµ‹è¯•æŒ‡å—](https://vuejs.org/guide/scaling-up/testing.html)

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

- [ ] æ·»åŠ  E2E æµ‹è¯•
- [ ] é›†æˆ CI/CD æµ‹è¯•æµç¨‹
- [ ] æ·»åŠ è§†è§‰å›å½’æµ‹è¯•
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] å¯è®¿é—®æ€§æµ‹è¯•ï¼ˆa11yï¼‰

---

**æœ€åæ›´æ–°**: 2025-11-25
**ç»´æŠ¤è€…**: @ldesign/http Team