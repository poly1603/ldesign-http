"use strict";function e(e,t){return async(r,n)=>await e(r)?t(r,n):n()}function t(e){return async(t,r)=>{const n=Date.now();try{return await r()}finally{const r=Date.now()-n;e?.(r,t)}}}function r(e){return async(t,r)=>{let n=t;for(const t of e)n=await t(n);return r()}}exports.MiddlewareBuilder=class{constructor(){this.middlewares=[]}use(e){return this.middlewares.push(e),this}when(t,r){return this.middlewares.push(e(t,r)),this}timing(e){return this.middlewares.push(t(e)),this}pipe(...e){return this.middlewares.push(r(e)),this}build(){const e=this.middlewares;return async(t,r)=>async function t(n,s){return n>=e.length?r():(0,e[n])(s,()=>t(n+1,s))}(0,t)}clear(){return this.middlewares=[],this}get size(){return this.middlewares.length}},exports.composeErrorMiddleware=function(e){return Array.isArray(e)&&0!==e.length?async t=>async function t(r,n){return r>=e.length?n:(0,e[r])(n,e=>t(r+1,e))}(0,t):e=>e},exports.composeRequestMiddleware=function(e){return Array.isArray(e)&&0!==e.length?async t=>async function t(r,n){return r>=e.length?n:(0,e[r])(n,()=>t(r+1,n))}(0,t):e=>e},exports.composeResponseMiddleware=function(e){return Array.isArray(e)&&0!==e.length?async t=>async function t(r,n){return r>=e.length?n:(0,e[r])(n,()=>t(r+1,n))}(0,t):e=>e},exports.createCacheMiddleware=function(e){const{ttl:t=6e4,keyGenerator:r,middleware:n}=e,s=new Map;return async(e,a)=>{const i=r(e),o=Date.now(),c=s.get(i);if(c&&c.expiry>o)return c.value;const u=await n(e,a);return s.set(i,{value:u,expiry:o+t}),u}},exports.createConditionalMiddleware=e,exports.createMethodMatchMiddleware=function(t,r){const n=new Set(t.map(e=>e.toUpperCase()));return e(e=>{const t=(e.method||"GET").toUpperCase();return n.has(t)},r)},exports.createPathMatchMiddleware=function(t,r){const n="string"==typeof t?e=>e.includes(t):e=>t.test(e);return e(e=>{const t=e.url||"";return n(t)},r)},exports.createPipelineMiddleware=r,exports.createRetryMiddleware=function(e){const{maxAttempts:t=3,delay:r=1e3,shouldRetry:n=()=>!0,middleware:s}=e;return async(e,a)=>{let i;for(let o=1;o<=t;o++)try{return await s(e,a)}catch(e){if(i=e,!(o<t&&n(e,o)))throw e;await new Promise(e=>setTimeout(e,r*o))}throw i}},exports.createTimingMiddleware=t;
//# sourceMappingURL=middleware.cjs.map
