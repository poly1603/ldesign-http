"use strict";exports.authInterceptor=function(e={}){const{tokenKey:t="accessToken",headerName:r="Authorization",tokenPrefix:s="Bearer"}=e;return{request:e=>{const o=localStorage.getItem(t);return o&&(e.headers=e.headers||{},e.headers[r]=`${s} ${o}`),e},responseError:e=>(401===e.response?.status&&localStorage.removeItem(t),e)}},exports.cacheInterceptor=function(e={}){const{enabled:t=!0,ttl:r=3e5,methods:s=["GET"]}=e;return{request:e=>{if(!e.cache){const o=e.method?.toUpperCase()||"GET",n=t&&s.includes(o);e.cache={enabled:n,ttl:r}}return e}}},exports.contentTypeInterceptor=e=>(e.data&&!e.headers?.["Content-Type"]&&!e.headers?.["content-type"]&&"object"==typeof e.data&&!(e.data instanceof FormData)&&(e.headers={...e.headers,"Content-Type":"application/json"}),e),exports.createAuthInterceptor=function(e){return t=>{const r=e();return r&&(t.headers={...t.headers,Authorization:`Bearer ${r}`}),t}},exports.createBaseURLInterceptor=function(e){return t=>(!t.baseURL&&!t.url?.startsWith("http")&&(t.baseURL=e),t)},exports.createDataTransformInterceptor=function(e){return t=>({...t,data:e(t.data)})},exports.createResponseTimeInterceptor=function(){const e=new Map;return{request:t=>{const r=t.headers?.["X-Request-ID"]||Math.random().toString(36);return e.set(r,Date.now()),t.headers={...t.headers,"X-Request-ID":r},t},response:t=>{const r=t.config.headers?.["X-Request-ID"];if(r&&e.has(r)){const t=e.get(r);Date.now();e.delete(r)}return t}}},exports.createRetryInterceptor=function(e=3,t=1e3,r){return async s=>{const o=s.config;if(!o||!(r?r(s):s.isNetworkError||s.isTimeoutError))return s;const n=o.__retryCount||0;return n>=e||(o.__retryCount=n+1,await new Promise(e=>setTimeout(e,t*2**n))),s}},exports.errorHandlingInterceptor=function(e={}){const{customHandler:t}=e;return{responseError:e=>t?t(e):(e.isNetworkError?e.userMessage="网络连接失败，请检查网络设置":e.isTimeoutError?e.userMessage="请求超时，请重试":e.response?.status>=500?e.userMessage="服务器内部错误":e.response?.status>=400&&(e.userMessage=`请求失败 (${e.response.status})`),e)}},exports.errorLoggerInterceptor=e=>e,exports.loggingInterceptor=function(e={}){const{level:t="info",logger:r=console}=e;return{request:e=>(("info"===t||"debug"===t)&&r.log("Request:",{method:e.method,url:e.url,headers:e.headers,data:e.data}),e),response:e=>(("info"===t||"debug"===t)&&r.log("Response:",{status:e.status,data:e.data,headers:e.headers}),e),responseError:e=>(r.error("Error:",{message:e.message,config:e.config,response:e.response}),e)}},exports.requestIdInterceptor=e=>{const t=Math.random().toString(36).substring(2,15);return e.headers={...e.headers,"X-Request-ID":t},e},exports.requestLoggerInterceptor=e=>e,exports.responseLoggerInterceptor=e=>e,exports.retryInterceptor=function(e={}){const{maxAttempts:t=3,delay:r=1e3}=e;return{request:e=>(e.retry||(e.retry={maxAttempts:t,delay:r}),e)}},exports.statusCodeInterceptor=e=>{if(e.status>=400)throw new Error(`HTTP Error: ${e.status} ${e.statusText}`);return e},exports.timeoutInterceptor=function(e={}){const{timeout:t=5e3}=e;return{request:e=>(e.timeout||(e.timeout=t),e),responseError:e=>(("ECONNABORTED"===e.code||e.message?.includes("timeout"))&&(e.isTimeoutError=!0,e.message="Request timeout"),e)}},exports.timestampInterceptor=e=>{const t=Date.now();return"GET"===e.method&&(e.params={...e.params,_t:t}),e.headers={...e.headers,"X-Timestamp":t.toString()},e};
//# sourceMappingURL=common.cjs.map
