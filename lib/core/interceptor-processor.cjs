"use strict";var e=require("../interceptors/manager.cjs");class r{constructor(r){this.requestInterceptors=r?.requestInterceptors||new e.InterceptorManagerImpl,this.responseInterceptors=r?.responseInterceptors||new e.InterceptorManagerImpl,this.errorInterceptors=r?.errorInterceptors||new e.InterceptorManagerImpl}async processRequest(e){let r=e;const t=this.requestInterceptors.getInterceptors();for(const e of t)try{r=await e.fulfilled(r)}catch(r){throw e.rejected?await e.rejected(r):r}return r}async processResponse(e){let r=e;const t=this.responseInterceptors.getInterceptors();for(const e of t)try{r=await e.fulfilled(r)}catch(r){throw e.rejected?await e.rejected(r):r}return r}async processError(e){let r=e;const t=this.errorInterceptors.getInterceptors();for(const e of t)try{r=await e.fulfilled(r)}catch(e){r=e}return r}addRequestInterceptor(e,r){return this.requestInterceptors.use(e,r)}addResponseInterceptor(e,r){return this.responseInterceptors.use(e,r)}addErrorInterceptor(e,r){return this.errorInterceptors.use(e,r)}removeRequestInterceptor(e){this.requestInterceptors.eject(e)}removeResponseInterceptor(e){this.responseInterceptors.eject(e)}removeErrorInterceptor(e){this.errorInterceptors.eject(e)}clearRequestInterceptors(){this.requestInterceptors.clear()}clearResponseInterceptors(){this.responseInterceptors.clear()}clearErrorInterceptors(){this.errorInterceptors.clear()}clearAll(){this.clearRequestInterceptors(),this.clearResponseInterceptors(),this.clearErrorInterceptors()}getInterceptors(){return{request:this.requestInterceptors,response:this.responseInterceptors,error:this.errorInterceptors}}getStats(){return{request:this.requestInterceptors.getInterceptors().length,response:this.responseInterceptors.getInterceptors().length,error:this.errorInterceptors.getInterceptors().length}}createChain(e,r){return new Promise((t,s)=>{(async()=>{try{const o=await this.processRequest(e);let n;try{n=await r(o)}catch(e){const r=await this.processError(e);return void s(r)}const c=await this.processResponse(n);t(c)}catch(e){const r=await this.processError(e);s(r)}})()})}clone(){const e=new r;return this.requestInterceptors.getInterceptors().forEach(r=>{e.addRequestInterceptor(r.fulfilled,r.rejected)}),this.responseInterceptors.getInterceptors().forEach(r=>{e.addResponseInterceptor(r.fulfilled,r.rejected)}),this.errorInterceptors.getInterceptors().forEach(r=>{e.addErrorInterceptor(r.fulfilled,r.rejected)}),e}}exports.InterceptorProcessor=r,exports.composeInterceptors=function(...e){return async r=>{let t=r;for(const r of e)t=await r(t);return t}},exports.conditionalInterceptor=function(e,r){return async t=>await e(t)?r(t):t},exports.createCacheInterceptor=function(e,r){return{request:t=>{const s=r(t),o=e.get(s);return o&&(t.fromCache=!0,t.cachedResponse=o),t},response:t=>{if(!t.config.fromCache){const s=r(t.config);e.set(s,t)}return t}}},exports.createInterceptorProcessor=function(e){return new r(e)},exports.createLoggingInterceptor=function(e=console){return{request:r=>(e.log(`[Request] ${r.method} ${r.url}`,r),r),response:r=>(e.log(`[Response] ${r.config.method} ${r.config.url} - ${r.status}`,r),r),error:async r=>{throw e.error(`[Error] ${r.config?.method} ${r.config?.url} - ${r.message}`,r),r}}},exports.createRetryInterceptor=function(e=3,r=1e3,t){return async s=>{const o=s.config;if(!o||t&&!t(s))throw s;const n=(o.retryCount??0)+1;throw n>e||(o.retryCount=n,await new Promise(e=>setTimeout(e,r*n))),s}};
//# sourceMappingURL=interceptor-processor.cjs.map
