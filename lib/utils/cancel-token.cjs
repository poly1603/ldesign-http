"use strict";var e=require("./error.cjs");class t{constructor(){this.isCancelled=!1,this.promise=new Promise(e=>{this.resolvePromise=e})}cancel(e="Request cancelled"){this.isCancelled||(this.isCancelled=!0,this.reason=e,this.resolvePromise(e))}throwIfRequested(){if(this.isCancelled)throw e.ErrorHandler.createCancelError({})}}class s{constructor(){this.token=new t}cancel(e){this.token.cancel(e)}static create(){return new s}}class n extends t{constructor(e,t=`Timeout exceeded: ${e}ms`){super(),this.timeoutId=setTimeout(()=>{this.cancel(t)},e)}cancel(e="Request cancelled"){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),super.cancel(e)}reset(e){this.timeoutId&&clearTimeout(this.timeoutId),this.isCancelled||(this.timeoutId=setTimeout(()=>{this.cancel(`Timeout exceeded: ${e}ms`)},e))}}class r{constructor(...e){this.isCancelled=!1,this.tokens=e,this.promise=new Promise(e=>{this.resolvePromise=e}),this.setupListeners()}setupListeners(){this.tokens.forEach(e=>{e.isCancelled?this.handleTokenCancel(e.reason||"Request cancelled"):e.promise.then(e=>{this.handleTokenCancel(e)}).catch(()=>{})})}handleTokenCancel(e){this.isCancelled||(this.isCancelled=!0,this.reason=e,this.resolvePromise(e))}throwIfRequested(){if(this.isCancelled)throw e.ErrorHandler.createCancelError({});this.tokens.forEach(e=>{e.isCancelled&&(this.handleTokenCancel(e.reason||"Request cancelled"),this.throwIfRequested())})}}exports.CancelTokenFactory=class{static create(){return new s}static createWithTimeout(e,t){return new n(e,t)}static combine(...e){return new r(...e)}static fromAbortSignal(e){const s=new t;return e.aborted?s.cancel(e.reason||"Aborted"):e.addEventListener("abort",()=>{s.cancel(e.reason||"Aborted")},{once:!0}),s}static never(){return{isCancelled:!1,reason:void 0,promise:new Promise(()=>{}),throwIfRequested:()=>{}}}},exports.CancelTokenImpl=t,exports.CancelTokenSource=s,exports.CombinedCancelToken=r,exports.TimeoutCancelToken=n,exports.combineCancelTokens=function(...e){return new r(...e)},exports.createCancelTokenSource=function(){return s.create()},exports.createTimeoutToken=function(e,t){return new n(e,t)};
//# sourceMappingURL=cancel-token.cjs.map
