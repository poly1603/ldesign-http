"use strict";class e{constructor(e={}){this.queue=new Map,this.isOnline=!(typeof navigator<"u")||navigator.onLine,this.stats={queuedCount:0,processedCount:0,failedCount:0,successRate:1},this.config={enabled:e.enabled??!0,maxQueueSize:e.maxQueueSize??100,storageKey:e.storageKey??"http_offline_queue",persistent:e.persistent??!0,retryInterval:e.retryInterval??5e3,maxRetries:e.maxRetries??3},typeof window<"u"&&(window.addEventListener("online",this.handleOnline.bind(this)),window.addEventListener("offline",this.handleOffline.bind(this))),this.config?.persistent&&this.loadQueue()}async enqueue(e){if(!this.config?.enabled)throw new Error("Offline queue is disabled");if(this.queue.size>=this.config?.maxQueueSize)throw new Error("Offline queue is full");return new Promise((t,s)=>{const i=this.generateId(),r={id:i,config:e,timestamp:Date.now(),retries:0,resolve:t,reject:s};this.queue.set(i,r),this.stats.queuedCount++,this.config?.persistent&&this.saveQueue(),this.isOnline&&this.processQueue()})}async processQueue(){if(!this.isOnline||0===this.queue.size)return;const e=Array.from(this.queue.values());for(const t of e)try{const e=await this.executeRequest(t.config);t.resolve(e),this.queue.delete(t.id),this.stats.processedCount++}catch(e){t.retries++,t.retries>=this.config?.maxRetries&&(t.reject(e),this.queue.delete(t.id),this.stats.failedCount++)}this.updateStats(),this.config?.persistent&&this.saveQueue(),this.queue.size>0&&this.scheduleRetry()}async executeRequest(e){throw new Error("Request executor not configured")}scheduleRetry(){this.retryTimer||(this.retryTimer=setTimeout(()=>{this.retryTimer=void 0,this.processQueue()},this.config?.retryInterval))}handleOnline(){this.isOnline=!0,this.processQueue()}handleOffline(){this.isOnline=!1}saveQueue(){if(!(typeof localStorage>"u"))try{const e=Array.from(this.queue.values()).map(e=>({id:e.id,config:e.config,timestamp:e.timestamp,retries:e.retries}));localStorage.setItem(this.config?.storageKey,JSON.stringify(e))}catch(e){}}loadQueue(){if(!(typeof localStorage>"u"))try{localStorage.getItem(this.config?.storageKey)}catch(e){}}generateId(){return`offline_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}updateStats(){const e=this.stats.processedCount+this.stats.failedCount;this.stats.successRate=e>0?this.stats.processedCount/e:1}getStats(){return{...this.stats,queuedCount:this.queue.size}}clear(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=void 0),this.queue.forEach(e=>{e.reject(new Error("Queue cleared"))}),this.queue.clear(),this.config?.persistent&&typeof localStorage<"u"&&localStorage.removeItem(this.config?.storageKey)}isNetworkOnline(){return this.isOnline}destroy(){typeof window<"u"&&(window.removeEventListener("online",this.handleOnline.bind(this)),window.removeEventListener("offline",this.handleOffline.bind(this))),this.clear()}}exports.OfflineQueueManager=e,exports.createOfflineQueueManager=function(t){return new e(t)};
//# sourceMappingURL=offline.cjs.map
