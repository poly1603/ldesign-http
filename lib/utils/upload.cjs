"use strict";class e extends Error{constructor(e,t,i){super(e),this.file=t,this.code=i,this.name="FileValidationError"}}function t(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return`${Number.parseFloat((e/1024**t).toFixed(2))} ${["B","KB","MB","GB","TB"][t]}`}exports.FileValidationError=e,exports.ProgressCalculator=class{constructor(){this.startTime=Date.now(),this.lastLoaded=0,this.lastTime=Date.now(),this.speeds=[]}calculate(e,t,i){const s=Date.now(),a=s-this.lastTime,n=e-this.lastLoaded,o=a>0?n/a*1e3:0;this.speeds.push(o),this.speeds.length>10&&this.speeds.shift();const r=this.speeds.reduce((e,t)=>e+t,0)/this.speeds.length,p=r>0?(t-e)/r:0;return this.lastLoaded=e,this.lastTime=s,{loaded:e,total:t,percentage:t>0?Math.round(e/t*100):0,speed:r,timeRemaining:p,elapsed:s-this.startTime,file:i}}reset(){this.startTime=Date.now(),this.lastLoaded=0,this.lastTime=Date.now(),this.speeds=[]}},exports.createFileChunks=function(e,t){const i=[],s=Math.ceil(e.size/t);for(let a=0;a<s;a++){const s=a*t,n=Math.min(s+t,e.size),o=e.slice(s,n);i.push({index:a,chunk:o,size:o.size,start:s,end:n,fileHash:""})}return i},exports.createFilePreviewURL=function(e){return URL.createObjectURL(e)},exports.createUploadFormData=function(e,t,i){const s=new FormData,a=t.fileField||"file";return i?(s.append(a,i.chunk,e.name),s.append("chunkIndex",i.index.toString()),s.append("totalChunks",Math.ceil(e.size/(t.chunkSize||e.size)).toString()),s.append("fileHash",i.fileHash)):s.append(a,e),t.formData&&Object.entries(t.formData).forEach(([e,t])=>{s.append(e,t)}),s.append("fileName",e.name),s.append("fileSize",e.size.toString()),s.append("fileType",e.type),s},exports.formatFileSize=t,exports.generateFileHash=async function(e){const t=await e.arrayBuffer(),i=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(i)).map(e=>e.toString(16).padStart(2,"0")).join("")},exports.getFileExtension=function(e){return e.slice((e.lastIndexOf(".")-1>>>0)+2)},exports.isAudioFile=function(e){return e.type.startsWith("audio/")},exports.isDocumentFile=function(e){return["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/plain","text/csv"].includes(e.type)},exports.isImageFile=function(e){return e.type.startsWith("image/")},exports.isVideoFile=function(e){return e.type.startsWith("video/")},exports.revokeFilePreviewURL=function(e){URL.revokeObjectURL(e)},exports.validateFile=function(i,s){if(s.accept&&s.accept.length>0){const t=i.type,a=i.name.toLowerCase();if(!s.accept.some(e=>e.startsWith(".")?a.endsWith(e.toLowerCase()):!!e.includes("/")&&(t===e||t.startsWith(e.replace("*","")))))throw new e(`文件类型不被允许: ${t}`,i,"TYPE_NOT_ALLOWED")}if(s.maxSize&&i.size>s.maxSize)throw new e(`文件大小超出限制: ${t(i.size)} > ${t(s.maxSize)}`,i,"SIZE_TOO_LARGE");if(0===i.size)throw new e("文件为空",i,"INVALID_FILE")};
//# sourceMappingURL=upload.cjs.map
