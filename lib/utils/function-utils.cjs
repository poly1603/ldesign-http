"use strict";async function e(e,t={}){const{maxAttempts:n=3,delay:r=1e3,factor:i=2,maxDelay:o=3e4,jitter:u=!0,retryCondition:c=()=>!0,onRetry:s}=t;let a,l=r;for(let t=1;t<=n;t++)try{return await e()}catch(e){if(a=e,!(t<n&&c(e)))break;if(s?.(t,e),u){const e=.75+.5*Math.random();l=Math.min(l*e,o)}await new Promise(e=>setTimeout(e,l)),l=Math.min(l*i,o)}throw a}function t(e){return new Promise(t=>setTimeout(t,e))}class n{constructor(e){this.maxConcurrency=e,this.running=0,this.queue=[]}async execute(e){for(;this.running>=this.maxConcurrency;)await new Promise(e=>{this.queue.push(e)});this.running++;try{return await e()}finally{this.running--;const e=this.queue.shift();e&&e()}}async executeAll(e){return Promise.all(e.map(e=>this.execute(e)))}getRunning(){return this.running}getQueueLength(){return this.queue.length}}exports.ConcurrencyController=n,exports.concurrent=async function(e,t){return new n(t).executeAll(e)},exports.conditional=function(e,t,n){return function(...r){return e(...r)?t.apply(this,r):n?n.apply(this,r):void 0}},exports.createParallelExecutor=function(e=10){const t=new n(e);return function(e){return t.executeAll(e)}},exports.createRetryableFunction=function(t,n={}){return function(...r){return e(()=>t.apply(this,r),n)}},exports.createSerialExecutor=function(){let e=Promise.resolve();return function(t,...n){const r=e.then(()=>t(...n));return e=r.catch(()=>{}),r}},exports.defer=function(e,n=0){return async function(...r){return await t(n),e(...r)}},exports.memoize=function(e,t={}){const{maxSize:n=1/0,ttl:r,keyFn:i=(...e)=>JSON.stringify(e)}=t,o=new Map;function u(e){return!(!r||!e)&&Date.now()-e>r}const c=function(...t){const c=i(...t);if(o.has(c)){const e=o.get(c);if(!u(e.timestamp))return o.delete(c),o.set(c,e),e.value;o.delete(c)}const s=e.apply(this,t);if(o.size>=n){const e=o.keys().next().value;void 0!==e&&o.delete(e)}return o.set(c,{value:s,timestamp:r?Date.now():void 0}),s};return c.cache=o,c.clear=()=>o.clear(),c.delete=e=>o.delete(e),c.has=e=>{if(!o.has(e))return!1;return!u(o.get(e).timestamp)||(o.delete(e),!1)},c},exports.once=function(e){let t,n=!1;const r=function(...r){return n||(n=!0,t=e.apply(this,r)),t};return Object.defineProperty(r,"called",{get:()=>n}),r.clear=function(){n=!1,t=void 0},r},exports.retry=e,exports.sleep=t,exports.timeout=function(e,t,n={}){const{message:r="Timeout",error:i=new Error(r),cancellable:o=!1}=n;let u,c=!1;const s=new Promise((e,n)=>{u=setTimeout(()=>{c||n(i)},t)}),a=Promise.race([e,s]).finally(()=>{clearTimeout(u)});return o&&(a.cancel=()=>{c=!0,clearTimeout(u)}),a};
//# sourceMappingURL=function-utils.cjs.map
