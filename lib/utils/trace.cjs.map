{"version":3,"file":"trace.cjs","sources":["../../src/utils/trace.ts"],"sourcesContent":["/**\n * ËØ∑Ê±ÇÈìæË∑ØËøΩË∏™\n *\n * ÁîüÊàêtrace ID,Ë∑üË∏™ËØ∑Ê±ÇÁöÑÂÆåÊï¥ÁîüÂëΩÂë®Êúü\n */\n\nimport type { HttpError, RequestConfig, ResponseData } from '../types'\nimport { generateId } from './index'\n\n/**\n * ËøΩË∏™spanÁ±ªÂûã\n */\nexport enum SpanType {\n /** HTTPËØ∑Ê±Ç */\n HTTP = 'http',\n /** Êï∞ÊçÆÂ∫ìÊü•ËØ¢ */\n DATABASE = 'database',\n /** ÁºìÂ≠òÊìç‰Ωú */\n CACHE = 'cache',\n /** Ëá™ÂÆö‰πâ */\n CUSTOM = 'custom',\n}\n\n/**\n * ËøΩË∏™spanÁä∂ÊÄÅ\n */\nexport enum SpanStatus {\n /** ËøõË°å‰∏≠ */\n PENDING = 'pending',\n /** ÊàêÂäü */\n SUCCESS = 'success',\n /** Â§±Ë¥• */\n ERROR = 'error',\n /** ÂèñÊ∂à */\n CANCELLED = 'cancelled',\n}\n\n/**\n * ËøΩË∏™Ê†áÁ≠æ\n */\nexport interface TraceTag {\n key: string\n value: string | number | boolean\n}\n\n/**\n * ËøΩË∏™span\n */\nexport interface TraceSpan {\n /** Span ID */\n spanId: string\n /** Áà∂Span ID */\n parentSpanId?: string\n /** Trace ID */\n traceId: string\n /** SpanÂêçÁß∞ */\n name: string\n /** SpanÁ±ªÂûã */\n type: SpanType\n /** ÂºÄÂßãÊó∂Èó¥ */\n startTime: number\n /** ÁªìÊùüÊó∂Èó¥ */\n endTime?: number\n /** ÊåÅÁª≠Êó∂Èó¥(ms) */\n duration?: number\n /** Áä∂ÊÄÅ */\n status: SpanStatus\n /** Ê†áÁ≠æ */\n tags: TraceTag[]\n /** Êó•Âøó */\n logs: Array<{ timestamp: number, message: string, data?: any }>\n /** ÈîôËØØ‰ø°ÊÅØ */\n error?: { message: string, stack?: string }\n}\n\n/**\n * ËøΩË∏™‰∏ä‰∏ãÊñá\n */\nexport interface TraceContext {\n /** Trace ID */\n traceId: string\n /** ÂΩìÂâçSpan */\n currentSpan?: TraceSpan\n /** ÊâÄÊúâSpans */\n spans: TraceSpan[]\n /** ÂÖÉÊï∞ÊçÆ */\n metadata: Record<string, any>\n}\n\n/**\n * ËøΩË∏™ÈÖçÁΩÆ\n */\nexport interface TraceConfig {\n /** ÊòØÂê¶ÂêØÁî® */\n enabled?: boolean\n /** ÈááÊ†∑Áéá(0-1) */\n sampleRate?: number\n /** ÊòØÂê¶Âú®Header‰∏≠‰º†ÈÄítrace ID */\n propagateTraceId?: boolean\n /** Trace ID HeaderÂêçÁß∞ */\n traceIdHeader?: string\n /** Span ID HeaderÂêçÁß∞ */\n spanIdHeader?: string\n /** ÂØºÂá∫Âô® */\n exporter?: (spans: TraceSpan[]) => void | Promise<void>\n}\n\n/**\n * ËØ∑Ê±ÇËøΩË∏™ÁÆ°ÁêÜÂô®\n *\n * @example\n * ```typescript\n * const tracer = new RequestTracer({\n *  enabled: true,\n *  sampleRate: 1.0,\n * })\n *\n * // ÂºÄÂßãËøΩË∏™\n * const trace = tracer.startTrace('GET /api/users')\n *\n * // Ê∑ªÂä†span\n * const span = trace.startSpan('Query Database', SpanType.DATABASE)\n * span.addTag('table', 'users')\n * span.finish()\n *\n * // ÁªìÊùüËøΩË∏™\n * trace.finish()\n * ```\n */\nexport class RequestTracer {\n private config: Required<Omit<TraceConfig, 'exporter'>> & { exporter?: TraceConfig['exporter'] }\n private traces: Map<string, TraceContext> = new Map()\n\n constructor(config: TraceConfig = {}) {\n  this.config = {\n   enabled: config.enabled ?? true,\n   sampleRate: config.sampleRate ?? 1.0,\n   propagateTraceId: config.propagateTraceId ?? true,\n   traceIdHeader: config.traceIdHeader ?? 'X-Trace-Id',\n   spanIdHeader: config.spanIdHeader ?? 'X-Span-Id',\n   exporter: config.exporter,\n  }\n }\n\n /**\n  * ÂºÄÂßãÊñ∞ÁöÑËøΩË∏™\n  */\n startTrace(name: string, type: SpanType = SpanType.HTTP): Trace {\n  // ÈááÊ†∑ÂÜ≥Á≠ñ\n  if (!this.shouldSample()) {\n   return new NoOpTrace()\n  }\n\n  const traceId = this.generateTraceId()\n  const spanId = this.generateSpanId()\n\n  const span: TraceSpan = {\n   spanId,\n   traceId,\n   name,\n   type,\n   startTime: Date.now(),\n   status: SpanStatus.PENDING,\n   tags: [],\n   logs: [],\n  }\n\n  const context: TraceContext = {\n   traceId,\n   currentSpan: span,\n   spans: [span],\n   metadata: {},\n  }\n\n  this.traces.set(traceId, context)\n\n  return new Trace(this, context, span)\n }\n\n /**\n  * Ëé∑ÂèñËøΩË∏™‰∏ä‰∏ãÊñá\n  */\n getTrace(traceId: string): TraceContext | undefined {\n  return this.traces.get(traceId)\n }\n\n /**\n  * ÁªìÊùüËøΩË∏™\n  */\n finishTrace(traceId: string): void {\n  const context = this.traces.get(traceId)\n  if (!context) return\n\n  // ÂØºÂá∫spans\n  if (this.config?.exporter) {\n   const result = this.config?.exporter(context.spans)\n   if (result instanceof Promise) {\n    result.catch((err: Error) => {\n     console.error('Failed to export trace spans:', err)\n    })\n   }\n  }\n\n  // Ê∏ÖÁêÜ\n  this.traces.delete(traceId)\n }\n\n /**\n  * Âà§Êñ≠ÊòØÂê¶Â∫îËØ•ÈááÊ†∑\n  */\n private shouldSample(): boolean {\n  if (!this.config?.enabled) return false\n  return Math.random() < this.config?.sampleRate\n }\n\n /**\n  * ÁîüÊàêTrace ID\n  */\n private generateTraceId(): string {\n  return `trace-${generateId()}-${Date.now()}`\n }\n\n /**\n  * ÁîüÊàêSpan ID\n  */\n private generateSpanId(): string {\n  return `span-${generateId()}`\n }\n\n /**\n  * Ëé∑ÂèñÈÖçÁΩÆ\n  */\n getConfig(): TraceConfig {\n  return this.config\n }\n}\n\n/**\n * ËøΩË∏™ÂØπË±°\n */\nexport class Trace {\n constructor(\n  private tracer: RequestTracer,\n  private context: TraceContext,\n  private rootSpan: TraceSpan,\n ) {}\n\n /**\n  * Ëé∑ÂèñTrace ID\n  */\n get traceId(): string {\n  return this.context.traceId\n }\n\n /**\n  * Ëé∑ÂèñÂΩìÂâçSpan ID\n  */\n get spanId(): string {\n  return this.rootSpan.spanId\n }\n\n /**\n  * ÂºÄÂßãÂ≠êSpan\n  */\n startSpan(name: string, type: SpanType = SpanType.CUSTOM): Span {\n  const spanId = `span-${generateId()}`\n  const span: TraceSpan = {\n   spanId,\n   parentSpanId: this.context.currentSpan?.spanId,\n   traceId: this.context.traceId,\n   name,\n   type,\n   startTime: Date.now(),\n   status: SpanStatus.PENDING,\n   tags: [],\n   logs: [],\n  }\n\n  this.context.spans.push(span)\n  this.context.currentSpan = span\n\n  return new Span(span)\n }\n\n /**\n  * Ê∑ªÂä†Ê†áÁ≠æ\n  */\n addTag(key: string, value: string | number | boolean): this {\n  this.rootSpan.tags.push({ key, value })\n  return this\n }\n\n /**\n  * Ê∑ªÂä†Êó•Âøó\n  */\n addLog(message: string, data?: any): this {\n  this.rootSpan.logs.push({\n   timestamp: Date.now(),\n   message,\n   data,\n  })\n  return this\n }\n\n /**\n  * ËÆæÁΩÆÈîôËØØ\n  */\n setError(error: Error): this {\n  this.rootSpan.status = SpanStatus.ERROR\n  this.rootSpan.error = {\n   message: error.message,\n   stack: error.stack,\n  }\n  return this\n }\n\n /**\n  * ÁªìÊùüËøΩË∏™\n  */\n finish(status: SpanStatus = SpanStatus.SUCCESS): void {\n  const now = Date.now()\n  this.rootSpan.endTime = now\n  this.rootSpan.duration = now - this.rootSpan.startTime\n  this.rootSpan.status = status\n\n  this.tracer.finishTrace(this.context.traceId)\n }\n\n /**\n  * Ëé∑ÂèñÊâÄÊúâSpans\n  */\n getSpans(): TraceSpan[] {\n  return [...this.context.spans]\n }\n\n /**\n  * Ëé∑ÂèñÂÖÉÊï∞ÊçÆ\n  */\n getMetadata(): Record<string, any> {\n  return this.context.metadata\n }\n\n /**\n  * ËÆæÁΩÆÂÖÉÊï∞ÊçÆ\n  */\n setMetadata(key: string, value: any): this {\n  this.context.metadata[key] = value\n  return this\n }\n}\n\n/**\n * SpanÂØπË±°\n */\nexport class Span {\n constructor(private span: TraceSpan) {}\n\n /**\n  * Ê∑ªÂä†Ê†áÁ≠æ\n  */\n addTag(key: string, value: string | number | boolean): this {\n  this.span.tags.push({ key, value })\n  return this\n }\n\n /**\n  * Ê∑ªÂä†Êó•Âøó\n  */\n addLog(message: string, data?: any): this {\n  this.span.logs.push({\n   timestamp: Date.now(),\n   message,\n   data,\n  })\n  return this\n }\n\n /**\n  * ËÆæÁΩÆÈîôËØØ\n  */\n setError(error: Error): this {\n  this.span.status = SpanStatus.ERROR\n  this.span.error = {\n   message: error.message,\n   stack: error.stack,\n  }\n  return this\n }\n\n /**\n  * ÁªìÊùüSpan\n  */\n finish(status: SpanStatus = SpanStatus.SUCCESS): void {\n  const now = Date.now()\n  this.span.endTime = now\n  this.span.duration = now - this.span.startTime\n  this.span.status = status\n }\n\n /**\n  * Ëé∑ÂèñÂéüÂßãspanÊï∞ÊçÆ\n  */\n getRawSpan(): TraceSpan {\n  return this.span\n }\n}\n\n/**\n * Á©∫ËøΩË∏™ÂØπË±°ÔºàÊú™ÈááÊ†∑Êó∂‰ΩøÁî®Ôºâ\n */\nclass NoOpTrace extends Trace {\n constructor() {\n  super(null as any, null as any, null as any)\n }\n\n startSpan(): Span {\n  return new NoOpSpan()\n }\n\n addTag(): this {\n  return this\n }\n\n addLog(): this {\n  return this\n }\n\n setError(): this {\n  return this\n }\n\n finish(): void {}\n\n getSpans(): TraceSpan[] {\n  return []\n }\n}\n\n/**\n * Á©∫SpanÂØπË±°\n */\nclass NoOpSpan extends Span {\n constructor() {\n  super(null as any)\n }\n\n addTag(): this {\n  return this\n }\n\n addLog(): this {\n  return this\n }\n\n setError(): this {\n  return this\n }\n\n finish(): void {}\n}\n\n/**\n * ÂàõÂª∫ËØ∑Ê±ÇËøΩË∏™Âô®\n */\nexport function createRequestTracer(config?: TraceConfig): RequestTracer {\n return new RequestTracer(config)\n}\n\n/**\n * ÂÖ®Â±ÄËØ∑Ê±ÇËøΩË∏™Âô®\n */\nexport const globalTracer = new RequestTracer()\n\n/**\n * ËøΩË∏™Êã¶Êà™Âô®\n *\n * Ëá™Âä®‰∏∫ÊØè‰∏™ËØ∑Ê±ÇÂàõÂª∫ËøΩË∏™\n */\nexport function createTraceInterceptor(config?: TraceConfig) {\n const tracer = new RequestTracer(config)\n const traces = new Map<string, Trace>()\n\n return {\n  request: {\n   onFulfilled: (requestConfig: RequestConfig) => {\n    const trace = tracer.startTrace(\n     `${requestConfig.method?.toUpperCase()} ${requestConfig.url}`,\n     SpanType.HTTP,\n    )\n\n    // Ê∑ªÂä†ËØ∑Ê±Ç‰ø°ÊÅØ\n    trace.addTag('http.method', requestConfig.method || 'GET')\n    trace.addTag('http.url', requestConfig.url || '')\n    if (requestConfig.baseURL) {\n     trace.addTag('http.base_url', requestConfig.baseURL)\n    }\n\n    // Âú®ËØ∑Ê±ÇÈÖçÁΩÆ‰∏≠‰øùÂ≠òtrace\n    ;(requestConfig as any).__trace__ = trace\n\n    // Â¶ÇÊûúÈÖçÁΩÆ‰∫Ü‰º†Êí≠trace ID,Ê∑ªÂä†Âà∞headers\n    const tracerConfig = tracer.getConfig()\n    if (tracerConfig.propagateTraceId) {\n     requestConfig.headers = requestConfig.headers || {}\n     if (tracerConfig.traceIdHeader && tracerConfig.spanIdHeader) {\n      requestConfig.headers[tracerConfig.traceIdHeader] = trace.traceId\n      requestConfig.headers[tracerConfig.spanIdHeader] = trace.spanId\n     }\n    }\n\n    traces.set(trace.traceId, trace)\n\n    return requestConfig\n   },\n  },\n\n  response: {\n   onFulfilled: (response: ResponseData<any>) => {\n    const trace = (response.config as any).__trace__ as Trace\n    if (trace) {\n     trace.addTag('http.status', response.status)\n     trace.addLog('Response received')\n     trace.finish(SpanStatus.SUCCESS)\n     traces.delete(trace.traceId)\n    }\n    return response\n   },\n\n   onRejected: (error: HttpError) => {\n    const trace = (error.config as any).__trace__ as Trace\n    if (trace) {\n     if (error.response) {\n      trace.addTag('http.status', error.response.status)\n     }\n     trace.setError(error)\n     trace.addLog('Request failed', { error: error.message })\n     trace.finish(SpanStatus.ERROR)\n     traces.delete(trace.traceId)\n    }\n    throw error\n   },\n  },\n }\n}\n\n/**\n * ÊéßÂà∂Âè∞ÂØºÂá∫Âô®\n */\nexport function consoleExporter(spans: TraceSpan[]): void {\n console.group(`üîç Trace: ${spans[0]?.traceId}`)\n\n spans.forEach((span) => {\n  const duration = span.duration ? ` ${span.duration}ms` : ''\n  const status = span.status === SpanStatus.SUCCESS ? '‚úÖ' : span.status === SpanStatus.ERROR ? '‚ùå' : '‚è≥'\n\n  console.group(`${status} ${span.name}${duration}`)\n  console.info('Start:', new Date(span.startTime).toISOString())\n\n  if (span.tags.length > 0) {\n   console.info('Tags:', span.tags)\n  }\n\n  if (span.logs.length > 0) {\n   console.info('Logs:', span.logs)\n  }\n\n  if (span.error) {\n   console.error('Error:', span.error)\n  }\n\n  console.groupEnd()\n })\n\n console.groupEnd()\n}\n"],"names":["SpanType","HTTP","DATABASE","CACHE","CUSTOM","SpanStatus","PENDING","SUCCESS","ERROR","CANCELLED","RequestTracer","constructor","config","this","traces","Map","enabled","sampleRate","propagateTraceId","traceIdHeader","spanIdHeader","exporter","startTrace","name","type","shouldSample","NoOpTrace","traceId","generateTraceId","span","spanId","generateSpanId","startTime","Date","now","status","tags","logs","context","currentSpan","spans","metadata","set","Trace","getTrace","get","finishTrace","result","Promise","catch","err","delete","Math","random","generateId","getConfig","tracer","rootSpan","startSpan","parentSpanId","push","Span","addTag","key","value","addLog","message","data","timestamp","setError","error","stack","finish","endTime","duration","getSpans","getMetadata","setMetadata","getRawSpan","super","NoOpSpan","globalTracer","forEach","length","request","onFulfilled","requestConfig","trace","method","toUpperCase","url","baseURL","__trace__","tracerConfig","headers","response","onRejected"],"mappings":"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"}