{"version":3,"file":"debug-logger.cjs","sources":["../../src/utils/debug-logger.ts"],"sourcesContent":["/**\r\n * 日志管理模块\r\n * \r\n * 提供请求响应日志记录、管理和导出功能\r\n */\r\n\r\nimport type { HttpError, RequestConfig, ResponseData } from '../types'\r\n\r\n/**\r\n * 调试日志级别\r\n */\r\nexport enum LogLevel {\r\n  NONE = 0,\r\n  ERROR = 1,\r\n  WARN = 2,\r\n  INFO = 3,\r\n  DEBUG = 4,\r\n  TRACE = 5,\r\n}\r\n\r\n/**\r\n * 日志条目类型\r\n */\r\nexport type LogEntryType = \r\n  | 'request' \r\n  | 'response' \r\n  | 'error' \r\n  | 'cache_hit' \r\n  | 'cache_miss' \r\n  | 'retry' \r\n  | 'redirect'\r\n  | 'abort'\r\n  | 'custom'\r\n\r\n/**\r\n * 基础日志条目\r\n */\r\nexport interface BaseLogEntry {\r\n  /** 日志ID */\r\n  id: string\r\n  /** 日志类型 */\r\n  type: LogEntryType\r\n  /** 日志级别 */\r\n  level: LogLevel\r\n  /** 时间戳 */\r\n  timestamp: number\r\n  /** 会话ID */\r\n  sessionId?: string\r\n  /** 追踪ID */\r\n  traceId?: string\r\n  /** 标签 */\r\n  tags?: string[]\r\n  /** 元数据 */\r\n  metadata?: Record<string, any>\r\n}\r\n\r\n/**\r\n * 请求日志条目\r\n */\r\nexport interface RequestLogEntry extends BaseLogEntry {\r\n  type: 'request'\r\n  /** 请求配置 */\r\n  config: RequestConfig\r\n  /** 请求方法 */\r\n  method: string\r\n  /** 请求URL */\r\n  url: string\r\n  /** 请求头 */\r\n  headers?: Record<string, string>\r\n  /** 请求体 */\r\n  body?: any\r\n  /** 请求大小 */\r\n  size?: number\r\n}\r\n\r\n/**\r\n * 响应日志条目\r\n */\r\nexport interface ResponseLogEntry extends BaseLogEntry {\r\n  type: 'response'\r\n  /** 关联的请求ID */\r\n  requestId: string\r\n  /** 响应状态 */\r\n  status: number\r\n  /** 响应头 */\r\n  headers?: Record<string, string>\r\n  /** 响应体 */\r\n  body?: any\r\n  /** 响应大小 */\r\n  size?: number\r\n  /** 持续时间 */\r\n  duration: number\r\n  /** 响应数据 */\r\n  response?: ResponseData\r\n}\r\n\r\n/**\r\n * 错误日志条目\r\n */\r\nexport interface ErrorLogEntry extends BaseLogEntry {\r\n  type: 'error'\r\n  /** 关联的请求ID */\r\n  requestId?: string\r\n  /** 错误信息 */\r\n  message: string\r\n  /** 错误堆栈 */\r\n  stack?: string\r\n  /** 错误代码 */\r\n  code?: string | number\r\n  /** HTTP错误 */\r\n  httpError?: HttpError\r\n}\r\n\r\n/**\r\n * 缓存日志条目\r\n */\r\nexport interface CacheLogEntry extends BaseLogEntry {\r\n  type: 'cache_hit' | 'cache_miss'\r\n  /** 缓存键 */\r\n  cacheKey: string\r\n  /** 缓存策略 */\r\n  strategy?: string\r\n  /** 缓存年龄 */\r\n  age?: number\r\n  /** 缓存大小 */\r\n  size?: number\r\n}\r\n\r\n/**\r\n * 日志条目联合类型\r\n */\r\nexport type LogEntry = \r\n  | RequestLogEntry\r\n  | ResponseLogEntry\r\n  | ErrorLogEntry\r\n  | CacheLogEntry\r\n  | BaseLogEntry\r\n\r\n/**\r\n * 日志过滤器\r\n */\r\nexport interface LogFilter {\r\n  /** 日志类型 */\r\n  types?: LogEntryType[]\r\n  /** 日志级别 */\r\n  minLevel?: LogLevel\r\n  /** 开始时间 */\r\n  startTime?: number\r\n  /** 结束时间 */\r\n  endTime?: number\r\n  /** URL模式 */\r\n  urlPattern?: string | RegExp\r\n  /** 状态码范围 */\r\n  statusRange?: [number, number]\r\n  /** 标签 */\r\n  tags?: string[]\r\n  /** 会话ID */\r\n  sessionId?: string\r\n  /** 追踪ID */\r\n  traceId?: string\r\n}\r\n\r\n/**\r\n * 日志存储配置\r\n */\r\nexport interface LogStorageConfig {\r\n  /** 最大日志数量 */\r\n  maxEntries?: number\r\n  /** 最大存储大小（字节） */\r\n  maxSize?: number\r\n  /** 日志过期时间（毫秒） */\r\n  ttl?: number\r\n  /** 是否持久化 */\r\n  persist?: boolean\r\n  /** 持久化键名 */\r\n  persistKey?: string\r\n}\r\n\r\n/**\r\n * 日志存储器\r\n */\r\nexport class LogStorage {\r\n  private entries: Map<string, LogEntry> = new Map()\r\n  private entryOrder: string[] = []\r\n  private currentSize = 0\r\n  private config: Required<LogStorageConfig>\r\n\r\n  constructor(config: LogStorageConfig = {}) {\r\n    this.config = {\r\n      maxEntries: config.maxEntries ?? 1000,\r\n      maxSize: config.maxSize ?? 10 * 1024 * 1024, // 10MB\r\n      ttl: config.ttl ?? 24 * 60 * 60 * 1000, // 24小时\r\n      persist: config.persist ?? false,\r\n      persistKey: config.persistKey ?? 'http-debug-logs',\r\n    }\r\n\r\n    if (this.config.persist) {\r\n      this.loadFromStorage()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 添加日志条目\r\n   */\r\n  add(entry: LogEntry): void {\r\n    // 移除过期条目\r\n    this.removeExpired()\r\n\r\n    // 估算条目大小\r\n    const entrySize = this.estimateSize(entry)\r\n\r\n    // 检查大小限制\r\n    while (\r\n      (this.entries.size >= this.config.maxEntries ||\r\n       this.currentSize + entrySize > this.config.maxSize) &&\r\n      this.entryOrder.length > 0\r\n    ) {\r\n      this.removeOldest()\r\n    }\r\n\r\n    // 添加新条目\r\n    this.entries.set(entry.id, entry)\r\n    this.entryOrder.push(entry.id)\r\n    this.currentSize += entrySize\r\n\r\n    // 持久化\r\n    if (this.config.persist) {\r\n      this.saveToStorage()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取日志条目\r\n   */\r\n  get(id: string): LogEntry | undefined {\r\n    return this.entries.get(id)\r\n  }\r\n\r\n  /**\r\n   * 查询日志条目\r\n   */\r\n  query(filter: LogFilter = {}): LogEntry[] {\r\n    return Array.from(this.entries.values())\r\n      .filter(entry => this.matchesFilter(entry, filter))\r\n      .sort((a, b) => b.timestamp - a.timestamp)\r\n  }\r\n\r\n  /**\r\n   * 删除日志条目\r\n   */\r\n  remove(id: string): boolean {\r\n    const entry = this.entries.get(id)\r\n    if (!entry) {\r\n      return false\r\n    }\r\n\r\n    this.entries.delete(id)\r\n    const index = this.entryOrder.indexOf(id)\r\n    if (index !== -1) {\r\n      this.entryOrder.splice(index, 1)\r\n    }\r\n    \r\n    this.currentSize -= this.estimateSize(entry)\r\n    \r\n    if (this.config.persist) {\r\n      this.saveToStorage()\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * 清空所有日志\r\n   */\r\n  clear(): void {\r\n    this.entries.clear()\r\n    this.entryOrder = []\r\n    this.currentSize = 0\r\n\r\n    if (this.config.persist) {\r\n      this.removeFromStorage()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取统计信息\r\n   */\r\n  getStats(): {\r\n    totalEntries: number\r\n    totalSize: number\r\n    oldestEntry?: LogEntry\r\n    newestEntry?: LogEntry\r\n    typeDistribution: Record<LogEntryType, number>\r\n    levelDistribution: Record<string, number>\r\n  } {\r\n    const entries = Array.from(this.entries.values())\r\n    const typeDistribution: Record<string, number> = {}\r\n    const levelDistribution: Record<string, number> = {}\r\n\r\n    entries.forEach(entry => {\r\n      typeDistribution[entry.type] = (typeDistribution[entry.type] || 0) + 1\r\n      levelDistribution[LogLevel[entry.level]] = \r\n        (levelDistribution[LogLevel[entry.level]] || 0) + 1\r\n    })\r\n\r\n    const sortedEntries = entries.sort((a, b) => a.timestamp - b.timestamp)\r\n\r\n    return {\r\n      totalEntries: this.entries.size,\r\n      totalSize: this.currentSize,\r\n      oldestEntry: sortedEntries[0],\r\n      newestEntry: sortedEntries[sortedEntries.length - 1],\r\n      typeDistribution: typeDistribution as Record<LogEntryType, number>,\r\n      levelDistribution,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 导出日志\r\n   */\r\n  export(format: 'json' | 'csv' = 'json'): string {\r\n    const entries = this.query()\r\n\r\n    if (format === 'json') {\r\n      return JSON.stringify(entries, null, 2)\r\n    }\r\n\r\n    // CSV格式\r\n    const headers = [\r\n      'id',\r\n      'type',\r\n      'level',\r\n      'timestamp',\r\n      'method',\r\n      'url',\r\n      'status',\r\n      'duration',\r\n      'message',\r\n    ]\r\n\r\n    const rows = entries.map(entry => {\r\n      const row: any[] = [\r\n        entry.id,\r\n        entry.type,\r\n        LogLevel[entry.level],\r\n        new Date(entry.timestamp).toISOString(),\r\n      ]\r\n\r\n      if ('method' in entry) {\r\n        row.push(entry.method)\r\n      } else {\r\n        row.push('')\r\n      }\r\n\r\n      if ('url' in entry) {\r\n        row.push(entry.url)\r\n      } else {\r\n        row.push('')\r\n      }\r\n\r\n      if ('status' in entry) {\r\n        row.push(entry.status)\r\n      } else {\r\n        row.push('')\r\n      }\r\n\r\n      if ('duration' in entry) {\r\n        row.push(entry.duration)\r\n      } else {\r\n        row.push('')\r\n      }\r\n\r\n      if ('message' in entry) {\r\n        row.push(entry.message)\r\n      } else {\r\n        row.push('')\r\n      }\r\n\r\n      return row\r\n    })\r\n\r\n    const csv = [\r\n      headers.join(','),\r\n      ...rows.map(row => row.map(v => JSON.stringify(v ?? '')).join(',')),\r\n    ].join('\\n')\r\n\r\n    return csv\r\n  }\r\n\r\n  /**\r\n   * 匹配过滤器\r\n   */\r\n  private matchesFilter(entry: LogEntry, filter: LogFilter): boolean {\r\n    // 类型过滤\r\n    if (filter.types && !filter.types.includes(entry.type)) {\r\n      return false\r\n    }\r\n\r\n    // 级别过滤\r\n    if (filter.minLevel !== undefined && entry.level < filter.minLevel) {\r\n      return false\r\n    }\r\n\r\n    // 时间范围过滤\r\n    if (filter.startTime && entry.timestamp < filter.startTime) {\r\n      return false\r\n    }\r\n    if (filter.endTime && entry.timestamp > filter.endTime) {\r\n      return false\r\n    }\r\n\r\n    // URL模式过滤\r\n    if (filter.urlPattern && 'url' in entry) {\r\n      const pattern = filter.urlPattern\r\n      if (typeof pattern === 'string') {\r\n        if (!entry.url?.includes(pattern)) {\r\n          return false\r\n        }\r\n      } else if (!pattern.test(entry.url || '')) {\r\n        return false\r\n      }\r\n    }\r\n\r\n    // 状态码范围过滤\r\n    if (filter.statusRange && 'status' in entry) {\r\n      const [min, max] = filter.statusRange\r\n      const status = entry.status as number\r\n      if (status < min || status > max) {\r\n        return false\r\n      }\r\n    }\r\n\r\n    // 标签过滤\r\n    if (filter.tags && filter.tags.length > 0) {\r\n      if (!entry.tags || !filter.tags.some(tag => entry.tags?.includes(tag))) {\r\n        return false\r\n      }\r\n    }\r\n\r\n    // 会话ID过滤\r\n    if (filter.sessionId && entry.sessionId !== filter.sessionId) {\r\n      return false\r\n    }\r\n\r\n    // 追踪ID过滤\r\n    if (filter.traceId && entry.traceId !== filter.traceId) {\r\n      return false\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * 移除最旧的条目\r\n   */\r\n  private removeOldest(): void {\r\n    if (this.entryOrder.length === 0) {\r\n      return\r\n    }\r\n\r\n    const oldestId = this.entryOrder.shift()!\r\n    const entry = this.entries.get(oldestId)\r\n    \r\n    if (entry) {\r\n      this.currentSize -= this.estimateSize(entry)\r\n      this.entries.delete(oldestId)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 移除过期条目\r\n   */\r\n  private removeExpired(): void {\r\n    if (this.config.ttl <= 0) {\r\n      return\r\n    }\r\n\r\n    const now = Date.now()\r\n    const expiredIds: string[] = []\r\n\r\n    this.entries.forEach((entry, id) => {\r\n      if (now - entry.timestamp > this.config.ttl) {\r\n        expiredIds.push(id)\r\n      }\r\n    })\r\n\r\n    expiredIds.forEach(id => this.remove(id))\r\n  }\r\n\r\n  /**\r\n   * 估算条目大小\r\n   */\r\n  private estimateSize(entry: LogEntry): number {\r\n    try {\r\n      return JSON.stringify(entry).length\r\n    } catch {\r\n      return 1024 // 默认1KB\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 从存储加载\r\n   */\r\n  private loadFromStorage(): void {\r\n    if (typeof localStorage === 'undefined') {\r\n      return\r\n    }\r\n\r\n    try {\r\n      const data = localStorage.getItem(this.config.persistKey)\r\n      if (!data) {\r\n        return\r\n      }\r\n\r\n      const parsed = JSON.parse(data) as LogEntry[]\r\n      parsed.forEach(entry => {\r\n        this.add(entry)\r\n      })\r\n    } catch (error) {\r\n      console.error('Failed to load logs from storage:', error)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 保存到存储\r\n   */\r\n  private saveToStorage(): void {\r\n    if (typeof localStorage === 'undefined') {\r\n      return\r\n    }\r\n\r\n    try {\r\n      const entries = Array.from(this.entries.values())\r\n      localStorage.setItem(this.config.persistKey, JSON.stringify(entries))\r\n    } catch (error) {\r\n      console.error('Failed to save logs to storage:', error)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 从存储移除\r\n   */\r\n  private removeFromStorage(): void {\r\n    if (typeof localStorage === 'undefined') {\r\n      return\r\n    }\r\n\r\n    try {\r\n      localStorage.removeItem(this.config.persistKey)\r\n    } catch (error) {\r\n      console.error('Failed to remove logs from storage:', error)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 创建日志存储器\r\n */\r\nexport function createLogStorage(config?: LogStorageConfig): LogStorage {\r\n  return new LogStorage(config)\r\n}"],"names":["LogLevel","NONE","ERROR","WARN","INFO","DEBUG","TRACE","LogStorage","constructor","config","this","entries","Map","entryOrder","currentSize","maxEntries","maxSize","ttl","persist","persistKey","loadFromStorage","add","entry","removeExpired","entrySize","estimateSize","size","length","removeOldest","set","id","push","saveToStorage","get","query","filter","Array","from","values","matchesFilter","sort","a","b","timestamp","remove","delete","index","indexOf","splice","clear","removeFromStorage","getStats","typeDistribution","levelDistribution","forEach","type","level","sortedEntries","totalEntries","totalSize","oldestEntry","newestEntry","format","JSON","stringify","rows","map","row","Date","toISOString","method","url","status","duration","message","join","v","types","includes","minLevel","startTime","endTime","urlPattern","pattern","test","statusRange","min","max","tags","some","tag","sessionId","traceId","oldestId","shift","now","expiredIds","localStorage","data","getItem","parse","error","setItem","removeItem"],"mappings":"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"}