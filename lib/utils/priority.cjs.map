{"version":3,"file":"priority.cjs","sources":["../../src/utils/priority.ts"],"sourcesContent":["/**\r\n * 请求优先级管理模块\r\n * 提供请求优先级调度和队列管理功能\r\n */\r\n\r\nimport type { RequestConfig } from '../types'\r\n\r\n/**\r\n * 请求优先级级别\r\n */\r\nexport enum Priority {\r\n  CRITICAL = 0, // 关键请求（最高优先级）\r\n  HIGH = 1, // 高优先级\r\n  NORMAL = 2, // 正常优先级\r\n  LOW = 3, // 低优先级\r\n  IDLE = 4, // 空闲时执行\r\n}\r\n\r\n/**\r\n * 优先级请求项\r\n */\r\nexport interface PriorityItem<T = any> {\r\n  id: string\r\n  priority: Priority\r\n  config: RequestConfig\r\n  executor: () => Promise<T>\r\n  resolve: (value: T) => void\r\n  reject: (reason: any) => void\r\n  timestamp: number\r\n  retryCount?: number\r\n  abortController?: AbortController\r\n}\r\n\r\n/**\r\n * 优先级队列配置\r\n */\r\nexport interface PriorityQueueConfig {\r\n  maxConcurrent?: number\r\n  maxQueueSize?: number\r\n  queueTimeout?: number // 队列超时时间(ms)\r\n  priorityBoost?: boolean // 是否启用等待时间提权\r\n  boostInterval?: number // 提权间隔时间(ms)\r\n}\r\n\r\n/**\r\n * 优先级队列统计\r\n */\r\nexport interface PriorityQueueStats {\r\n  totalQueued: number\r\n  totalProcessed: number\r\n  totalFailed: number\r\n  currentActive: number\r\n  queuedByPriority: Record<Priority, number>\r\n  averageWaitTime: number\r\n  averageProcessTime: number\r\n}\r\n\r\n/**\r\n * 优先级请求队列（优化版）\r\n *\r\n * 优化点：\r\n * 1. 按需触发提权检查，而非定时检查\r\n * 2. 使用索引优化查找\r\n * 3. 减少不必要的遍历\r\n */\r\nexport class PriorityQueue<T = any> {\r\n  private queue: Map<Priority, PriorityItem<T>[]> = new Map()\r\n  private active = new Set<string>()\r\n  private config: Required<PriorityQueueConfig>\r\n  private stats = {\r\n    totalQueued: 0,\r\n    totalProcessed: 0,\r\n    totalFailed: 0,\r\n    waitTimes: [] as number[],\r\n    processTimes: [] as number[],\r\n  }\r\n\r\n  private processing = false\r\n  private boostTimer?: NodeJS.Timeout\r\n  private lastBoostCheck = 0 // 上次提权检查时间\r\n  private cachedQueueSize = 0 // 缓存队列大小\r\n  private queueSizeDirty = true // 队列大小是否需要重新计算\r\n\r\n  constructor(config: PriorityQueueConfig = {}) {\r\n    this.config = {\r\n      maxConcurrent: 6,\r\n      maxQueueSize: 100,\r\n      queueTimeout: 30000,\r\n      priorityBoost: true,\r\n      boostInterval: 5000,\r\n      ...config,\r\n    }\r\n\r\n    // 初始化各优先级队列\r\n    for (const priority of Object.values(Priority)) {\r\n      if (typeof priority === 'number') {\r\n        this.queue.set(priority, [])\r\n      }\r\n    }\r\n\r\n    // 启动优先级提升定时器（优化：只在有队列项时运行）\r\n    if (this.config?.priorityBoost) {\r\n      this.startPriorityBoost()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 添加请求到队列\r\n   */\r\n  async enqueue(\r\n    config: RequestConfig,\r\n    executor: () => Promise<T>,\r\n    priority: Priority = Priority.NORMAL,\r\n  ): Promise<T> {\r\n    return new Promise((resolve, reject) => {\r\n      // 检查队列大小\r\n      if (this.getTotalQueueSize() >= this.config?.maxQueueSize) {\r\n        reject(new Error('Queue is full'))\r\n        return\r\n      }\r\n\r\n      const item: PriorityItem<T> = {\r\n        id: this.generateId(),\r\n        priority,\r\n        config,\r\n        executor,\r\n        resolve,\r\n        reject,\r\n        timestamp: Date.now(),\r\n        abortController: new AbortController(),\r\n      }\r\n\r\n      // 添加到对应优先级队列\r\n      const priorityQueue = this.queue.get(priority)\r\n      if (priorityQueue) {\r\n        priorityQueue.push(item)\r\n        this.stats.totalQueued++\r\n        this.queueSizeDirty = true // 标记队列大小变化\r\n      }\r\n\r\n      // 设置超时\r\n      if (this.config?.queueTimeout > 0) {\r\n        setTimeout(() => {\r\n          if (this.removeItem(item)) {\r\n            item.reject(new Error('Request timeout in queue'))\r\n            this.stats.totalFailed++\r\n          }\r\n        }, this.config?.queueTimeout)\r\n      }\r\n\r\n      // 尝试处理队列\r\n      this.processQueue()\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 处理队列\r\n   */\r\n  private async processQueue(): Promise<void> {\r\n    if (this.processing)\r\n      return\r\n    this.processing = true\r\n\r\n    while (this.active.size < this.config?.maxConcurrent) {\r\n      const item = this.getNextItem()\r\n      if (!item)\r\n        break\r\n\r\n      this.active.add(item.id)\r\n      this.executeItem(item)\r\n    }\r\n\r\n    this.processing = false\r\n  }\r\n\r\n  /**\r\n   * 执行请求项\r\n   */\r\n  private async executeItem(item: PriorityItem<T>): Promise<void> {\r\n    const waitTime = Date.now() - item.timestamp\r\n    this.stats.waitTimes.push(waitTime)\r\n\r\n    const startTime = Date.now()\r\n\r\n    try {\r\n      const result = await item.executor()\r\n      item.resolve(result)\r\n      this.stats.totalProcessed++\r\n\r\n      const processTime = Date.now() - startTime\r\n      this.stats.processTimes.push(processTime)\r\n    }\r\n    catch (error) {\r\n      item.reject(error)\r\n      this.stats.totalFailed++\r\n    }\r\n    finally {\r\n      this.active.delete(item.id)\r\n      // 继续处理队列\r\n      this.processQueue()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取下一个要处理的项\r\n   */\r\n  private getNextItem(): PriorityItem<T> | undefined {\r\n    // 按优先级顺序获取\r\n    for (const priority of [Priority.CRITICAL, Priority.HIGH, Priority.NORMAL, Priority.LOW, Priority.IDLE]) {\r\n      const priorityQueue = this.queue.get(priority)\r\n      if (priorityQueue && priorityQueue.length > 0) {\r\n        return priorityQueue.shift()\r\n      }\r\n    }\r\n    return undefined\r\n  }\r\n\r\n  /**\r\n   * 移除队列项\r\n   */\r\n  private removeItem(item: PriorityItem<T>): boolean {\r\n    const priorityQueue = this.queue.get(item.priority)\r\n    if (!priorityQueue)\r\n      return false\r\n\r\n    const index = priorityQueue.findIndex(i => i.id === item.id)\r\n    if (index !== -1) {\r\n      priorityQueue.splice(index, 1)\r\n      return true\r\n    }\r\n    return false\r\n  }\r\n\r\n  /**\r\n   * 启动优先级提升（优化版 - 按需检查）\r\n   */\r\n  private startPriorityBoost(): void {\r\n    this.boostTimer = setInterval(() => {\r\n      // 优化：只在有队列项时检查\r\n      if (this.getTotalQueueSize() === 0) {\r\n        return\r\n      }\r\n\r\n      const now = Date.now()\r\n\r\n      // 优化：避免频繁检查\r\n      if (now - this.lastBoostCheck < this.config?.boostInterval / 2) {\r\n        return\r\n      }\r\n\r\n      this.lastBoostCheck = now\r\n      this.performPriorityBoost(now)\r\n    }, 2000) // 降低检查频率到每2秒\r\n  }\r\n\r\n  /**\r\n   * 执行优先级提升（优化版）\r\n   */\r\n  private performPriorityBoost(now: number): void {\r\n    // 收集需要移动的项，避免在遍历时修改\r\n    const itemsToMove: Array<{ item: PriorityItem<T>, from: Priority, to: Priority }> = []\r\n    \r\n    // 遍历所有队列，找出需要提升的项\r\n    for (const [priority, items] of this.queue.entries()) {\r\n      if (priority === Priority.CRITICAL || items.length === 0) {\r\n        continue // 已经是最高优先级或队列为空\r\n      }\r\n\r\n      const boostInterval = this.config?.boostInterval\r\n      \r\n      // 收集需要提升的项\r\n      for (let i = 0; i < items.length; i++) {\r\n        const item = items[i]\r\n        if (now - item.timestamp > boostInterval) {\r\n          const newPriority = Math.max(Priority.CRITICAL, priority - 1)\r\n          itemsToMove.push({ item, from: priority, to: newPriority })\r\n        }\r\n      }\r\n    }\r\n    \r\n    // 批量移动项（避免在遍历时修改数组）\r\n    for (const move of itemsToMove) {\r\n      // 从原队列移除\r\n      const fromQueue = this.queue.get(move.from)\r\n      if (fromQueue) {\r\n        const index = fromQueue.indexOf(move.item)\r\n        if (index !== -1) {\r\n          fromQueue.splice(index, 1)\r\n          this.queueSizeDirty = true // 标记队列大小变化\r\n        }\r\n      }\r\n      \r\n      // 更新优先级并添加到新队列\r\n      move.item.priority = move.to\r\n      const toQueue = this.queue.get(move.to)\r\n      if (toQueue) {\r\n        toQueue.push(move.item)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 取消请求\r\n   */\r\n  cancel(id: string): boolean {\r\n    // 在队列中查找并移除\r\n    for (const [, items] of this.queue.entries()) {\r\n      const index = items.findIndex(item => item.id === id)\r\n      if (index !== -1) {\r\n        const item = items[index]\r\n        items.splice(index, 1)\r\n        item.reject(new Error('Request cancelled'))\r\n        item.abortController?.abort()\r\n        return true\r\n      }\r\n    }\r\n\r\n    // 检查是否在执行中\r\n    if (this.active.has(id)) {\r\n      // 无法取消正在执行的请求\r\n      return false\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  /**\r\n   * 取消所有请求\r\n   */\r\n  cancelAll(reason = 'All requests cancelled'): void {\r\n    for (const [, items] of this.queue.entries()) {\r\n      for (const item of items) {\r\n        item.reject(new Error(reason))\r\n        item.abortController?.abort()\r\n      }\r\n      items.length = 0\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取队列统计信息\r\n   */\r\n  getStats(): PriorityQueueStats {\r\n    const queuedByPriority: Record<Priority, number> = {} as any\r\n\r\n    for (const [priority, items] of this.queue.entries()) {\r\n      queuedByPriority[priority] = items.length\r\n    }\r\n\r\n    const avgWaitTime = this.stats.waitTimes.length > 0\r\n      ? this.stats.waitTimes.reduce((a, b) => a + b, 0) / this.stats.waitTimes.length\r\n      : 0\r\n\r\n    const avgProcessTime = this.stats.processTimes.length > 0\r\n      ? this.stats.processTimes.reduce((a, b) => a + b, 0) / this.stats.processTimes.length\r\n      : 0\r\n\r\n    return {\r\n      totalQueued: this.stats.totalQueued,\r\n      totalProcessed: this.stats.totalProcessed,\r\n      totalFailed: this.stats.totalFailed,\r\n      currentActive: this.active.size,\r\n      queuedByPriority,\r\n      averageWaitTime: avgWaitTime,\r\n      averageProcessTime: avgProcessTime,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取总队列大小（优化版：使用缓存）\r\n   */\r\n  private getTotalQueueSize(): number {\r\n    if (!this.queueSizeDirty) {\r\n      return this.cachedQueueSize\r\n    }\r\n\r\n    let total = 0\r\n    for (const [, items] of this.queue.entries()) {\r\n      total += items.length\r\n    }\r\n    \r\n    this.cachedQueueSize = total\r\n    this.queueSizeDirty = false\r\n    \r\n    return total\r\n  }\r\n\r\n  /**\r\n   * 生成唯一ID\r\n   */\r\n  private generateId(): string {\r\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\r\n  }\r\n\r\n  /**\r\n   * 清理资源\r\n   */\r\n  destroy(): void {\r\n    if (this.boostTimer) {\r\n      clearInterval(this.boostTimer)\r\n    }\r\n    this.cancelAll('Queue destroyed')\r\n    this.queue.clear()\r\n    this.active.clear()\r\n  }\r\n}\r\n\r\n/**\r\n * 创建优先级队列\r\n */\r\nexport function createPriorityQueue<T = any>(config?: PriorityQueueConfig): PriorityQueue<T> {\r\n  return new PriorityQueue<T>(config)\r\n}\r\n\r\n/**\r\n * 判断请求优先级\r\n */\r\nexport function determinePriority(config: RequestConfig): Priority {\r\n  // 可以根据请求配置自动判断优先级\r\n  if (config.priority !== undefined) {\r\n    return config.priority as Priority\r\n  }\r\n\r\n  // 根据URL模式判断\r\n  const url = config.url || ''\r\n\r\n  // 认证相关请求 - 关键\r\n  if (url.includes('/auth') || url.includes('/login') || url.includes('/token')) {\r\n    return Priority.CRITICAL\r\n  }\r\n\r\n  // API 请求 - 高优先级\r\n  if (url.includes('/api')) {\r\n    return Priority.HIGH\r\n  }\r\n\r\n  // 静态资源 - 低优先级\r\n  if (url.match(/\\.(jpg|jpeg|png|gif|css|js)$/i)) {\r\n    return Priority.LOW\r\n  }\r\n\r\n  // 分析和日志 - 空闲时执行\r\n  if (url.includes('/analytics') || url.includes('/log')) {\r\n    return Priority.IDLE\r\n  }\r\n\r\n  return Priority.NORMAL\r\n}\r\n"],"names":["Priority","CRITICAL","HIGH","NORMAL","LOW","IDLE","PriorityQueue","constructor","config","this","queue","Map","active","Set","stats","totalQueued","totalProcessed","totalFailed","waitTimes","processTimes","processing","lastBoostCheck","cachedQueueSize","queueSizeDirty","maxConcurrent","maxQueueSize","queueTimeout","priorityBoost","boostInterval","priority","Object","values","set","startPriorityBoost","enqueue","executor","Promise","resolve","reject","getTotalQueueSize","Error","item","id","generateId","timestamp","Date","now","abortController","AbortController","priorityQueue","get","push","setTimeout","removeItem","processQueue","size","getNextItem","add","executeItem","waitTime","startTime","result","processTime","error","delete","length","shift","index","findIndex","i","splice","boostTimer","setInterval","performPriorityBoost","itemsToMove","items","entries","newPriority","Math","max","from","to","move","fromQueue","indexOf","toQueue","cancel","abort","has","cancelAll","reason","getStats","queuedByPriority","avgWaitTime","reduce","a","b","avgProcessTime","currentActive","averageWaitTime","averageProcessTime","total","random","toString","substr","destroy","clearInterval","clear","url","includes","match"],"mappings":"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"}