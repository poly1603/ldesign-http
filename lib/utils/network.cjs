"use strict";var t;exports.NetworkStatus=void 0,(t=exports.NetworkStatus||(exports.NetworkStatus={})).ONLINE="online",t.OFFLINE="offline",t.UNKNOWN="unknown",exports.ConnectionType=void 0,function(t){t.WIFI="wifi",t.CELLULAR_4G="4g",t.CELLULAR_3G="3g",t.CELLULAR_2G="2g",t.UNKNOWN="unknown"}(exports.ConnectionType||(exports.ConnectionType={}));class e{constructor(t={}){this.currentStatus=exports.NetworkStatus.UNKNOWN,this.listeners=[],this.isMonitoring=!1,this.config={enabled:t.enabled??!0,pauseOnOffline:t.pauseOnOffline??!0,retryOnOnline:t.retryOnOnline??!0,onStatusChange:t.onStatusChange,onOffline:t.onOffline,onOnline:t.onOnline},this.updateStatus()}start(){if(!this.config?.enabled||this.isMonitoring||typeof window>"u")return;this.isMonitoring=!0;const t=()=>{this.handleStatusChange(exports.NetworkStatus.ONLINE),this.config?.onOnline?.()},e=()=>{this.handleStatusChange(exports.NetworkStatus.OFFLINE),this.config?.onOffline?.()};if(window.addEventListener("online",t),window.addEventListener("offline",e),this.listeners.push(()=>window.removeEventListener("online",t),()=>window.removeEventListener("offline",e)),"connection"in navigator||"mozConnection"in navigator||"webkitConnection"in navigator){const t=navigator.connection||navigator.mozConnection||navigator.webkitConnection,e=()=>{this.updateStatus()};t.addEventListener("change",e),this.listeners.push(()=>t.removeEventListener("change",e))}}stop(){this.isMonitoring&&(this.isMonitoring=!1,this.listeners.forEach(t=>t()),this.listeners=[])}getStatus(){return this.currentStatus}isOnline(){return this.currentStatus===exports.NetworkStatus.ONLINE}isOffline(){return this.currentStatus===exports.NetworkStatus.OFFLINE}getNetworkInfo(){const t={online:this.isOnline(),connectionType:exports.ConnectionType.UNKNOWN,metered:!1};if(typeof navigator>"u")return t;const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return e&&(e.effectiveType&&(t.effectiveType=e.effectiveType,t.connectionType=this.parseConnectionType(e.effectiveType)),"boolean"==typeof e.saveData&&(t.metered=e.saveData),"number"==typeof e.downlink&&(t.downlink=e.downlink),"number"==typeof e.rtt&&(t.rtt=e.rtt)),t}handleStatusChange(t){if(this.currentStatus===t)return;this.currentStatus=t;const e=this.getNetworkInfo();this.config?.onStatusChange?.(t,e)}updateStatus(){typeof navigator<"u"&&"onLine"in navigator?this.currentStatus=navigator.onLine?exports.NetworkStatus.ONLINE:exports.NetworkStatus.OFFLINE:this.currentStatus=exports.NetworkStatus.UNKNOWN}parseConnectionType(t){switch(t.toLowerCase()){case"4g":return exports.ConnectionType.CELLULAR_4G;case"3g":return exports.ConnectionType.CELLULAR_3G;case"2g":return exports.ConnectionType.CELLULAR_2G;case"wifi":return exports.ConnectionType.WIFI;default:return exports.ConnectionType.UNKNOWN}}isSuitableForLargeTransfer(){const t=this.getNetworkInfo();return!(!t.online||t.metered||t.connectionType===exports.ConnectionType.CELLULAR_2G||t.connectionType===exports.ConnectionType.CELLULAR_3G||t.downlink&&t.downlink<1)}destroy(){this.stop()}}const n=new e;typeof window<"u"&&n.start(),exports.NetworkMonitor=e,exports.createNetworkInterceptor=function(t){const n=new e(t);n.start();const o=[];return n.start(),{request:{onFulfilled:async t=>{if(n.isOffline()){if(n.config.pauseOnOffline)return new Promise((e,i)=>{o.push({config:t,resolve:e,reject:i});const r=setInterval(()=>{if(n.isOnline()){const t=o.shift();t&&e(t.config)}},1e3);setTimeout(()=>{clearInterval(r);const e=o.findIndex(e=>e.config===t);-1!==e&&(o.splice(e,1),i(new Error("Network timeout: request cancelled after 5 minutes")))},3e5)});throw new Error("Network is offline")}return t}},destroy:()=>{n.destroy()}}},exports.createNetworkMonitor=function(t){return new e(t)},exports.globalNetworkMonitor=n,exports.waitForOnline=function(t=6e4){return new Promise((e,o)=>{if(n.isOnline())return void e();const i=setTimeout(()=>{o(new Error("Timeout waiting for network"))},t),r=setInterval(()=>{n.isOnline()&&(clearTimeout(i),e())},1e3);setTimeout(()=>clearInterval(r),t)})};
//# sourceMappingURL=network.cjs.map
