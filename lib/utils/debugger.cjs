"use strict";var e;exports.DebugLevel=void 0,(e=exports.DebugLevel||(exports.DebugLevel={}))[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR",e[e.WARN=2]="WARN",e[e.INFO=3]="INFO",e[e.DEBUG=4]="DEBUG",e[e.TRACE=5]="TRACE";class t{constructor(e={}){this.requestLogs=new Map,this.responseLogs=[],this.events=[],this.performanceData=new Map,this.isApplied=!1,this.config={level:e.level??exports.DebugLevel.INFO,logRequests:e.logRequests??!0,logResponses:e.logResponses??!0,logHeaders:e.logHeaders??!0,logBody:e.logBody??!1,logResponseBody:e.logResponseBody??!1,maxLogs:e.maxLogs??1e3,console:e.console??!0,handler:e.handler||(()=>{}),performance:e.performance??!0,cacheTracking:e.cacheTracking??!0}}apply(e){if(this.isApplied)throw new Error("HttpDebugger is already applied");e.interceptors.request.use(e=>(this.logRequest(e),e)),e.interceptors.response.use(e=>(this.logResponse(e),e),e=>(this.logError(e),Promise.reject(e))),this.isApplied=!0}logRequest(e){if(!this.config?.logRequests)return;const t=this.generateId(),s={id:t,config:e,timestamp:Date.now(),method:e.method||"GET",url:e.url||"",headers:this.config?.logHeaders?e.headers:void 0,data:this.config?.logBody?e.data:void 0};this.requestLogs.set(t,s),this.config?.performance&&this.performanceData.set(t,{totalTime:0}),this.recordEvent({type:"request",data:s,timestamp:Date.now(),level:exports.DebugLevel.DEBUG}),this.config?.console&&(this.config,exports.DebugLevel.DEBUG)}logResponse(e){if(!this.config?.logResponses)return;const t=this.findRequestId(e.config),s=t?this.requestLogs.get(t):null,o=Date.now(),r=s?o-s.timestamp:0,n={requestId:t||"unknown",response:this.config?.logResponseBody?e:{...e,data:"[Response Body Hidden]"},timestamp:o,duration:r,status:e.status,size:this.estimateSize(e.data)};if(this.responseLogs.push(n),this.trimLogs(),this.config?.performance&&t){const e=this.performanceData.get(t);e&&(e.totalTime=r,e.responseSize=n.size)}this.recordEvent({type:"response",data:n,timestamp:o,level:exports.DebugLevel.DEBUG}),this.config?.console&&(this.config,exports.DebugLevel.DEBUG)}logError(e){const t=e.config?this.findRequestId(e.config):null,s=t?this.requestLogs.get(t):null,o=Date.now(),r={requestId:t||"unknown",error:e,timestamp:o,duration:s?o-s.timestamp:0,status:e.response?.status};this.responseLogs.push(r),this.trimLogs(),this.recordEvent({type:"error",data:r,timestamp:o,level:exports.DebugLevel.ERROR}),this.config?.console&&(this.config,exports.DebugLevel.ERROR)}recordEvent(e){this.events.push(e),this.events.length>this.config?.maxLogs&&this.events.shift(),this.config?.handler(e)}getRequestLogs(){return Array.from(this.requestLogs.values())}getResponseLogs(){return[...this.responseLogs]}getEvents(){return[...this.events]}getPerformanceReport(){const e=this.responseLogs,t=e.length,s=e.reduce((e,t)=>e+t.duration,0),o=t>0?s/t:0,r=e.reduce((e,t)=>t.duration>(e?.duration||0)?t:e,e[0]||null),n=e.reduce((e,t)=>t.duration<(e?.duration||Number.POSITIVE_INFINITY)?t:e,e[0]||null),i=e.filter(e=>e.error).length;return{totalRequests:t,averageDuration:o,slowestRequest:r,fastestRequest:n,errorRate:t>0?i/t:0,totalDataTransferred:e.reduce((e,t)=>e+(t.size||0),0)}}clearLogs(){this.requestLogs.clear(),this.responseLogs=[],this.events=[],this.performanceData.clear()}exportLogs(){return JSON.stringify({requests:this.getRequestLogs(),responses:this.getResponseLogs(),events:this.getEvents(),performance:this.getPerformanceReport(),timestamp:Date.now()},null,2)}updateConfig(e){Object.assign(this.config,e)}getConfig(){return{...this.config}}generateId(){return`${Date.now()}-${Math.random().toString(36).slice(2,11)}`}findRequestId(e){for(const[t,s]of this.requestLogs.entries())if(s.config===e)return t;return null}estimateSize(e){if(!e)return 0;if("string"==typeof e)return e.length;if(e instanceof Blob)return e.size;if(e instanceof ArrayBuffer)return e.byteLength;try{return JSON.stringify(e).length}catch{return 0}}trimLogs(){if(this.responseLogs.length>this.config?.maxLogs&&(this.responseLogs=this.responseLogs.slice(-this.config?.maxLogs)),this.requestLogs.size>this.config?.maxLogs){const e=this.requestLogs.size-this.config?.maxLogs,t=Array.from(this.requestLogs.keys());for(let s=0;s<e;s++)this.requestLogs.delete(t[s])}}}exports.HttpDebugger=t,exports.createDebugInterceptor=function(e){const s=new t(e);return{request:e=>(s.recordEvent({type:"request",data:e,timestamp:Date.now(),level:exports.DebugLevel.DEBUG}),e),response:e=>(s.recordEvent({type:"response",data:e,timestamp:Date.now(),level:exports.DebugLevel.DEBUG}),e),error:e=>(s.recordEvent({type:"error",data:e,timestamp:Date.now(),level:exports.DebugLevel.ERROR}),Promise.reject(e)),debugger:s}},exports.createHttpDebugger=function(e){return new t(e)};
//# sourceMappingURL=debugger.cjs.map
