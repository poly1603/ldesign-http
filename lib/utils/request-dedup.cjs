"use strict";class e{constructor(e={}){this.keyCache=new WeakMap,this.stringKeyCache=new Map,this.maxCacheSize=1e3,this.config={includeMethod:!0,includeUrl:!0,includeParams:!0,includeData:!1,includeHeaders:!1,specificHeaders:[],customGenerator:e.customGenerator,...e}}generate(e){const t=this.keyCache.get(e);if(t)return t;const r=this.generateKey(e);return this.keyCache.set(e,r),this.cacheStringKey(r),r}generateKey(e){if(this.config?.customGenerator)return this.config?.customGenerator(e);const t=[];if(this.config?.includeMethod&&e.method&&t.push(`method:${e.method.toUpperCase()}`),this.config?.includeUrl&&e.url&&t.push(`url:${e.url}`),this.config?.includeParams&&e.params){const r=this.serializeParams(e.params);r&&t.push(`params:${r}`)}if(this.config?.includeData&&e.data){const r=this.serializeData(e.data);r&&t.push(`data:${r}`)}if(this.config?.includeHeaders&&e.headers){const r=this.serializeHeaders(e.headers);r&&t.push(`headers:${r}`)}if(this.config?.specificHeaders.length>0&&e.headers){const r=this.serializeSpecificHeaders(e.headers,this.config?.specificHeaders);r&&t.push(`specific-headers:${r}`)}return t.join("|")}cacheStringKey(e){if(this.stringKeyCache.size>=this.maxCacheSize){const e=this.stringKeyCache.keys().next().value;void 0!==e&&this.stringKeyCache.delete(e)}this.stringKeyCache.set(e,e)}clearCache(){this.stringKeyCache.clear()}serializeParams(e){try{const t=Object.keys(e).sort(),r=t.length;if(0===r)return"";const s=Array.from({length:r},()=>"");for(let i=0;i<r;i++){const r=t[i];s[i]=`${r}:${JSON.stringify(e[r])}`}return s.join(",")}catch{return String(e)}}serializeData(e){try{if(e instanceof FormData){const t=[];for(const[r,s]of e.entries())t.push(`${r}:${"string"==typeof s?s:"[File]"}`);return t.sort().join(",")}if("object"==typeof e&&null!==e){const t=Object.keys(e).sort(),r=[];for(const s of t)r.push(`${s}:${JSON.stringify(e[s])}`);return r.join(",")}return String(e)}catch{return String(e)}}serializeHeaders(e){try{const t=new Set(["authorization","x-request-id","x-timestamp"]),r=[],s=Object.keys(e).sort();for(const i of s)t.has(i.toLowerCase())||r.push(`${i}:${e[i]}`);return r.join(",")}catch{return String(e)}}serializeSpecificHeaders(e,t){try{const r=[],s=[...t].sort();for(const t of s)void 0!==e[t]&&r.push(`${t}:${e[t]}`);return r.join(",")}catch{return""}}}const t=new e;exports.DeduplicationKeyGenerator=e,exports.createDeduplicationKeyGenerator=function(t){return new e(t)},exports.defaultKeyGenerator=t,exports.generateRequestKey=function(e){return t.generate(e)};
//# sourceMappingURL=request-dedup.cjs.map
