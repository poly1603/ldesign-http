"use strict";exports.DownloadProgressCalculator=class{constructor(){this.startTime=Date.now(),this.lastLoaded=0,this.lastTime=Date.now(),this.speeds=[]}calculate(e,t,o){const n=Date.now(),s=n-this.lastTime,i=e-this.lastLoaded,a=s>0?i/s*1e3:0;this.speeds.push(a),this.speeds.length>10&&this.speeds.shift();const r=this.speeds.reduce((e,t)=>e+t,0)/this.speeds.length,p=r>0?(t-e)/r:0;return this.lastLoaded=e,this.lastTime=n,{loaded:e,total:t,percentage:t>0?Math.round(e/t*100):0,speed:r,timeRemaining:p,elapsed:n-this.startTime,filename:o}}reset(){this.startTime=Date.now(),this.lastLoaded=0,this.lastTime=Date.now(),this.speeds=[]}},exports.createDownloadChunks=function(e,t){const o=[],n=Math.ceil(e/t);for(let s=0;s<n;s++){const n=s*t,i=Math.min(n+t-1,e-1);o.push({index:s,start:n,end:i,size:i-n+1,completed:!1})}return o},exports.createRangeHeader=function(e,t){return void 0!==t?`bytes=${e}-${t}`:`bytes=${e}-`},exports.formatDownloadSpeed=function(e){const t=["B/s","KB/s","MB/s","GB/s"];let o=e,n=0;for(;o>=1024&&n<t.length-1;)o/=1024,n++;return`${o.toFixed(1)} ${t[n]}`},exports.formatTimeRemaining=function(e){if(!Number.isFinite(e)||e<0)return"未知";if(e<60)return`${Math.round(e)}秒`;if(e<3600){return`${Math.floor(e/60)}分${Math.round(e%60)}秒`}return`${Math.floor(e/3600)}小时${Math.floor(e%3600/60)}分钟`},exports.getFilenameFromResponse=function(e){const t=e["content-disposition"]||e["Content-Disposition"];if(!t)return null;const o=t.match(/filename\*=UTF-8''(.+)/i);if(o)return decodeURIComponent(o[1]);const n=t.match(/filename="(.+)"/i);if(n)return n[1];const s=t.match(/filename=([^;]+)/i);return s?s[1].trim():null},exports.getFilenameFromURL=function(e){try{return(new URL(e).pathname.split("/").pop()||"download").split("?")[0]}catch{return"download"}},exports.getMimeTypeFromFilename=function(e){const t=e.split(".").pop()?.toLowerCase();return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",svg:"image/svg+xml",pdf:"application/pdf",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",txt:"text/plain",csv:"text/csv",json:"application/json",xml:"application/xml",html:"text/html",css:"text/css",js:"application/javascript",mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg",mp4:"video/mp4",avi:"video/x-msvideo",mov:"video/quicktime",zip:"application/zip",rar:"application/x-rar-compressed","7z":"application/x-7z-compressed",tar:"application/x-tar",gz:"application/gzip"}[t||""]||"application/octet-stream"},exports.isPreviewableFile=function(e){const t=e.split(".").pop()?.toLowerCase();return["jpg","jpeg","png","gif","webp","svg","pdf","txt","json","xml","html","css","js","mp3","wav","ogg","mp4","avi","mov"].includes(t||"")},exports.mergeDownloadChunks=function(e){e.sort((e,t)=>e.index-t.index);const t=e.reduce((e,t)=>e+t.size,0),o=new Uint8Array(t);let n=0;for(const t of e)if(t.data){const e=new Uint8Array(t.data);o.set(e,n),n+=e.length}return o.buffer},exports.parseContentRange=function(e){const t=e.match(/bytes (\d+)-(\d+)\/(\d+)/);return t?{start:Number.parseInt(t[1],10),end:Number.parseInt(t[2],10),total:Number.parseInt(t[3],10)}:null},exports.saveFileToLocal=function(e,t){const o=URL.createObjectURL(e),n=document.createElement("a");n.href=o,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout(()=>{URL.revokeObjectURL(o)},100)},exports.supportsRangeRequests=function(e){return"bytes"===(e["accept-ranges"]||e["Accept-Ranges"])};
//# sourceMappingURL=download.cjs.map
