{"version":3,"file":"index.cjs","sources":["../../src/types/index.ts"],"sourcesContent":["import type { DownloadConfig, DownloadResult } from '../utils/download'\r\nimport type { UploadConfig, UploadResult } from '../utils/upload'\r\n\r\n/**\r\n * HTTP 请求方法类型\r\n */\r\nexport type HttpMethod =\r\n  | 'GET'\r\n  | 'POST'\r\n  | 'PUT'\r\n  | 'DELETE'\r\n  | 'PATCH'\r\n  | 'HEAD'\r\n  | 'OPTIONS'\r\n\r\n/**\r\n * 请求配置接口\r\n */\r\nexport interface RequestConfig {\r\n  /** 请求 URL */\r\n  url?: string\r\n  /** HTTP 方法 */\r\n  method?: HttpMethod\r\n  /** 请求头 */\r\n  headers?: Record<string, string>\r\n  /** 请求参数（GET 请求的查询参数） */\r\n  params?: Record<string, unknown>\r\n  /** 请求体数据 */\r\n  data?: unknown\r\n  /** 超时时间（毫秒） */\r\n  timeout?: number\r\n  /** 基础 URL */\r\n  baseURL?: string\r\n  /** 响应类型 */\r\n  responseType?: 'json' | 'text' | 'blob' | 'arrayBuffer' | 'stream'\r\n  /** 是否携带凭证 */\r\n  withCredentials?: boolean\r\n  /** 取消令牌 */\r\n  signal?: AbortSignal\r\n  /** 请求优先级 */\r\n  priority?: number\r\n  /** 自定义配置 */\r\n  [key: string]: unknown\r\n}\r\n\r\n/**\r\n * 响应数据接口\r\n */\r\nexport interface ResponseData<T = unknown> {\r\n  /** 响应数据 */\r\n  data: T\r\n  /** 状态码 */\r\n  status: number\r\n  /** 状态文本 */\r\n  statusText: string\r\n  /** 响应头 */\r\n  headers: Record<string, string>\r\n  /** 请求配置 */\r\n  config: RequestConfig\r\n  /** 原始响应对象 */\r\n  raw?: unknown\r\n}\r\n\r\n/**\r\n * 错误信息接口\r\n */\r\nexport interface HttpError extends Error {\r\n  /** 错误代码 */\r\n  code?: string\r\n  /** HTTP状态码 */\r\n  status?: number\r\n  /** 请求配置 */\r\n  config?: RequestConfig\r\n  /** 响应数据 */\r\n  response?: ResponseData\r\n  /** 是否为网络错误 */\r\n  isNetworkError?: boolean\r\n  /** 是否为超时错误 */\r\n  isTimeoutError?: boolean\r\n  /** 是否为取消错误 */\r\n  isCancelError?: boolean\r\n  /** 原始错误 */\r\n  cause?: Error\r\n}\r\n\r\n/**\r\n * 拦截器函数类型\r\n */\r\nexport interface RequestInterceptor {\r\n  (config: RequestConfig): RequestConfig | Promise<RequestConfig>\r\n}\r\n\r\nexport interface ResponseInterceptor<T = unknown> {\r\n  (response: ResponseData<T>): ResponseData<T> | Promise<ResponseData<T>>\r\n}\r\n\r\nexport interface ErrorInterceptor {\r\n  (error: HttpError): HttpError | Promise<HttpError>\r\n}\r\n\r\n/**\r\n * 拦截器管理器接口\r\n */\r\nexport interface InterceptorManager<T> {\r\n  use: (fulfilled: T, rejected?: ErrorInterceptor) => number\r\n  eject: (id: number) => void\r\n  clear: () => void\r\n}\r\n\r\n/**\r\n * 重试配置接口\r\n */\r\nexport interface RetryConfig {\r\n  /** 重试次数 */\r\n  retries?: number\r\n  /** 重试延迟（毫秒） */\r\n  retryDelay?: number\r\n  /** 重试条件函数 */\r\n  retryCondition?: (error: HttpError) => boolean\r\n  /** 重试延迟函数 */\r\n  retryDelayFunction?: (retryCount: number, error: HttpError) => number\r\n}\r\n\r\n/**\r\n * 缓存配置接口\r\n */\r\nexport interface CacheConfig {\r\n  /** 是否启用缓存 */\r\n  enabled?: boolean\r\n  /** 缓存时间（毫秒） */\r\n  ttl?: number\r\n  /** 缓存键生成函数 */\r\n  keyGenerator?: (config: RequestConfig) => string\r\n  /** 缓存存储接口 */\r\n  storage?: CacheStorage\r\n}\r\n\r\n/**\r\n * 缓存存储接口\r\n */\r\nexport interface CacheStorage {\r\n  get: (key: string) => Promise<unknown> | unknown\r\n  set: (key: string, value: unknown, ttl?: number) => Promise<void> | void\r\n  delete: (key: string) => Promise<void> | void\r\n  clear: () => Promise<void> | void\r\n  // 可选的批量删除方法，用于性能优化\r\n  deleteBatch?: (keys: string[]) => Promise<void> | void\r\n}\r\n\r\n/**\r\n * 并发控制配置\r\n */\r\nexport interface ConcurrencyConfig {\r\n  /** 最大并发数 */\r\n  maxConcurrent?: number\r\n  /** 队列大小限制 */\r\n  maxQueueSize?: number\r\n  /** 是否启用请求去重 */\r\n  deduplication?: boolean\r\n}\r\n\r\n/**\r\n * HTTP 客户端配置接口\r\n */\r\nexport interface HttpClientConfig extends RequestConfig {\r\n  /** 适配器名称或实例 */\r\n  adapter?: string | HttpAdapter\r\n  /** 重试配置 */\r\n  retry?: RetryConfig\r\n  /** 缓存配置 */\r\n  cache?: CacheConfig\r\n  /** 并发控制配置 */\r\n  concurrency?: ConcurrencyConfig\r\n  /** 性能监控配置 */\r\n  monitor?: unknown\r\n  /** 优先级队列配置 */\r\n  priorityQueue?: unknown\r\n  /** 连接池配置 */\r\n  connectionPool?: unknown\r\n}\r\n\r\n/**\r\n * HTTP 适配器接口\r\n */\r\nexport interface HttpAdapter {\r\n  /** 适配器名称 */\r\n  name: string\r\n  /** 发送请求 */\r\n  request: <T = unknown>(config: RequestConfig) => Promise<ResponseData<T>>\r\n  /** 是否支持该环境 */\r\n  isSupported: () => boolean\r\n}\r\n\r\n/**\r\n * HTTP 客户端接口\r\n */\r\nexport interface HttpClient {\r\n  /** 请求拦截器 */\r\n  interceptors: {\r\n    request: InterceptorManager<RequestInterceptor>\r\n    response: InterceptorManager<ResponseInterceptor>\r\n    error: InterceptorManager<ErrorInterceptor>\r\n  }\r\n\r\n  /** 发送请求 */\r\n  request: <T = unknown>(config: RequestConfig) => Promise<ResponseData<T>>\r\n\r\n  /** GET 请求 */\r\n  get: <T = unknown>(url: string, config?: RequestConfig) => Promise<ResponseData<T>>\r\n\r\n  /** POST 请求 */\r\n  post: <T = unknown, D = unknown>(\r\n    url: string,\r\n    data?: D,\r\n    config?: RequestConfig\r\n  ) => Promise<ResponseData<T>>\r\n\r\n  /** PUT 请求 */\r\n  put: <T = unknown, D = unknown>(\r\n    url: string,\r\n    data?: D,\r\n    config?: RequestConfig\r\n  ) => Promise<ResponseData<T>>\r\n\r\n  /** DELETE 请求 */\r\n  delete: <T = unknown>(url: string, config?: RequestConfig) => Promise<ResponseData<T>>\r\n\r\n  /** PATCH 请求 */\r\n  patch: <T = unknown, D = unknown>(\r\n    url: string,\r\n    data?: D,\r\n    config?: RequestConfig\r\n  ) => Promise<ResponseData<T>>\r\n\r\n  /** HEAD 请求 */\r\n  head: <T = unknown>(url: string, config?: RequestConfig) => Promise<ResponseData<T>>\r\n\r\n  /** OPTIONS 请求 */\r\n  options: <T = unknown>(\r\n    url: string,\r\n    config?: RequestConfig\r\n  ) => Promise<ResponseData<T>>\r\n\r\n  /** 取消所有请求 */\r\n  cancelAll: (reason?: string) => void\r\n\r\n  /** 获取活跃请求数量 */\r\n  getActiveRequestCount: () => number\r\n\r\n  /** 更新重试配置 */\r\n  updateRetryConfig: (config: Partial<RetryConfig>) => void\r\n\r\n  /** 获取当前配置 */\r\n  getConfig: () => HttpClientConfig\r\n\r\n  /** 清空缓存 */\r\n  clearCache: () => Promise<void>\r\n\r\n  /** 获取并发状态 */\r\n  getConcurrencyStatus: () => {\r\n    activeCount: number\r\n    queuedCount: number\r\n    maxConcurrent: number\r\n    maxQueueSize: number\r\n  }\r\n\r\n  /** 取消队列中的所有请求 */\r\n  cancelQueue: (reason?: string) => void\r\n\r\n  /** 上传文件 */\r\n  upload?: <T = unknown>(\r\n    url: string,\r\n    file: File | File[],\r\n    config?: UploadConfig\r\n  ) => Promise<UploadResult<T>>\r\n\r\n  /** 下载文件 */\r\n  download?: (url: string, config?: DownloadConfig) => Promise<DownloadResult>\r\n\r\n  /** 添加请求拦截器 */\r\n  addRequestInterceptor: (\r\n    fulfilled: (config: RequestConfig) => RequestConfig | Promise<RequestConfig>,\r\n    rejected?: (error: HttpError) => HttpError | Promise<HttpError>\r\n  ) => number\r\n\r\n  /** 添加响应拦截器 */\r\n  addResponseInterceptor: <T = unknown>(\r\n    fulfilled: (response: ResponseData<T>) => ResponseData<T> | Promise<ResponseData<T>>,\r\n    rejected?: (error: HttpError) => HttpError | Promise<HttpError>\r\n  ) => number\r\n\r\n  /** 移除请求拦截器 */\r\n  removeRequestInterceptor: (id: number) => void\r\n\r\n  /** 移除响应拦截器 */\r\n  removeResponseInterceptor: (id: number) => void\r\n}\r\n\r\n/**\r\n * 严格类型的 HTTP 客户端接口\r\n */\r\nexport interface TypedHttpClient<TBaseResponse = unknown> extends Omit<HttpClient, 'upload' | 'download'> {\r\n  request: <T = TBaseResponse>(config: RequestConfig) => Promise<ResponseData<T>>\r\n  get: <T = TBaseResponse>(\r\n    url: string,\r\n    config?: RequestConfig\r\n  ) => Promise<ResponseData<T>>\r\n  post: <T = TBaseResponse, D = unknown>(\r\n    url: string,\r\n    data?: D,\r\n    config?: RequestConfig\r\n  ) => Promise<ResponseData<T>>\r\n  put: <T = TBaseResponse, D = unknown>(\r\n    url: string,\r\n    data?: D,\r\n    config?: RequestConfig\r\n  ) => Promise<ResponseData<T>>\r\n  delete: <T = TBaseResponse>(\r\n    url: string,\r\n    config?: RequestConfig\r\n  ) => Promise<ResponseData<T>>\r\n  patch: <T = TBaseResponse, D = unknown>(\r\n    url: string,\r\n    data?: D,\r\n    config?: RequestConfig\r\n  ) => Promise<ResponseData<T>>\r\n  head: <T = TBaseResponse>(\r\n    url: string,\r\n    config?: RequestConfig\r\n  ) => Promise<ResponseData<T>>\r\n  options: <T = TBaseResponse>(\r\n    url: string,\r\n    config?: RequestConfig\r\n  ) => Promise<ResponseData<T>>\r\n\r\n  /** 上传文件 */\r\n  upload?: <T = TBaseResponse>(\r\n    url: string,\r\n    file: File | File[],\r\n    config?: UploadConfig\r\n  ) => Promise<UploadResult<T>>\r\n\r\n  /** 下载文件 */\r\n  download?: (url: string, config?: DownloadConfig) => Promise<DownloadResult>\r\n}\r\n\r\n/**\r\n * API 端点配置\r\n */\r\nexport interface ApiEndpoint<TResponse = unknown, TRequest = unknown> {\r\n  url: string\r\n  method: HttpMethod\r\n  transform?: (data: unknown) => TResponse\r\n  validate?: (data: TRequest) => boolean\r\n}\r\n\r\n/**\r\n * 类型化的请求配置\r\n */\r\nexport interface TypedRequestConfig<TData = unknown>\r\n  extends Omit<RequestConfig, 'data'> {\r\n  data?: TData\r\n}\r\n\r\n/**\r\n * 类型化的响应数据\r\n */\r\nexport interface TypedResponseData<TData = unknown>\r\n  extends Omit<ResponseData, 'data'> {\r\n  data: TData\r\n}\r\n\r\n/**\r\n * 状态码类型\r\n */\r\nexport type HttpStatusCode =\r\n  | 200\r\n  | 201\r\n  | 202\r\n  | 204 // 成功\r\n  | 400\r\n  | 401\r\n  | 403\r\n  | 404\r\n  | 409\r\n  | 422\r\n  | 429 // 客户端错误\r\n  | 500\r\n  | 502\r\n  | 503\r\n  | 504 // 服务器错误\r\n\r\n/**\r\n * 内容类型枚举\r\n */\r\nexport enum ContentType {\r\n  JSON = 'application/json',\r\n  FORM = 'application/x-www-form-urlencoded',\r\n  MULTIPART = 'multipart/form-data',\r\n  TEXT = 'text/plain',\r\n  HTML = 'text/html',\r\n  XML = 'application/xml',\r\n  BINARY = 'application/octet-stream',\r\n}\r\n\r\n/**\r\n * 请求优先级\r\n */\r\nexport enum RequestPriority {\r\n  LOW = 'low',\r\n  NORMAL = 'normal',\r\n  HIGH = 'high',\r\n  CRITICAL = 'critical',\r\n}\r\n\r\n/**\r\n * 扩展的请求配置\r\n */\r\nexport interface ExtendedRequestConfig extends Omit<RequestConfig, 'priority'> {\r\n  /** 请求优先级 */\r\n  priority?: RequestPriority\r\n  /** 请求标签（用于分组和统计） */\r\n  tags?: string[]\r\n  /** 请求元数据 */\r\n  metadata?: Record<string, unknown>\r\n  /** 是否跳过拦截器 */\r\n  skipInterceptors?: boolean\r\n  /** 自定义验证函数 */\r\n  validate?: (response: ResponseData) => boolean\r\n}\r\n\r\n/**\r\n * 严格的类型化请求配置\r\n */\r\nexport interface StrictRequestConfig<TData = unknown, TParams = unknown> extends Omit<RequestConfig, 'data' | 'params'> {\r\n  /** 类型化的请求体数据 */\r\n  data?: TData\r\n  /** 类型化的请求参数 */\r\n  params?: TParams\r\n}\r\n\r\n/**\r\n * 严格的类型化响应数据\r\n */\r\nexport interface StrictResponseData<TData = unknown> extends Omit<ResponseData, 'data'> {\r\n  /** 类型化的响应数据 */\r\n  data: TData\r\n}\r\n\r\n/**\r\n * API 端点定义\r\n */\r\nexport interface ApiEndpointDefinition<TRequest = unknown, TResponse = unknown, TParams = unknown> {\r\n  /** 端点路径 */\r\n  path: string\r\n  /** HTTP 方法 */\r\n  method: HttpMethod\r\n  /** 请求数据类型 */\r\n  requestType?: new () => TRequest\r\n  /** 响应数据类型 */\r\n  responseType?: new () => TResponse\r\n  /** 参数类型 */\r\n  paramsType?: new () => TParams\r\n  /** 端点描述 */\r\n  description?: string\r\n  /** 是否需要认证 */\r\n  requiresAuth?: boolean\r\n  /** 缓存配置 */\r\n  cache?: CacheConfig\r\n  /** 重试配置 */\r\n  retry?: RetryConfig\r\n}\r\n\r\n/**\r\n * 类型化的 HTTP 客户端方法\r\n */\r\nexport interface TypedHttpMethods {\r\n  /** GET 请求 */\r\n  get: <TResponse = unknown, TParams = unknown>(\r\n    url: string,\r\n    config?: StrictRequestConfig<never, TParams>\r\n  ) => Promise<StrictResponseData<TResponse>>\r\n\r\n  /** POST 请求 */\r\n  post: <TResponse = unknown, TData = unknown, TParams = unknown>(\r\n    url: string,\r\n    data?: TData,\r\n    config?: StrictRequestConfig<TData, TParams>\r\n  ) => Promise<StrictResponseData<TResponse>>\r\n\r\n  /** PUT 请求 */\r\n  put: <TResponse = unknown, TData = unknown, TParams = unknown>(\r\n    url: string,\r\n    data?: TData,\r\n    config?: StrictRequestConfig<TData, TParams>\r\n  ) => Promise<StrictResponseData<TResponse>>\r\n\r\n  /** PATCH 请求 */\r\n  patch: <TResponse = unknown, TData = unknown, TParams = unknown>(\r\n    url: string,\r\n    data?: TData,\r\n    config?: StrictRequestConfig<TData, TParams>\r\n  ) => Promise<StrictResponseData<TResponse>>\r\n\r\n  /** DELETE 请求 */\r\n  delete: <TResponse = unknown, TParams = unknown>(\r\n    url: string,\r\n    config?: StrictRequestConfig<never, TParams>\r\n  ) => Promise<StrictResponseData<TResponse>>\r\n\r\n  /** HEAD 请求 */\r\n  head: <TParams = unknown>(\r\n    url: string,\r\n    config?: StrictRequestConfig<never, TParams>\r\n  ) => Promise<StrictResponseData<never>>\r\n\r\n  /** OPTIONS 请求 */\r\n  options: <TResponse = unknown, TParams = unknown>(\r\n    url: string,\r\n    config?: StrictRequestConfig<never, TParams>\r\n  ) => Promise<StrictResponseData<TResponse>>\r\n}\r\n\r\n/**\r\n * 条件类型：根据方法确定数据类型\r\n */\r\nexport type RequestDataByMethod<TMethod extends HttpMethod, TData = unknown> =\r\n  TMethod extends 'GET' | 'HEAD' | 'DELETE' ? never : TData\r\n\r\n/**\r\n * 条件类型：根据响应类型确定数据类型\r\n */\r\nexport type ResponseDataByType<TResponseType extends RequestConfig['responseType'], TData = unknown> =\r\n  TResponseType extends 'json' ? TData :\r\n    TResponseType extends 'text' ? string :\r\n      TResponseType extends 'blob' ? Blob :\r\n        TResponseType extends 'arrayBuffer' ? ArrayBuffer :\r\n          TResponseType extends 'stream' ? ReadableStream :\r\n            TData\r\n\r\n/**\r\n * 工具类型：提取 Promise 的类型\r\n */\r\nexport type Awaited<T> = T extends Promise<infer U> ? U : T\r\n\r\n/**\r\n * 工具类型：使某些属性必需\r\n */\r\nexport type RequiredKeys<T, K extends keyof T> = T & Required<Pick<T, K>>\r\n\r\n/**\r\n * 工具类型：深度只读\r\n */\r\nexport type DeepReadonly<T> = {\r\n  readonly [P in keyof T]: T[P] extends object ? DeepReadonly<T[P]> : T[P]\r\n}\r\n\r\n/**\r\n * 工具类型：深度可选\r\n */\r\nexport type DeepPartial<T> = {\r\n  [P in keyof T]?: T[P] extends object ? DeepPartial<T[P]> : T[P]\r\n}\r\n\r\n/**\r\n * 类型守卫：检查是否为 HTTP 错误\r\n */\r\nexport function isHttpError(error: unknown): error is HttpError {\r\n  return Boolean(error && typeof error === 'object' && 'config' in error)\r\n}\r\n\r\n/**\r\n * 类型守卫：检查是否为网络错误\r\n */\r\nexport function isNetworkError(error: unknown): error is HttpError & { isNetworkError: true } {\r\n  return isHttpError(error) && error.isNetworkError === true\r\n}\r\n\r\n/**\r\n * 类型守卫：检查是否为超时错误\r\n */\r\nexport function isTimeoutError(error: unknown): error is HttpError & { isTimeoutError: true } {\r\n  return isHttpError(error) && error.isTimeoutError === true\r\n}\r\n\r\n/**\r\n * 类型守卫：检查是否为取消错误\r\n */\r\nexport function isCancelError(error: unknown): error is HttpError & { isCancelError: true } {\r\n  return isHttpError(error) && error.isCancelError === true\r\n}\r\n\r\n/**\r\n * 类型守卫：检查响应状态码\r\n */\r\nexport function isSuccessStatus(status: number): status is 200 | 201 | 202 | 204 {\r\n  return status >= 200 && status < 300\r\n}\r\n\r\n/**\r\n * 类型守卫：检查是否为客户端错误\r\n */\r\nexport function isClientError(status: number): status is 400 | 401 | 403 | 404 | 409 | 422 | 429 {\r\n  return status >= 400 && status < 500\r\n}\r\n\r\n/**\r\n * 类型守卫：检查是否为服务器错误\r\n */\r\nexport function isServerError(status: number): status is 500 | 502 | 503 | 504 {\r\n  return status >= 500 && status < 600\r\n}\r\n\r\nexport type {\r\n  DownloadChunk,\r\n  DownloadConfig,\r\n  DownloadProgress,\r\n  DownloadResult,\r\n} from '../utils/download'\r\n\r\n// 重新导出上传下载相关类型\r\nexport type {\r\n  ChunkInfo,\r\n  FileValidationError,\r\n  UploadConfig,\r\n  UploadProgress,\r\n  UploadResult,\r\n} from '../utils/upload'\r\n"],"names":["ContentType","isHttpError","error","JSON","FORM","MULTIPART","TEXT","HTML","XML","BINARY","RequestPriority","LOW","NORMAL","HIGH","CRITICAL","isCancelError","status","isNetworkError","isTimeoutError"],"mappings":"aA2YYA,IAAAA,EA4KN,SAAUC,EAAYC,GAC1B,SAAeA,GAA0B,iBAAVA,KAAsB,WAAYA,GACnE,CA9KYF,QAAAA,iBAAAA,GAAAA,EAAAA,QAAAA,cAAAA,QAAAA,YAAW,KACrBG,KAAA,mBACAH,EAAAI,KAAA,oCACAJ,EAAAK,UAAA,sBACAL,EAAAM,KAAA,aACAN,EAAAO,KAAA,YACAP,EAAAQ,IAAA,kBACAR,EAAAS,OAAA,2BAMUC,QAAAA,qBAAAA,EAAAA,SAAAA,GACVA,EAAAC,IAAA,MACAD,EAAAE,OAAA,SACAF,EAAAG,KAAA,OACAH,EAAAI,SAAA,UACF,CALYJ,CAAAA,QAAAA,kBAAAA,QAAAA,gBAAe,CAAA,0BAoLrB,SAAwBR,GAC5B,OAAOD,EAAYC,KAAkC,IAAxBA,EAAMa,aACrC,iCAY8BC,GAC5B,OAAOA,GAAU,KAAOA,EAAS,GACnC,+CA9BM,SAAyBd,GAC7B,OAAOD,EAAYC,KAAmC,IAAzBA,EAAMe,cACrC,wBAiCM,SAAwBD,GAC5B,OAAOA,GAAU,KAAOA,EAAS,GACnC,0BAhBM,SAA0BA,GAC9B,OAAOA,GAAU,KAAOA,EAAS,GACnC,kCAhB+Bd,GAC7B,OAAOD,EAAYC,KAAmC,IAAzBA,EAAMgB,cACrC"}