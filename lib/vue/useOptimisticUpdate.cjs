"use strict";var e=require("vue");function t(t,l,a){const u=e.ref(!1),n=e.ref(null);let r=null,i=!1;return{execute:async(e,c)=>{try{u.value=!0,n.value=null,r=JSON.parse(JSON.stringify(l.value)),i=!0,l.value=a.optimisticUpdate(l.value,c);const s=await t.request(e);return i=!1,s.data&&(l.value=s.data),a.onSuccess?.(s.data),r=null,s.data}catch(e){if(n.value=e,null!==r){const e=r;l.value=e,a.onRollback?.(n.value||new Error("Rollback"),e),r=null}return null}finally{u.value=!1,i=!1}},rollback:()=>{if(null!==r){const e=r;l.value=e,a.onRollback?.(n.value||new Error("Rollback"),e),r=null}},loading:u,error:n,isOptimistic:e.ref(i)}}exports.useOptimisticList=function(l,a,u={}){const{idKey:n="id"}=u;return{add:async(e,u)=>{const{execute:n}=t(l,a,{optimisticUpdate:e=>[...e,u]});return await n(e,u),u},update:async(e,u,r)=>{const{execute:i}=t(l,a,{optimisticUpdate:e=>e.map(e=>e[n]===u?{...e,...r}:e)});return await i(e,r)&&a.value.find(e=>e[n]===u)||null},remove:async(e,u)=>{const{execute:r}=t(l,a,{optimisticUpdate:e=>e.filter(e=>e[n]!==u)});return null!==await r(e,u)},loading:e.ref(!1),error:e.ref(null)}},exports.useOptimisticUpdate=t;
//# sourceMappingURL=useOptimisticUpdate.cjs.map
