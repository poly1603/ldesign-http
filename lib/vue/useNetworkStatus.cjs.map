{"version":3,"file":"useNetworkStatus.cjs","sources":["../../src/vue/useNetworkStatus.ts"],"sourcesContent":["/**\r\n * Vue 网络状态 Composable\r\n *\r\n * 响应式的网络状态监听\r\n */\r\n\r\nimport type { Ref } from 'vue'\r\nimport { computed, onUnmounted, ref } from 'vue'\r\nimport {\r\n  ConnectionType,\r\n  createNetworkMonitor,\r\n  type NetworkInfo,\r\n  type NetworkMonitorConfig,\r\n  type NetworkStatus,\r\n} from '../utils/network'\r\n\r\n\r\n/**\r\n * 网络状态 Composable 返回值\r\n */\r\nexport interface UseNetworkStatusReturn {\r\n /** 是否在线 */\r\n isOnline: Ref<boolean>\r\n /** 是否离线 */\r\n isOffline: Ref<boolean>\r\n /** 网络状态 */\r\n status: Ref<NetworkStatus>\r\n /** 网络信息 */\r\n networkInfo: Ref<NetworkInfo>\r\n /** 是否适合大文件传输 */\r\n isSuitableForLargeTransfer: Ref<boolean>\r\n /** 是否是WiFi */\r\n isWifi: Ref<boolean>\r\n /** 是否是移动网络 */\r\n isCellular: Ref<boolean>\r\n /** 是否按流量计费 */\r\n isMetered: Ref<boolean>\r\n /** 刷新网络信息 */\r\n refresh: () => void\r\n}\r\n\r\n/**\r\n * 网络状态 Hook\r\n *\r\n * 响应式监听网络状态变化\r\n *\r\n * @example\r\n * ```vue\r\n * <script setup>\r\n * import { useNetworkStatus } from '@ldesign/http'\r\n *\r\n * const { isOnline, isOffline, networkInfo, isSuitableForLargeTransfer } = useNetworkStatus()\r\n * </script>\r\n *\r\n * <template>\r\n *  <div v-if=\"isOffline\" class=\"offline-banner\">\r\n *   您当前处于离线状态\r\n *  </div>\r\n *  <div v-if=\"!isSuitableForLargeTransfer\">\r\n *   当前网络状况不佳，建议稍后上传文件\r\n *  </div>\r\n * </template>\r\n * ```\r\n */\r\nexport function useNetworkStatus(config?: NetworkMonitorConfig): UseNetworkStatusReturn {\r\n const monitor = createNetworkMonitor(config)\r\n\r\n const isOnlineRef = ref(monitor.isOnline())\r\n const statusRef = ref(monitor.getStatus())\r\n const networkInfoRef = ref(monitor.getNetworkInfo())\r\n\r\n // 更新所有状态\r\n const updateStatus = () => {\r\n  isOnlineRef.value = monitor.isOnline()\r\n  statusRef.value = monitor.getStatus()\r\n  networkInfoRef.value = monitor.getNetworkInfo()\r\n }\r\n\r\n // 配置状态变化监听\r\n const monitorConfig: NetworkMonitorConfig = {\r\n  ...config,\r\n  onStatusChange: (status, info) => {\r\n   updateStatus()\r\n   config?.onStatusChange?.(status, info)\r\n  },\r\n }\r\n\r\n // 重新创建带回调的监听器\r\n const monitorWithCallback = createNetworkMonitor(monitorConfig)\r\n monitorWithCallback.start()\r\n\r\n // 计算属性\r\n const isOffline = computed(() => !isOnlineRef.value)\r\n const isSuitableForLargeTransfer = computed(() => monitorWithCallback.isSuitableForLargeTransfer())\r\n const isWifi = computed(() => networkInfoRef.value.connectionType === ConnectionType.WIFI)\r\n const isCellular = computed(() => {\r\n  const type = networkInfoRef.value.connectionType\r\n  return (\r\n   type === ConnectionType.CELLULAR_2G\r\n   || type === ConnectionType.CELLULAR_3G\r\n   || type === ConnectionType.CELLULAR_4G\r\n  )\r\n })\r\n const isMetered = computed(() => networkInfoRef.value.metered)\r\n\r\n // 组件卸载时停止监听\r\n onUnmounted(() => {\r\n  monitorWithCallback.destroy()\r\n })\r\n\r\n return {\r\n  isOnline: isOnlineRef,\r\n  isOffline,\r\n  status: statusRef,\r\n  networkInfo: networkInfoRef,\r\n  isSuitableForLargeTransfer,\r\n  isWifi,\r\n  isCellular,\r\n  isMetered,\r\n  refresh: updateStatus,\r\n }\r\n}\r\n"],"names":["config","monitor","createNetworkMonitor","isOnlineRef","ref","isOnline","statusRef","getStatus","networkInfoRef","getNetworkInfo","updateStatus","value","monitorConfig","onStatusChange","status","info","monitorWithCallback","start","isOffline","computed","isSuitableForLargeTransfer","isWifi","connectionType","ConnectionType","WIFI","isCellular","type","CELLULAR_2G","CELLULAR_3G","CELLULAR_4G","isMetered","metered","onUnmounted","destroy","networkInfo","refresh"],"mappings":"sGAgEiCA,GAChC,MAAMC,EAAUC,EAAAA,qBAAqBF,GAE/BG,EAAcC,EAAAA,IAAIH,EAAQI,YAC1BC,EAAYF,EAAAA,IAAIH,EAAQM,aACxBC,EAAiBJ,EAAAA,IAAIH,EAAQQ,kBAG7BC,EAAe,KACpBP,EAAYQ,MAAQV,EAAQI,WAC5BC,EAAUK,MAAQV,EAAQM,YAC1BC,EAAeG,MAAQV,EAAQQ,kBAI1BG,EAAsC,IACxCZ,EACHa,eAAgB,CAACC,EAAQC,KACxBL,IACAV,GAAQa,iBAAiBC,EAAQC,KAK7BC,EAAsBd,EAAAA,qBAAqBU,GACjDI,EAAoBC,QAGpB,MAAMC,EAAYC,EAAAA,SAAS,KAAOhB,EAAYQ,OACxCS,EAA6BD,EAAAA,SAAS,IAAMH,EAAoBI,8BAChEC,EAASF,EAAAA,SAAS,IAAMX,EAAeG,MAAMW,iBAAmBC,EAAAA,eAAeC,MAC/EC,EAAaN,EAAAA,SAAS,KAC3B,MAAMO,EAAOlB,EAAeG,MAAMW,eAClC,OACCI,IAASH,EAAAA,eAAeI,aACrBD,IAASH,EAAAA,eAAeK,aACxBF,IAASH,EAAAA,eAAeM,cAGvBC,EAAYX,EAAAA,SAAS,IAAMX,EAAeG,MAAMoB,SAGtD,OAAAC,EAAAA,YAAY,KACXhB,EAAoBiB,YAGd,CACN5B,SAAUF,EACVe,UAAAA,EACAJ,OAAQR,EACR4B,YAAa1B,EACbY,2BAAAA,EACAC,OAAAA,EACAI,WAAAA,EACAK,UAAAA,EACAK,QAASzB,EAEX"}