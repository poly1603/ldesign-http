"use strict";var e=require("vue"),n=require("../utils/cancel.cjs");exports.useAsyncRequest=function(a,l,t={}){const u=e.ref(t.initialData??null),r=e.ref(!1),c=e.ref(null),o=e.ref(!1);let i=n.createCancelTokenSource();const s=e.computed(()=>r.value),f=async()=>{r.value=!0,c.value=null,o.value=!1,i=n.createCancelTokenSource();try{const e=await l();let n=e.data;return"function"==typeof t.transform&&(n=t.transform(e.data)),u.value=n,o.value=!0,"function"==typeof t.onSuccess&&t.onSuccess(n,e),e}catch(e){const a=e;throw n.isCancelError(a)||(c.value=a,o.value=!0,"function"==typeof t.onError&&t.onError(a)),a}finally{r.value=!1,"function"==typeof t.onFinally&&t.onFinally()}},v=f,y=()=>{s.value&&i.cancel("Request cancelled by user")};return!1!==t.cancelOnUnmount&&e.onUnmounted(()=>{y()}),{data:u,loading:r,error:c,finished:o,execute:f,refresh:v,cancel:y,reset:()=>{u.value=t.initialData??null,r.value=!1,c.value=null,o.value=!1},canCancel:s}},exports.useRequest=function(a,l,t={}){const u=e.ref(t.initialData??null),r=e.ref(!1),c=e.ref(null),o=e.ref(!1);let i=n.createCancelTokenSource();const s=e.computed(()=>r.value),f=async s=>{r.value=!0,c.value=null,o.value=!1,i=n.createCancelTokenSource();try{const n={...e.unref(l),...s,signal:i.token.promise},r=await a.request(n);let c=r.data;return"function"==typeof t.transform&&(c=t.transform(r.data)),u.value=c,o.value=!0,"function"==typeof t.onSuccess&&t.onSuccess(c,r),r}catch(e){const a=e;throw n.isCancelError(a)||(c.value=a,o.value=!0,"function"==typeof t.onError&&t.onError(a)),a}finally{r.value=!1,"function"==typeof t.onFinally&&t.onFinally()}},v=()=>{s.value&&i.cancel("Request cancelled by user")};return!1!==t.immediate&&e.watch(()=>e.unref(l),()=>{f()},{immediate:!0,deep:!0}),!1!==t.cancelOnUnmount&&e.onUnmounted(()=>{v()}),{data:u,loading:r,error:c,finished:o,execute:f,refresh:()=>f(),cancel:v,reset:()=>{u.value=t.initialData??null,r.value=!1,c.value=null,o.value=!1},canCancel:s}};
//# sourceMappingURL=useRequest.cjs.map
