"use strict";var e=require("vue"),a=require("../factory.cjs");exports.useResource=function(n,t={}){const r=a.createHttpClient(t.clientConfig),l=e.ref([]),u=e.ref(null),s=e.ref(!1),c=e.ref(null),o=e.computed(()=>null!==c.value);let i=null;const f=async(e,a)=>{try{s.value=!0,c.value=null,i&&i.abort(),i=new AbortController;const n=await a();return("list"===e||"get"===e)&&t.onSuccess?.(n,e),n}catch(a){const n=a;return"AbortError"!==n.name&&(c.value=n,t.onError?.(n,e)),null}finally{s.value=!1}},v=async a=>await f("list",async()=>{const u={...a,signal:i?.signal};let s=(await r.get(e.unref(n),u)).data;return t.transform&&(s=Array.isArray(s)?s.map(t.transform):s),l.value=s,s})||[];return!1!==t.immediate&&e.watch(()=>e.unref(n),()=>{v()},{immediate:!0}),!1!==t.cancelOnUnmount&&e.onUnmounted(()=>{i&&i.abort()}),{items:l,current:u,loading:s,error:c,hasError:o,list:v,get:async(a,l)=>await f("get",async()=>{const s=`${e.unref(n)}/${a}`,c={...l,signal:i?.signal};let o=(await r.get(s,c)).data;return t.transform&&(o=t.transform(o)),u.value=o,o}),create:async(a,s)=>await f("create",async()=>{const c={...s,signal:i?.signal};let o=(await r.post(e.unref(n),a,c)).data;return t.transform&&(o=t.transform(o)),l.value.push(o),u.value=o,t.onSuccess?.(o,"create"),o}),update:async(a,s,c)=>await f("update",async()=>{const o=`${e.unref(n)}/${a}`,f={...c,signal:i?.signal};let v=(await r.put(o,s,f)).data;t.transform&&(v=t.transform(v));const d=l.value.findIndex(e=>e.id===a);return-1!==d&&(l.value[d]=v),u.value=v,t.onSuccess?.(v,"update"),v}),remove:async(a,s)=>null!==await f("delete",async()=>{const c=`${e.unref(n)}/${a}`,o={...s,signal:i?.signal};await r.delete(c,o);const f=l.value.findIndex(e=>e.id===a);return-1!==f&&l.value.splice(f,1),u.value&&u.value.id===a&&(u.value=null),t.onSuccess?.(null,"delete"),!0}),reset:()=>{l.value=[],u.value=null,s.value=!1,c.value=null},clearError:()=>{c.value=null},refresh:()=>v()}};
//# sourceMappingURL=useResource.cjs.map
