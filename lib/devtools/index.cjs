"use strict";var e=require("../utils/logger.cjs");const o=typeof window<"u"?{}:globalThis.process?.env||{};class t{constructor(e={}){this.records=[],this.client=null,this.interceptorIds=null,this.config={enabled:e.enabled??("production"!==o.NODE_ENV&&"production"!==o.MODE),maxRecords:e.maxRecords??100,showConsole:e.showConsole??!0,logToConsole:e.logToConsole??!0,performanceThreshold:e.performanceThreshold??1e3},typeof window<"u"&&this.config?.enabled&&(window.__HTTP_DEVTOOLS__=this)}attach(o){if(!this.config?.enabled||this.client)return;this.client=o;const t=o.addRequestInterceptor(e=>(this.onRequestStart(e),e)),r=o.addResponseInterceptor(e=>(this.onRequestSuccess(e),e),e=>{throw this.onRequestError(e),e});this.interceptorIds={request:t,response:r,error:-1},this.config?.logToConsole&&e.logger.info("DevTools attached to HTTP client")}detach(){!this.client||!this.interceptorIds||(this.client.removeRequestInterceptor(this.interceptorIds.request),this.client.removeResponseInterceptor(this.interceptorIds.response),this.client=null,this.interceptorIds=null,this.config?.logToConsole&&e.logger.info("DevTools detached from HTTP client"))}onRequestStart(o){const t=this.generateId(),r={id:t,timestamp:Date.now(),config:o,status:"pending"};o.__devtools_id__=t,this.addRecord(r),this.config?.logToConsole&&(e.logger.group(`âž¡ï¸ ${o.method?.toUpperCase()} ${o.url}`),e.logger.debug("Config:",o),e.logger.groupEnd())}onRequestSuccess(o){const t=o.config.__devtools_id__;if(!t)return;const r=this.findRecord(t);if(r&&(r.duration=Date.now()-r.timestamp,r.response=o,r.status="success",this.config?.logToConsole)){const t=r.duration>this.config?.performanceThreshold,s=t?"ðŸŒ":"âœ…";e.logger.group(`${s} ${o.config.method?.toUpperCase()} ${o.config.url} (${r.duration}ms)`),e.logger.debug("Status:",o.status),e.logger.debug("Data:",o.data),t&&e.logger.warn(`æ…¢è¯·æ±‚è­¦å‘Š: è€—æ—¶ ${r.duration}ms`),e.logger.groupEnd()}}onRequestError(o){const t=o.config.__devtools_id__;if(!t)return;const r=this.findRecord(t);r&&(r.duration=Date.now()-r.timestamp,r.error=o,r.status="error",this.config?.logToConsole&&(e.logger.group(`âŒ ${o.config?.method?.toUpperCase()} ${o.config?.url} (${r.duration}ms)`),e.logger.error("Error:",o.message),e.logger.error("Details:",o),e.logger.groupEnd()))}addRecord(e){this.records.unshift(e),this.records.length>this.config?.maxRecords&&(this.records=this.records.slice(0,this.config?.maxRecords))}findRecord(e){return this.records.find(o=>o.id===e)}generateId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getRecords(){return[...this.records]}getFailedRequests(){return this.records.filter(e=>"error"===e.status)}getSlowRequests(){return this.records.filter(e=>e.duration&&e.duration>this.config?.performanceThreshold)}getStats(){const e={total:this.records.length,pending:0,success:0,error:0,cancelled:0,averageDuration:0,slowRequests:0};let o=0,t=0;return this.records.forEach(r=>{e[r.status]++,r.duration&&(o+=r.duration,t++,r.duration>this.config?.performanceThreshold&&e.slowRequests++)}),t>0&&(e.averageDuration=Math.round(o/t)),e}clear(){this.records=[],this.config?.logToConsole&&e.logger.info("DevTools records cleared")}export(){const e={records:this.records,stats:this.getStats(),exportedAt:(new Date).toISOString()};return JSON.stringify(e,null,2)}download(){if(typeof window>"u")return void e.logger.warn("Download is only available in browser");const o=this.export(),t=new Blob([o],{type:"application/json"}),r=URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download=`http-devtools-${Date.now()}.json`,s.click(),URL.revokeObjectURL(r),e.logger.info("DevTools data exported")}printStats(){this.getStats()}}const r=new t;typeof window<"u"&&(window.httpDevTools={getRecords:()=>r.getRecords(),getStats:()=>r.getStats(),printStats:()=>r.printStats(),clear:()=>r.clear(),export:()=>r.download()}),exports.HttpDevTools=t,exports.createDevTools=function(e){return new t(e)},exports.globalDevTools=r;
//# sourceMappingURL=index.cjs.map
