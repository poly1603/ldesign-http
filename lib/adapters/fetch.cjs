"use strict";var t=require("../utils/index.cjs"),e=require("./base.cjs");class s extends e.BaseAdapter{constructor(){super(...arguments),this.name="fetch"}isSupported(){return typeof fetch<"u"&&typeof AbortController<"u"}async request(t){const e=this.processConfig(t);try{const t=this.createTimeoutController(e.timeout),s=this.mergeAbortSignals([e.signal,t.signal]),r={method:e.method,headers:this.buildHeaders(e),signal:s,credentials:e.withCredentials?"include":"same-origin"};e.data&&"GET"!==e.method&&"HEAD"!==e.method&&(r.body=this.buildBody(e.data,e.headers));const a=await fetch(e.url,r);return t.cleanup(),await this.handleResponse(a,e)}catch(t){throw this.processError(t,e)}}buildHeaders(e){const s={...e.headers};return e.data&&!s["content-type"]&&!s["Content-Type"]&&("string"==typeof e.data?s["Content-Type"]="text/plain":t.isFormData(e.data)?delete s["Content-Type"]:t.isURLSearchParams(e.data)?s["Content-Type"]="application/x-www-form-urlencoded":"object"==typeof e.data&&(s["Content-Type"]="application/json")),s}buildBody(e,s){if(null!=e){if("string"==typeof e||t.isFormData(e)||t.isBlob(e)||t.isArrayBuffer(e)||t.isURLSearchParams(e)||e instanceof ReadableStream)return e;if((s?.["content-type"]||s?.["Content-Type"]||"").includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;return Object.keys(e).forEach(s=>{const r=e[s];null!=r&&t.append(s,String(r))}),t}return JSON.stringify(e)}}async handleResponse(t,e){const s=this.parseHeaders(t.headers),r=await this.parseResponseData(t,e.responseType);if(!t.ok)throw this.processError(new Error(`Request failed with status ${t.status}`),e,this.processResponse(r,t.status,t.statusText,s,e,t));return this.processResponse(r,t.status,t.statusText,s,e,t)}async parseResponseData(t,e){if(!t.body)return null;try{switch(e){case"text":return await t.text();case"blob":return await t.blob();case"arrayBuffer":return await t.arrayBuffer();case"stream":return t.body;default:{const e=t.headers.get("content-type")||"";if(e.includes("application/json"))return await t.json();if(e.includes("text/"))return await t.text();{const e=await t.text();try{return JSON.parse(e)}catch{return e}}}}}catch{return null}}}exports.FetchAdapter=s;
//# sourceMappingURL=fetch.cjs.map
