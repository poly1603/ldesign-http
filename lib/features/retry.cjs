"use strict";const t={maxRetries:3,initialDelay:1e3,maxDelay:3e4,backoffMultiplier:2,enableJitter:!0,shouldRetry:(t,e)=>!!("NETWORK_ERROR"===t.code||"TIMEOUT"===t.code||t.response&&t.response.status>=500)};function e(t,e){if(e.delayCalculator)return e.delayCalculator(t,e);let r=e.initialDelay*e.backoffMultiplier**(t-1);return r=Math.min(r,e.maxDelay),e.enableJitter&&(r*=.5+.5*Math.random()),Math.floor(r)}function r(t){return new Promise(e=>setTimeout(e,t))}class a{constructor(e={}){this.config={...t,...e}}async execute(t){const a={attempt:0,totalDelay:0,errors:[],startTime:Date.now()};for(;a.attempt<=this.config?.maxRetries;){a.attempt++;try{return{success:!0,data:await t(),retryState:a}}catch(t){a.errors.push(t);const o=this.config?.shouldRetry?.(t,a.attempt)??!0;if(a.attempt>this.config?.maxRetries||!o)return{success:!1,error:t,retryState:a};const s=e(a.attempt,this.config);a.totalDelay+=s,await r(s)}}return{success:!1,error:a.errors[a.errors.length-1],retryState:a}}updateConfig(t){this.config={...this.config,...t}}getConfig(){return{...this.config}}}function o(t){return new a(t)}const s=o();exports.DEFAULT_RETRY_CONFIG=t,exports.RetryExecutor=a,exports.calculateDelay=e,exports.createRetryExecutor=o,exports.delay=r,exports.globalRetryExecutor=s,exports.retry=function(t){return function(e,r,a){const s=a.value,n=o(t);return a.value=async function(...t){const e=await n.execute(()=>s.apply(this,t));if(e.success)return e.data;throw e.error},a}},exports.retryOperation=async function(t,e){const r=await(e?o(e):s).execute(t);if(r.success)return r.data;throw r.error},exports.withRetry=function(t={}){const e={enabled:t.enabled??!0,maxAttempts:t.maxAttempts??3,delay:t.delay??1e3,backoffMultiplier:t.backoffMultiplier??2,delayFn:t.delayFn,shouldRetry:t.shouldRetry??t.condition??(t=>!!("NETWORK_ERROR"===t.code||"TIMEOUT"===t.code||"NetworkError"===t.name||t.isNetworkError||t.response?.status>=500&&t.response?.status<600||t.status>=500&&t.status<600))};return async function(t,a){const o=t?.retry||{},s={enabled:o.enabled??e.enabled,maxAttempts:o.maxAttempts??e.maxAttempts,delay:o.delay??e.delay,backoffMultiplier:o.backoffMultiplier??e.backoffMultiplier,delayFn:o.delayFn??e.delayFn,shouldRetry:o.shouldRetry??e.shouldRetry};if(!s.enabled||s.maxAttempts<=0)return a();let n,l=0;for(;l<s.maxAttempts;)try{return l++,await a()}catch(t){n=t;const e=1===s.shouldRetry.length?s.shouldRetry(t):s.shouldRetry(t,l);if(l>=s.maxAttempts||!e)throw t;let a;a=s.delayFn?s.delayFn(l):s.delay*s.backoffMultiplier**(l-1),await r(a)}throw n}};
//# sourceMappingURL=retry.cjs.map
