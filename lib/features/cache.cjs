"use strict";class t{constructor(t=100){this.cache=new Map,this.maxSize=t}async get(t){const e=this.cache.get(t);return e?Date.now()>e.timestamp+1e3*e.ttl?(this.cache.delete(t),null):e:null}async set(t,e){if(this.cache.size>=this.maxSize){const t=this.cache.keys().next().value;t&&this.cache.delete(t)}this.cache.set(t,e)}async delete(t){return this.cache.delete(t)}async clear(){this.cache.clear()}async keys(){return Array.from(this.cache.keys())}async size(){return this.cache.size}}class e{constructor(t="http_cache_"){this.prefix=t}async get(t){try{const e=localStorage.getItem(this.prefix+t);if(!e)return null;const s=JSON.parse(e);return Date.now()>s.timestamp+1e3*s.ttl?(await this.delete(t),null):s}catch{return null}}async set(t,e){try{localStorage.setItem(this.prefix+t,JSON.stringify(e))}catch{await this.cleanup();try{localStorage.setItem(this.prefix+t,JSON.stringify(e))}catch{}}}async delete(t){const e=null!==localStorage.getItem(this.prefix+t);return localStorage.removeItem(this.prefix+t),e}async clear(){(await this.keys()).forEach(t=>localStorage.removeItem(this.prefix+t))}async keys(){const t=[];for(let e=0;e<localStorage.length;e++){const s=localStorage.key(e);s&&s.startsWith(this.prefix)&&t.push(s.substring(this.prefix.length))}return t}async size(){return(await this.keys()).length}async cleanup(){const t=await this.keys(),e=Date.now();for(const s of t){const t=await this.get(s);(!t||e>t.timestamp+1e3*t.ttl)&&await this.delete(s)}}}class s{constructor(t={}){this.stats={hits:0,misses:0,size:0,hitRate:0},this.config={defaultTTL:300,maxSize:100,enableCompression:!1,strategy:"memory",...t},this.storage=this.createStorage()}createStorage(){switch(this.config?.strategy){case"localStorage":return new e;case"sessionStorage":return new e("session_http_cache_");default:return new t(this.config?.maxSize)}}generateKey(t,e){if(this.config?.keyGenerator)return this.config?.keyGenerator(t,e);return`${e.method||"GET"}:${t}:${e.params?JSON.stringify(e.params):""}:${e.headers?JSON.stringify(e.headers):""}`}async get(t,e={}){const s=this.generateKey(t,e),a=await this.storage.get(s);return a?(this.stats.hits++,this.updateStats(),a.data):(this.stats.misses++,this.updateStats(),null)}async set(t,e,s,a,r){const i=this.generateKey(t,e),n={data:s,timestamp:Date.now(),ttl:a||this.config?.defaultTTL,headers:r,size:this.calculateSize(s)};await this.storage.set(i,n),this.stats.size=await this.storage.size()}async delete(t,e={}){const s=this.generateKey(t,e),a=await this.storage.delete(s);return this.stats.size=await this.storage.size(),a}async clear(){await this.storage.clear(),this.stats.size=0,this.stats.hits=0,this.stats.misses=0,this.stats.hitRate=0}getStats(){return{...this.stats}}updateStats(){const t=this.stats.hits+this.stats.misses;this.stats.hitRate=t>0?this.stats.hits/t:0}calculateSize(t){try{return JSON.stringify(t).length}catch{return 0}}static isCacheable(t,e,s={}){if("GET"!==t.toUpperCase()||e<200||e>=300)return!1;const a=s["cache-control"]||s["Cache-Control"];return!(a&&(a.includes("no-cache")||a.includes("no-store")))}}function a(t){return new s(t)}const r=a();exports.HttpCacheManager=s,exports.LocalStorageCacheStorage=e,exports.MemoryCacheStorage=t,exports.createHttpCacheManager=a,exports.globalHttpCacheManager=r,exports.withCache=function(e={}){const s={enabled:e.enabled??!0,ttl:e.ttl??3e5,methods:e.methods??["GET"],keyGenerator:e.keyGenerator??(t=>`${t.method||"GET"}:${t.url||""}:${t.params?JSON.stringify(t.params):""}`),storage:e.storage??new t};return async function(t,e){const a=t?.cache||{},r={enabled:a.enabled??s.enabled,ttl:a.ttl??s.ttl,methods:a.methods??s.methods,keyGenerator:a.keyGenerator??s.keyGenerator,storage:a.storage??s.storage};if(!r.enabled||!r.methods.includes(t.method||"GET"))return e();const i=r.keyGenerator(t);try{const t=await r.storage.get(i);if(t&&Date.now()-t.timestamp<t.ttl)return t.data}catch(t){}const n=await e();if(n&&n.status>=200&&n.status<300)try{await r.storage.set(i,{data:n,timestamp:Date.now(),ttl:r.ttl,size:JSON.stringify(n).length})}catch(t){}return n}};
//# sourceMappingURL=cache.cjs.map
