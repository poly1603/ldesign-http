import{DownloadProgressCalculator as e,getFilenameFromResponse as a,getFilenameFromURL as o,getMimeTypeFromFilename as t,saveFileToLocal as r}from"./utils/download.js";import{validateFile as s,ProgressCalculator as n}from"./utils/upload.js";class l{constructor(e){this.client=e}async upload(e,a,o={}){let t,r;if(a instanceof FormData){t=a,r=[];for(const[,e]of t.entries())e instanceof File&&r.push(e)}else{r=Array.isArray(a)?a:[a],r.forEach(e=>s(e,o)),t=new FormData;const e=o.fileField||"files";r.forEach((a,o)=>{t.append(`${e}[${o}]`,a)}),o.formData&&Object.entries(o.formData).forEach(([e,a])=>{t.append(e,a)})}const l=Date.now(),i=new n,d={method:"POST",url:e,data:t,headers:{...o.headers||{}},...o||{},onUploadProgress:o.onProgress?e=>{const a=i.calculate(e.loaded,e.total);o.onProgress(a)}:void 0};return{...await this.client.request(d),file:r[0],duration:Date.now()-l}}async download(s,n={}){const l=Date.now(),i=new e,d={method:"GET",url:s,responseType:"blob",...n||{},onDownloadProgress:n.onProgress?e=>{const a=i.calculate(e.loaded,e.total,n.filename);n.onProgress(a)}:void 0},c=await this.client.request(d);let u=n.filename;u||(u=a(c.headers)||o(c.config.url||s)||"download");const f=c.data?.type||t(u);let m;return!1!==n.autoSave&&typeof window<"u"&&(r(c.data,u),m=URL.createObjectURL(c.data)),{data:c.data,filename:u,size:c.data.size,type:f,duration:Date.now()-l,url:m}}}function i(e){return new l(e)}export{l as FileOperationHandler,i as createFileOperationHandler};
//# sourceMappingURL=client-operations.js.map
