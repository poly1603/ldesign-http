{"version":3,"file":"manager.js","sources":["../../src/interceptors/manager.ts"],"sourcesContent":["import type { ErrorInterceptor, InterceptorManager } from '../types'\n\n/**\n * 拦截器项\n */\ninterface InterceptorItem<T> {\n  fulfilled: T\n  rejected?: ErrorInterceptor\n}\n\n/**\n * 拦截器管理器实现（优化版）\n *\n * 优化点：\n * 1. 使用紧凑数组替代稀疏数组，减少内存占用\n * 2. 使用 Map 存储 ID 映射，提高查找效率\n * 3. 删除时真正移除元素，避免内存泄漏\n * 4. 优化遍历性能，无需检查 null 值\n */\nexport class InterceptorManagerImpl<T> implements InterceptorManager<T> {\n  // 使用紧凑数组存储拦截器\n  private interceptors: Array<InterceptorItem<T>> = []\n  // ID 到数组索引的映射\n  private idMap = new Map<number, number>()\n  // 下一个可用的 ID\n  private nextId = 0\n\n  /**\n   * 添加拦截器\n   * @param fulfilled 成功处理函数\n   * @param rejected 错误处理函数\n   * @returns 拦截器 ID\n   */\n  use(fulfilled: T, rejected?: ErrorInterceptor): number {\n    const id = this.nextId++\n    const index = this.interceptors.length\n\n    this.interceptors.push({\n      fulfilled,\n      rejected,\n    })\n\n    this.idMap.set(id, index)\n    return id\n  }\n\n  /**\n   * 移除拦截器（优化版）\n   * @param id 拦截器 ID\n   */\n  eject(id: number): void {\n    const index = this.idMap.get(id)\n    if (index === undefined) {\n      return\n    }\n\n    // 移除元素（使用 splice 真正删除，而不是设为 null）\n    this.interceptors.splice(index, 1)\n    this.idMap.delete(id)\n\n    // 更新后续元素的索引映射\n    for (const [mappedId, mappedIndex] of this.idMap.entries()) {\n      if (mappedIndex > index) {\n        this.idMap.set(mappedId, mappedIndex - 1)\n      }\n    }\n  }\n\n  /**\n   * 清空所有拦截器\n   */\n  clear(): void {\n    this.interceptors = []\n    this.idMap.clear()\n  }\n\n  /**\n   * 遍历拦截器（高性能版 - 使用索引遍历）\n   * @param fn 遍历函数\n   */\n  forEach(fn: (interceptor: InterceptorItem<T>) => void): void {\n    // 使用索引遍历，比 for-of 更快\n    const len = this.interceptors.length\n    for (let i = 0; i < len; i++) {\n      fn(this.interceptors[i]!)\n    }\n  }\n\n  /**\n   * 获取所有有效的拦截器（优化版）\n   */\n  getInterceptors(): Array<InterceptorItem<T>> {\n    // 直接返回数组副本，无需过滤\n    return [...this.interceptors]\n  }\n\n  /**\n   * 获取拦截器数量\n   */\n  size(): number {\n    return this.interceptors.length\n  }\n\n  /**\n   * 检查是否有拦截器\n   */\n  isEmpty(): boolean {\n    return this.interceptors.length === 0\n  }\n}\n"],"names":["InterceptorManagerImpl","constructor","this","interceptors","idMap","Map","nextId","use","fulfilled","rejected","id","index","length","push","set","eject","get","splice","delete","mappedId","mappedIndex","entries","clear","forEach","fn","len","i","getInterceptors","size","isEmpty"],"mappings":"MAmBaA,EAAb,WAAAC,GAEUC,KAAAC,aAA0C,GAE1CD,KAAAE,MAAQ,IAAIC,IAEZH,KAAAI,OAAS,CAoFnB,CA5EE,GAAAC,CAAIC,EAAcC,GAChB,MAAMC,EAAKR,KAAKI,SACVK,EAAQT,KAAKC,aAAaS,OAEhC,OAAAV,KAAKC,aAAaU,KAAK,CACrBL,UAAAA,EACAC,SAAAA,IAGFP,KAAKE,MAAMU,IAAIJ,EAAIC,GACZD,CACT,CAMA,KAAAK,CAAML,GACJ,MAAMC,EAAQT,KAAKE,MAAMY,IAAIN,GAC7B,QAAc,IAAVC,EAKJ,MAAKR,aAAac,OAAON,EAAO,GAChCT,KAAKE,MAAMc,OAAOR,GAGlB,IAAA,MAAYS,EAAUC,KAAgBlB,KAAKE,MAAMiB,UAC3CD,EAAcT,GAChBT,KAAKE,MAAMU,IAAIK,EAAUC,EAAc,GAG7C,CAKA,KAAAE,GACEpB,KAAKC,aAAe,GACpBD,KAAKE,MAAMkB,OACb,CAMA,OAAAC,CAAQC,GAEN,MAAMC,EAAMvB,KAAKC,aAAaS,OAC9B,IAAA,IAASc,EAAI,EAAGA,EAAID,EAAKC,IACvBF,EAAGtB,KAAKC,aAAauB,GAEzB,CAKA,eAAAC,GAEE,MAAO,IAAIzB,KAAKC,aAClB,CAKA,IAAAyB,GACE,OAAO1B,KAAKC,aAAaS,MAC3B,CAKA,OAAAiB,GACE,OAAoC,IAA7B3B,KAAKC,aAAaS,MAC3B,SACDc"}