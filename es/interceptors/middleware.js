function e(e){return Array.isArray(e)&&0!==e.length?async t=>async function t(r,n){return r>=e.length?n:(0,e[r])(n,()=>t(r+1,n))}(0,t):e=>e}function t(e){return Array.isArray(e)&&0!==e.length?async t=>async function t(r,n){return r>=e.length?n:(0,e[r])(n,()=>t(r+1,n))}(0,t):e=>e}function r(e){return Array.isArray(e)&&0!==e.length?async t=>async function t(r,n){return r>=e.length?n:(0,e[r])(n,e=>t(r+1,e))}(0,t):e=>e}function n(e,t){return async(r,n)=>await e(r)?t(r,n):n()}function a(e,t){const r="string"==typeof e?t=>t.includes(e):t=>e.test(t);return n(e=>{const t=e.url||"";return r(t)},t)}function s(e,t){const r=new Set(e.map(e=>e.toUpperCase()));return n(e=>{const t=(e.method||"GET").toUpperCase();return r.has(t)},t)}function i(e){return async(t,r)=>{const n=Date.now();try{return await r()}finally{const r=Date.now()-n;e?.(r,t)}}}function c(e){const{ttl:t=6e4,keyGenerator:r,middleware:n}=e,a=new Map;return async(e,s)=>{const i=r(e),c=Date.now(),u=a.get(i);if(u&&u.expiry>c)return u.value;const o=await n(e,s);return a.set(i,{value:o,expiry:c+t}),o}}function u(e){const{maxAttempts:t=3,delay:r=1e3,shouldRetry:n=()=>!0,middleware:a}=e;return async(e,s)=>{let i;for(let c=1;c<=t;c++)try{return await a(e,s)}catch(e){if(i=e,!(c<t&&n(e,c)))throw e;await new Promise(e=>setTimeout(e,r*c))}throw i}}function o(e){return async(t,r)=>{let n=t;for(const t of e)n=await t(n);return r()}}class d{constructor(){this.middlewares=[]}use(e){return this.middlewares.push(e),this}when(e,t){return this.middlewares.push(n(e,t)),this}timing(e){return this.middlewares.push(i(e)),this}pipe(...e){return this.middlewares.push(o(e)),this}build(){const e=this.middlewares;return async(t,r)=>async function t(n,a){return n>=e.length?r():(0,e[n])(a,()=>t(n+1,a))}(0,t)}clear(){return this.middlewares=[],this}get size(){return this.middlewares.length}}export{d as MiddlewareBuilder,r as composeErrorMiddleware,e as composeRequestMiddleware,t as composeResponseMiddleware,c as createCacheMiddleware,n as createConditionalMiddleware,s as createMethodMatchMiddleware,a as createPathMatchMiddleware,o as createPipelineMiddleware,u as createRetryMiddleware,i as createTimingMiddleware};
//# sourceMappingURL=middleware.js.map
