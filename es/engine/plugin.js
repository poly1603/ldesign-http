import{createAdapter as e}from"../adapters/index.js";import{HttpClientImpl as t}from"../client.js";import{HttpPlugin as n}from"../vue/plugin.js";function o(o={}){const{name:i="http",version:l="1.0.0",clientConfig:r={},globalPropertyName:a="$http",client:p,globalConfig:g,...c}=o;return{name:i,version:l,dependencies:[],async install(o){try{if(o&&"object"==typeof o.config&&"function"==typeof o.provide){const n=o;await(async()=>{const o=p||(()=>{const n=e(r.adapter);return new t({...r,...g},n)})(),i={get:(e,t)=>o.get(e,t),post:(e,t,n)=>o.post(e,t,n),put:(e,t,n)=>o.put(e,t,n),delete:(e,t)=>o.delete(e,t),patch:(e,t,n)=>o.patch(e,t,n),head:(e,t)=>o.head(e,t),options:(e,t)=>o.options(e,t),upload:(e,t,n)=>o.upload?o.upload(e,t,n):o.post(e,t,n),download:(e,t)=>o.download?o.download(e,t):o.get(e,t)};try{n.config&&n.config.globalProperties&&(n.config.globalProperties.$http=i,n.config.globalProperties.$httpClient=o)}catch(e){}try{"function"==typeof n.provide&&(n.provide("http",i),n.provide("httpClient",o))}catch(e){}})()}else{const s=o.engine||o;if(!s||"function"!=typeof s.getApp)return;const u=async()=>{const o=s.getApp();if(!o)throw new Error("Vue app not found. Make sure the engine has created a Vue app before installing HTTP plugin.");const u=p||(()=>{const n=e(r.adapter);return new t({...r,...g},n)})();o.use(n,{client:u,globalConfig:g||r,globalProperty:a,...c}),s.http?s.http.setInstance(u):s.httpClient=u,s.logger&&s.logger.info(`${i} plugin installed successfully`,{version:l,clientType:u.constructor.name})};s.getApp()?(s.logger&&s.logger.info("[HTTP Plugin] Vue app found, installing immediately"),await u()):(s.logger&&s.logger.info("[HTTP Plugin] Vue app not found, registering event listener"),await new Promise((e,t)=>{s.events.once("app:created",async()=>{try{s.logger&&s.logger.info("[HTTP Plugin] app:created event received, installing now"),await u(),e()}catch(e){s.logger&&s.logger.error("[HTTP Plugin] Failed to install after app creation:",e),t(e)}})})),s.logger&&s.logger.info(`${i} plugin registered, waiting for Vue app creation...`)}}catch(e){throw e}},async uninstall(e){try{const t=e.engine||e;if(!t)throw new Error("Invalid engine context");if(t.httpClient){const e=t.httpClient;e.cancelAll(),e.clearCache(),delete t.httpClient}t.logger.info(`${i} plugin uninstalled successfully`)}catch(t){const n=e.engine||e;throw n&&n.logger&&n.logger.error(`Failed to uninstall ${i} plugin:`,t),t}}}}function i(e){return o(e)}const l=o({globalInjection:!0,globalPropertyName:"$http",clientConfig:{timeout:1e4,headers:{"Content-Type":"application/json"}}});function r(e){return o(e||{})}export{o as createHttpEnginePlugin,r as createHttpPlugin,l as defaultHttpEnginePlugin,i as httpPlugin};
//# sourceMappingURL=plugin.js.map
