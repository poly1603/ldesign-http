{"version":3,"file":"sse.js","sources":["../../src/features/sse.ts"],"sourcesContent":["/**\r\n * SSE 事件类型\r\n */\r\nexport interface SSEEvent {\r\n  /** 事件类型 */\r\n  type: string\r\n  /** 事件数据 */\r\n  data: string\r\n  /** 事件 ID */\r\n  id?: string\r\n  /** 重连延迟 */\r\n  retry?: number\r\n}\r\n\r\n/**\r\n * SSE 客户端配置\r\n */\r\nexport interface SSEClientConfig {\r\n  /** SSE 端点 URL */\r\n  url: string\r\n  /** 请求配置 */\r\n  withCredentials?: boolean\r\n  /** 自定义请求头 */\r\n  headers?: Record<string, string>\r\n  /** 自动重连 */\r\n  autoReconnect?: boolean\r\n  /** 重连延迟（毫秒） */\r\n  reconnectDelay?: number\r\n  /** 最大重连次数 */\r\n  maxReconnectAttempts?: number\r\n  /** 心跳超时（毫秒） */\r\n  heartbeatTimeout?: number\r\n  /** 调试模式 */\r\n  debug?: boolean\r\n}\r\n\r\n/**\r\n * SSE 连接状态\r\n */\r\nexport enum SSEStatus {\r\n  CONNECTING = 'connecting',\r\n  CONNECTED = 'connected',\r\n  DISCONNECTING = 'disconnecting',\r\n  DISCONNECTED = 'disconnected',\r\n  ERROR = 'error',\r\n}\r\n\r\n/**\r\n * SSE 事件监听器\r\n */\r\nexport type SSEEventListener<T = any> = (event: T) => void\r\n\r\n/**\r\n * SSE 客户端\r\n *\r\n * 提供 Server-Sent Events (SSE) 连接管理，支持自动重连、心跳检测等功能\r\n *\r\n * @example\r\n * ```typescript\r\n * const sseClient = new SSEClient({\r\n *   url: 'http://localhost:3000/events',\r\n *   autoReconnect: true,\r\n * })\r\n *\r\n * // 监听消息\r\n * sseClient.on('message', (event) => {\r\n *   \r\n * })\r\n *\r\n * // 监听自定义事件\r\n * sseClient.addEventListener('notification', (event) => {\r\n *   \r\n * })\r\n *\r\n * // 连接\r\n * await sseClient.connect()\r\n *\r\n * // 断开连接\r\n * sseClient.disconnect()\r\n * ```\r\n */\r\nexport class SSEClient {\r\n  private config: Required<SSEClientConfig>\r\n  private eventSource: EventSource | null = null\r\n  private status: SSEStatus = SSEStatus.DISCONNECTED\r\n  private eventListeners: Map<string, Set<SSEEventListener>> = new Map()\r\n  private reconnectAttempts = 0\r\n  private reconnectTimer: ReturnType<typeof setTimeout> | null = null\r\n  private heartbeatTimer: ReturnType<typeof setTimeout> | null = null\r\n  private lastEventId: string | null = null\r\n\r\n  constructor(config: SSEClientConfig) {\r\n    this.config = {\r\n      url: config.url,\r\n      withCredentials: config.withCredentials ?? false,\r\n      headers: config.headers || {},\r\n      autoReconnect: config.autoReconnect ?? true,\r\n      reconnectDelay: config.reconnectDelay ?? 3000,\r\n      maxReconnectAttempts: config.maxReconnectAttempts ?? 5,\r\n      heartbeatTimeout: config.heartbeatTimeout ?? 30000,\r\n      debug: config.debug ?? false,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 连接 SSE\r\n   */\r\n  async connect(): Promise<void> {\r\n    if (this.status === SSEStatus.CONNECTED || this.status === SSEStatus.CONNECTING) {\r\n      this.log('Already connected or connecting')\r\n      return\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.status = SSEStatus.CONNECTING\r\n      this.log(`Connecting to ${this.config?.url}`)\r\n\r\n      try {\r\n        // 构建 URL（添加 lastEventId 如果存在）\r\n        let url = this.config?.url\r\n        if (this.lastEventId) {\r\n          const separator = url.includes('?') ? '&' : '?'\r\n          url += `${separator}lastEventId=${encodeURIComponent(this.lastEventId)}`\r\n        }\r\n\r\n        // 创建 EventSource\r\n        this.eventSource = new EventSource(url, {\r\n          withCredentials: this.config?.withCredentials,\r\n        })\r\n\r\n        // 连接打开\r\n        this.eventSource.onopen = () => {\r\n          this.status = SSEStatus.CONNECTED\r\n          this.reconnectAttempts = 0\r\n          this.log('Connected')\r\n\r\n          // 启动心跳检测\r\n          this.startHeartbeat()\r\n\r\n          // 触发 open 事件\r\n          this.emit('open')\r\n          resolve()\r\n        }\r\n\r\n        // 接收消息\r\n        this.eventSource.onmessage = (event: MessageEvent) => {\r\n          this.handleMessage(event)\r\n        }\r\n\r\n        // 错误处理\r\n        this.eventSource.onerror = (error) => {\r\n          this.log('Error:', error)\r\n\r\n          if (this.status === SSEStatus.CONNECTING) {\r\n            // 连接失败\r\n            this.status = SSEStatus.ERROR\r\n            this.emit('error', error)\r\n            reject(error)\r\n          }\r\n          else {\r\n            // 连接断开\r\n            this.handleDisconnection()\r\n          }\r\n        }\r\n      }\r\n      catch (error) {\r\n        this.status = SSEStatus.ERROR\r\n        this.emit('error', error)\r\n        reject(error)\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 断开连接\r\n   */\r\n  disconnect(): void {\r\n    this.log('Disconnecting')\r\n\r\n    // 清除定时器\r\n    this.stopHeartbeat()\r\n    if (this.reconnectTimer) {\r\n      clearTimeout(this.reconnectTimer)\r\n      this.reconnectTimer = null\r\n    }\r\n\r\n    // 关闭连接\r\n    if (this.eventSource) {\r\n      this.status = SSEStatus.DISCONNECTING\r\n      this.eventSource.close()\r\n      this.eventSource = null\r\n    }\r\n\r\n    this.status = SSEStatus.DISCONNECTED\r\n    this.emit('close')\r\n  }\r\n\r\n  /**\r\n   * 监听默认消息事件\r\n   */\r\n  on(event: 'message' | 'open' | 'close' | 'error' | 'reconnect' | 'reconnecting' | 'reconnect_failed', listener: SSEEventListener): () => void {\r\n    return this.addEventListener(event, listener)\r\n  }\r\n\r\n  /**\r\n   * 监听自定义事件\r\n   */\r\n  addEventListener(event: string, listener: SSEEventListener): () => void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, new Set())\r\n    }\r\n    this.eventListeners.get(event)!.add(listener)\r\n\r\n    // 如果已连接，注册到 EventSource\r\n    if (this.eventSource && event !== 'open' && event !== 'close' && event !== 'error') {\r\n      this.eventSource.addEventListener(event, listener as any)\r\n    }\r\n\r\n    // 返回取消监听函数\r\n    return () => this.removeEventListener(event, listener)\r\n  }\r\n\r\n  /**\r\n   * 取消监听\r\n   */\r\n  removeEventListener(event: string, listener: SSEEventListener): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.delete(listener)\r\n    }\r\n\r\n    // 从 EventSource 移除\r\n    if (this.eventSource) {\r\n      this.eventSource.removeEventListener(event, listener as any)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 监听一次事件\r\n   */\r\n  once(event: string, listener: SSEEventListener): void {\r\n    const wrappedListener = (data: any) => {\r\n      listener(data)\r\n      this.removeEventListener(event, wrappedListener)\r\n    }\r\n    this.addEventListener(event, wrappedListener)\r\n  }\r\n\r\n  /**\r\n   * 获取连接状态\r\n   */\r\n  getStatus(): SSEStatus {\r\n    return this.status\r\n  }\r\n\r\n  /**\r\n   * 是否已连接\r\n   */\r\n  isConnected(): boolean {\r\n    return this.status === SSEStatus.CONNECTED\r\n  }\r\n\r\n  /**\r\n   * 获取重连次数\r\n   */\r\n  getReconnectAttempts(): number {\r\n    return this.reconnectAttempts\r\n  }\r\n\r\n  /**\r\n   * 获取最后的事件 ID\r\n   */\r\n  getLastEventId(): string | null {\r\n    return this.lastEventId\r\n  }\r\n\r\n  /**\r\n   * 更新配置\r\n   */\r\n  updateConfig(config: Partial<SSEClientConfig>): void {\r\n    Object.assign(this.config, config)\r\n\r\n    // 如果已连接且修改了心跳配置，重新启动心跳\r\n    if (this.isConnected() && config.heartbeatTimeout) {\r\n      this.stopHeartbeat()\r\n      this.startHeartbeat()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取原生 EventSource 实例\r\n   */\r\n  getEventSource(): EventSource | null {\r\n    return this.eventSource\r\n  }\r\n\r\n  /**\r\n   * 获取就绪状态\r\n   */\r\n  getReadyState(): number {\r\n    return this.eventSource?.readyState ?? EventSource.CLOSED\r\n  }\r\n\r\n  /**\r\n   * 触发事件\r\n   */\r\n  private emit(event: string, data?: any): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.forEach((listener) => {\r\n        try {\r\n          listener(data)\r\n        }\r\n        catch (error) {\r\n          this.log('Error in event listener:', error)\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 处理消息\r\n   */\r\n  private handleMessage(event: MessageEvent): void {\r\n    // 重置心跳定时器\r\n    this.resetHeartbeat()\r\n\r\n    // 保存最后的事件 ID\r\n    if (event.lastEventId) {\r\n      this.lastEventId = event.lastEventId\r\n    }\r\n\r\n    this.log('Message received:', event.data)\r\n    this.emit('message', {\r\n      type: event.type,\r\n      data: event.data,\r\n      id: event.lastEventId,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 处理断开连接\r\n   */\r\n  private handleDisconnection(): void {\r\n    this.stopHeartbeat()\r\n    this.status = SSEStatus.DISCONNECTED\r\n\r\n    // 触发 close 事件\r\n    this.emit('close')\r\n\r\n    // 自动重连\r\n    if (this.config?.autoReconnect && this.reconnectAttempts < this.config?.maxReconnectAttempts) {\r\n      this.reconnect()\r\n    }\r\n    else if (this.reconnectAttempts >= this.config?.maxReconnectAttempts) {\r\n      this.log('Max reconnect attempts reached')\r\n      this.emit('reconnect_failed')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 重连\r\n   */\r\n  private reconnect(): void {\r\n    this.reconnectAttempts++\r\n    this.log(`Reconnecting... (attempt ${this.reconnectAttempts}/${this.config?.maxReconnectAttempts})`)\r\n\r\n    this.emit('reconnecting', { attempts: this.reconnectAttempts })\r\n\r\n    // 关闭旧连接\r\n    if (this.eventSource) {\r\n      this.eventSource.close()\r\n      this.eventSource = null\r\n    }\r\n\r\n    this.reconnectTimer = setTimeout(async () => {\r\n      try {\r\n        await this.connect()\r\n        this.log('Reconnected successfully')\r\n        this.emit('reconnect')\r\n      }\r\n      catch (error) {\r\n        this.log('Reconnect failed:', error)\r\n        this.handleDisconnection()\r\n      }\r\n    }, this.config?.reconnectDelay * this.reconnectAttempts)\r\n  }\r\n\r\n  /**\r\n   * 启动心跳检测\r\n   */\r\n  private startHeartbeat(): void {\r\n    if (this.config?.heartbeatTimeout <= 0) {\r\n      return\r\n    }\r\n\r\n    this.heartbeatTimer = setTimeout(() => {\r\n      this.log('Heartbeat timeout')\r\n      // 心跳超时，认为连接已断开\r\n      this.handleDisconnection()\r\n    }, this.config?.heartbeatTimeout)\r\n  }\r\n\r\n  /**\r\n   * 停止心跳检测\r\n   */\r\n  private stopHeartbeat(): void {\r\n    if (this.heartbeatTimer) {\r\n      clearTimeout(this.heartbeatTimer)\r\n      this.heartbeatTimer = null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 重置心跳定时器\r\n   */\r\n  private resetHeartbeat(): void {\r\n    this.stopHeartbeat()\r\n    this.startHeartbeat()\r\n  }\r\n\r\n  /**\r\n   * 日志输出\r\n   */\r\n  private log(..._args: any[]): void {\r\n    if (this.config?.debug) {\r\n      // console.log('[SSE]', ...args)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 创建 SSE 客户端\r\n */\r\nexport function createSSEClient(config: SSEClientConfig): SSEClient {\r\n  return new SSEClient(config)\r\n}\r\n\r\n/**\r\n * 基础 SSE 客户端包装器\r\n */\r\nexport class BasicSSEClient {\r\n  private client: SSEClient\r\n  private handlers: Map<string, SSEEventListener[]> = new Map()\r\n\r\n  constructor(url: string, options?: Partial<SSEClientConfig>) {\r\n    this.client = new SSEClient({\r\n      url,\r\n      ...options,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 订阅事件流\r\n   */\r\n  async subscribe(eventType: string, handler: SSEEventListener): Promise<() => void> {\r\n    // 保存处理器\r\n    if (!this.handlers.has(eventType)) {\r\n      this.handlers.set(eventType, [])\r\n    }\r\n    this.handlers.get(eventType)!.push(handler)\r\n\r\n    // 连接（如果还未连接）\r\n    if (!this.client.isConnected()) {\r\n      await this.client.connect()\r\n    }\r\n\r\n    // 添加事件监听器\r\n    return this.client.addEventListener(eventType, handler)\r\n  }\r\n\r\n  /**\r\n   * 取消订阅\r\n   */\r\n  unsubscribe(eventType?: string): void {\r\n    if (eventType) {\r\n      // 取消指定事件的所有监听器\r\n      const handlers = this.handlers.get(eventType)\r\n      if (handlers) {\r\n        handlers.forEach((handler) => {\r\n          this.client.removeEventListener(eventType, handler)\r\n        })\r\n        this.handlers.delete(eventType)\r\n      }\r\n    }\r\n    else {\r\n      // 取消所有事件的监听器\r\n      this.handlers.forEach((handlers, event) => {\r\n        handlers.forEach((handler) => {\r\n          this.client.removeEventListener(event, handler)\r\n        })\r\n      })\r\n      this.handlers.clear()\r\n    }\r\n\r\n    // 如果没有任何监���器了，断开连接\r\n    if (this.handlers.size === 0) {\r\n      this.client.disconnect()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 断开连接\r\n   */\r\n  disconnect(): void {\r\n    this.unsubscribe()\r\n    this.client.disconnect()\r\n  }\r\n\r\n  /**\r\n   * 获取底层客户端\r\n   */\r\n  getClient(): SSEClient {\r\n    return this.client\r\n  }\r\n}\r\n\r\n/**\r\n * 创建基础 SSE 客户端\r\n */\r\nexport function createBasicSSEClient(url: string, options?: Partial<SSEClientConfig>): BasicSSEClient {\r\n  return new BasicSSEClient(url, options)\r\n}\r\n"],"names":["SSEStatus","CONNECTING","CONNECTED","DISCONNECTING","DISCONNECTED","ERROR","SSEClient","constructor","config","this","eventSource","status","eventListeners","Map","reconnectAttempts","reconnectTimer","heartbeatTimer","lastEventId","url","withCredentials","headers","autoReconnect","reconnectDelay","maxReconnectAttempts","heartbeatTimeout","debug","connect","Promise","resolve","reject","log","separator","includes","encodeURIComponent","EventSource","onopen","startHeartbeat","emit","onmessage","event","handleMessage","onerror","error","handleDisconnection","disconnect","stopHeartbeat","clearTimeout","close","on","listener","addEventListener","has","set","Set","get","add","removeEventListener","listeners","delete","once","wrappedListener","data","getStatus","isConnected","getReconnectAttempts","getLastEventId","updateConfig","Object","assign","getEventSource","getReadyState","readyState","CLOSED","forEach","resetHeartbeat","type","id","reconnect","attempts","setTimeout","async","_args","createSSEClient","BasicSSEClient","options","handlers","client","subscribe","eventType","handler","push","unsubscribe","clear","size","getClient","createBasicSSEClient","o","r","n","l","a"],"mappings":"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"}