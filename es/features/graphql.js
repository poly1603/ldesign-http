class e{constructor(e,t){this.batchQueue=[],this.batchTimer=null,this.httpClient=e,this.config={endpoint:t.endpoint,headers:t.headers||{},batching:t.batching??!1,batchDelay:t.batchDelay??10,debug:t.debug??!1}}async query(e,t,r){return this.request(e,t,void 0,r)}async mutate(e,t,r){return this.request(e,t,void 0,{...r,batching:!1})}async request(e,t,r,s){return s?.batching??this.config?.batching?this.batchRequest(e,t,r,s):this.singleRequest(e,t,r,s)}async singleRequest(e,r,s,a){const i=a?.endpoint||this.config?.endpoint;this.config;try{const n=(await this.httpClient.post(i,{query:e,variables:r,operationName:s},{...a,headers:{"Content-Type":"application/json",...this.config?.headers,...a?.headers}})).data;if(this.config?.debug&&n.errors,n.errors&&n.errors.length>0)throw new t(n.errors,n.data);return n}catch(e){throw e instanceof t?e:new t([{message:e.message||"GraphQL request failed",extensions:{originalError:e}}])}}async batchRequest(e,t,r,s){return new Promise((a,i)=>{if(this.batchQueue.push({query:e,variables:t,operationName:r,resolve:a,reject:i}),this.batchTimer)return;const n=s?.batchDelay??this.config?.batchDelay;this.batchTimer=setTimeout(()=>{this.executeBatch(s)},n)})}async executeBatch(e){const r=[...this.batchQueue];if(this.batchQueue=[],this.batchTimer=null,0===r.length)return;const s=e?.endpoint||this.config?.endpoint;this.config;try{const a=r.map(e=>({query:e.query,variables:e.variables,operationName:e.operationName}));(await this.httpClient.post(s,a,{...e,headers:{"Content-Type":"application/json",...this.config?.headers,...e?.headers}})).data.forEach((e,s)=>{const a=r[s];e.errors&&e.errors.length>0?a.reject(new t(e.errors,e.data)):a.resolve(e)})}catch(e){r.forEach(t=>{t.reject(e)})}}clearBatch(){this.batchTimer&&(clearTimeout(this.batchTimer),this.batchTimer=null),this.batchQueue=[]}getBatchQueueSize(){return this.batchQueue.length}updateConfig(e){Object.assign(this.config,e)}getConfig(){return{...this.config}}}class t extends Error{constructor(e,r){super(e.map(e=>e.message).join("\n")),this.name="GraphQLClientError",this.graphQLErrors=e,this.data=r,Object.setPrototypeOf(this,t.prototype)}hasErrorCode(e){return this.graphQLErrors.some(t=>t.extensions?.code===e)}getFirstError(){return this.graphQLErrors[0]}}function r(t,r){return new e(t,r)}function s(e){return e instanceof t}export{e as GraphQLClient,t as GraphQLClientError,r as createGraphQLClient,s as isGraphQLError};
//# sourceMappingURL=graphql.js.map
