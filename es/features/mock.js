class t{constructor(){this.rules=[],this.stats={totalMatches:0,ruleMatches:new Map,lastMatchTime:null},this.isApplied=!1}onGet(t){return this.on("GET",t)}onPost(t){return this.on("POST",t)}onPut(t){return this.on("PUT",t)}onDelete(t){return this.on("DELETE",t)}onPatch(t){return this.on("PATCH",t)}on(t,s){return new e(this,e=>e.method?.toUpperCase()===t.toUpperCase()&&this.matchURL(e.url||"",s))}onAny(t){return new e(this,t)}addRule(t){this.rules.push({enabled:!0,priority:0,...t}),this.rules.sort((t,e)=>(e.priority||0)-(t.priority||0))}removeRule(t){const e=this.rules.findIndex(e=>e.name===t);return-1!==e&&(this.rules.splice(e,1),!0)}clearRules(){this.rules=[]}enableRule(t){const e=this.rules.find(e=>e.name===t);return!!e&&(e.enabled=!0,!0)}disableRule(t){const e=this.rules.find(e=>e.name===t);return!!e&&(e.enabled=!1,!0)}getRules(){return[...this.rules]}getStats(){return{...this.stats}}resetStats(){this.stats={totalMatches:0,ruleMatches:new Map,lastMatchTime:null}}apply(t){if(this.isApplied)throw new Error("MockAdapter is already applied");this.originalRequest=t.request.bind(t),t.request=this.createMockRequest(this.originalRequest),this.isApplied=!0}restore(t){!this.isApplied||!this.originalRequest||(t.request=this.originalRequest,this.isApplied=!1,this.originalRequest=void 0)}createMockRequest(t){return async e=>{const s=this.findMatchingRule(e);if(s){if(this.updateStats(s),s.once){const t=this.rules.indexOf(s);-1!==t&&this.rules.splice(t,1)}let t;if(t="function"==typeof s.response?await s.response(e):s.response,t.delay&&t.delay>0&&await this.delay(t.delay),t.error)throw"string"==typeof t.error?new Error(t.error):t.error;return{data:t.data,status:t.status||200,statusText:t.statusText||"OK",headers:t.headers||{},config:e}}return t(e)}}findMatchingRule(t){for(const e of this.rules){if(!e.enabled)continue;let s=!1;if("function"==typeof e.matcher?s=e.matcher(t):("string"==typeof e.matcher||e.matcher instanceof RegExp)&&(s=this.matchURL(t.url||"",e.matcher)),s)return e}return null}matchURL(t,e){return"string"==typeof e?t===e||t.includes(e):e.test(t)}updateStats(t){if(this.stats.totalMatches++,this.stats.lastMatchTime=Date.now(),t.name){const e=this.stats.ruleMatches.get(t.name)||0;this.stats.ruleMatches.set(t.name,e+1)}}delay(t){return new Promise(e=>setTimeout(e,t))}}class e{constructor(t,e){this.ruleOnce=!1,this.adapter=t,this.matcher=e}name(t){return this.ruleName=t,this}priority(t){return this.rulePriority=t,this}once(){return this.ruleOnce=!0,this}reply(t,e,s){let r;r="function"==typeof t?t:"number"==typeof t?{status:t,data:e,headers:s}:t,this.adapter.addRule({matcher:this.matcher,response:r,name:this.ruleName,priority:this.rulePriority,once:this.ruleOnce})}replyWithError(t){this.reply({error:t})}delay(t){return new s(this,t)}}class s{constructor(t,e){this.builder=t,this.delayMs=e}reply(t,e,s){const r={status:t,data:e,headers:s,delay:this.delayMs};this.builder.reply(r)}replyWithError(t){this.builder.reply({error:t,delay:this.delayMs})}}function r(){return new t}function i(){return async t=>t}export{s as DelayedMockRuleBuilder,t as MockAdapter,e as MockRuleBuilder,r as createMockAdapter,i as createMockInterceptor};
//# sourceMappingURL=mock.js.map
