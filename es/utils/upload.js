class e extends Error{constructor(e,t,i){super(e),this.file=t,this.code=i,this.name="FileValidationError"}}function t(t,a){if(a.accept&&a.accept.length>0){const i=t.type,s=t.name.toLowerCase();if(!a.accept.some(e=>e.startsWith(".")?s.endsWith(e.toLowerCase()):!!e.includes("/")&&(i===e||i.startsWith(e.replace("*","")))))throw new e(`文件类型不被允许: ${i}`,t,"TYPE_NOT_ALLOWED")}if(a.maxSize&&t.size>a.maxSize)throw new e(`文件大小超出限制: ${i(t.size)} > ${i(a.maxSize)}`,t,"SIZE_TOO_LARGE");if(0===t.size)throw new e("文件为空",t,"INVALID_FILE")}function i(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return`${Number.parseFloat((e/1024**t).toFixed(2))} ${["B","KB","MB","GB","TB"][t]}`}function a(e){return e.slice((e.lastIndexOf(".")-1>>>0)+2)}async function s(e){const t=await e.arrayBuffer(),i=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(i)).map(e=>e.toString(16).padStart(2,"0")).join("")}function n(e,t){const i=[],a=Math.ceil(e.size/t);for(let s=0;s<a;s++){const a=s*t,n=Math.min(a+t,e.size),o=e.slice(a,n);i.push({index:s,chunk:o,size:o.size,start:a,end:n,fileHash:""})}return i}function o(e,t,i){const a=new FormData,s=t.fileField||"file";return i?(a.append(s,i.chunk,e.name),a.append("chunkIndex",i.index.toString()),a.append("totalChunks",Math.ceil(e.size/(t.chunkSize||e.size)).toString()),a.append("fileHash",i.fileHash)):a.append(s,e),t.formData&&Object.entries(t.formData).forEach(([e,t])=>{a.append(e,t)}),a.append("fileName",e.name),a.append("fileSize",e.size.toString()),a.append("fileType",e.type),a}class r{constructor(){this.startTime=Date.now(),this.lastLoaded=0,this.lastTime=Date.now(),this.speeds=[]}calculate(e,t,i){const a=Date.now(),s=a-this.lastTime,n=e-this.lastLoaded,o=s>0?n/s*1e3:0;this.speeds.push(o),this.speeds.length>10&&this.speeds.shift();const r=this.speeds.reduce((e,t)=>e+t,0)/this.speeds.length,l=r>0?(t-e)/r:0;return this.lastLoaded=e,this.lastTime=a,{loaded:e,total:t,percentage:t>0?Math.round(e/t*100):0,speed:r,timeRemaining:l,elapsed:a-this.startTime,file:i}}reset(){this.startTime=Date.now(),this.lastLoaded=0,this.lastTime=Date.now(),this.speeds=[]}}function l(e){return e.type.startsWith("image/")}function c(e){return e.type.startsWith("video/")}function p(e){return e.type.startsWith("audio/")}function d(e){return["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/plain","text/csv"].includes(e.type)}function h(e){return URL.createObjectURL(e)}function u(e){URL.revokeObjectURL(e)}export{e as FileValidationError,r as ProgressCalculator,n as createFileChunks,h as createFilePreviewURL,o as createUploadFormData,i as formatFileSize,s as generateFileHash,a as getFileExtension,p as isAudioFile,d as isDocumentFile,l as isImageFile,c as isVideoFile,u as revokeFilePreviewURL,t as validateFile};
//# sourceMappingURL=upload.js.map
