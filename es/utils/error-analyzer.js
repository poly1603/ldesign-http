class r{static analyzeErrorPatterns(r){if(0===r.length)return{patterns:[],recommendations:[],summary:{totalErrors:0,uniqueEndpoints:0,timeRange:{start:Date.now(),end:Date.now()}}};const e={},t=new Set;let n=Number.MAX_SAFE_INTEGER,s=0;const o=r.length;r.forEach(r=>{r.config?.url&&t.add(r.config.url);const o=r.timestamp||Date.now();n=Math.min(n,o),s=Math.max(s,o),r.isNetworkError&&(e.network_errors=(e.network_errors||0)+1),r.isTimeoutError&&(e.timeout_errors=(e.timeout_errors||0)+1);const a=r.response?.status;a&&(401===a?e.auth_errors=(e.auth_errors||0)+1:403===a?e.permission_errors=(e.permission_errors||0)+1:429===a?e.rate_limit_errors=(e.rate_limit_errors||0)+1:a>=500?e.server_errors=(e.server_errors||0)+1:a>=400&&a<500&&(e.client_errors=(e.client_errors||0)+1))});const a=Object.entries(e).map(([r,e])=>({type:r,count:e,percentage:Math.round(e/o*100),description:this.getPatternDescription(r)}));a.sort((r,e)=>e.count-r.count);const i=a[0]?{type:a[0].type,count:a[0].count}:void 0;return{patterns:a,recommendations:this.generateRecommendations(e,o),summary:{totalErrors:o,uniqueEndpoints:t.size,timeRange:{start:n,end:s},mostFrequentError:i}}}static getPatternDescription(r){return this.patternDescriptions[r]||"未知错误模式"}static generateRecommendations(r,e){const t=[];return r.network_errors>.3*e&&t.push("检测到大量网络错误，建议：\n1. 检查网络连接稳定性\n2. 验证服务器地址是否正确\n3. 考虑实现离线模式或缓存策略"),r.timeout_errors>.2*e&&t.push("检测到频繁超时，建议：\n1. 增加请求超时时间\n2. 优化服务器响应性能\n3. 实现请求重试机制"),r.auth_errors>.2*e&&t.push("检测到认证问题，建议：\n1. 实现令牌自动刷新机制\n2. 检查令牌有效期设置\n3. 优化登录流程"),r.server_errors>.3*e&&t.push("检测到服务器问题，建议：\n1. 检查服务器日志\n2. 监控服务器资源使用\n3. 实现服务降级策略"),r.rate_limit_errors>5&&t.push("检测到请求限流，建议：\n1. 实现请求队列和节流\n2. 使用批量API减少请求数\n3. 优化客户端缓存策略"),r.permission_errors>.1*e&&t.push("检测到权限问题，建议：\n1. 检查用户权限配置\n2. 验证API访问权限\n3. 优化权限错误提示"),r.client_errors>.4*e&&t.push("检测到大量客户端错误，建议：\n1. 检查请求参数验证\n2. 优化表单验证逻辑\n3. 改进错误提示信息"),0===t.length&&t.push("建议实施以下通用优化：\n1. 启用请求重试机制\n2. 实现错误监控和告警\n3. 优化错误处理和用户提示"),t}static generateErrorReport(r){const e=this.analyzeErrorPatterns(r);let t="# 错误分析报告\n\n";if(t+="## 摘要\n",t+=`- 总错误数: ${e.summary.totalErrors}\n`,t+=`- 影响端点数: ${e.summary.uniqueEndpoints}\n`,e.summary.timeRange){const r=e.summary.timeRange.end-e.summary.timeRange.start,n=Math.floor(r/36e5);t+=`- 时间跨度: ${n}小时\n`}return e.summary.mostFrequentError&&(t+=`- 最频繁错误: ${e.summary.mostFrequentError.type} (${e.summary.mostFrequentError.count}次)\n`),t+="\n",e.patterns.length>0&&(t+="## 错误模式\n",e.patterns.forEach(r=>{t+=`- **${r.type}** (${r.count}次, ${r.percentage}%): ${r.description}\n`}),t+="\n"),e.recommendations.length>0&&(t+="## 优化建议\n",e.recommendations.forEach((r,e)=>{t+=`### ${e+1}. ${r}\n`})),t}static predictErrorTrend(r){if(r.length<2)return{trend:"stable",rate:0};const e=[...r].sort((r,e)=>(r.timestamp||0)-(e.timestamp||0)),t=Math.floor(e.length/2),n=e.slice(0,t),s=e.slice(t),o=n.length/(t||1),a=s.length/(e.length-t)-o;return a>.2?{trend:"increasing",rate:a}:a<-.2?{trend:"decreasing",rate:Math.abs(a)}:{trend:"stable",rate:0}}}r.patternDescriptions={network_errors:"网络连接问题，可能是网络不稳定或服务器不可达",timeout_errors:"请求超时，可能是网络延迟高或服务器响应慢",auth_errors:"认证失败，可能是令牌过期或权限不足",server_errors:"服务器内部错误，可能是服务器故障或过载",client_errors:"客户端请求错误，可能是参数错误或请求格式不正确",rate_limit_errors:"请求频率超限，需要降低请求频率",permission_errors:"权限不足，需要检查用户权限配置"};export{r as ErrorAnalyzer};
//# sourceMappingURL=error-analyzer.js.map
