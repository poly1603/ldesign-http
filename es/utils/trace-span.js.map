{"version":3,"file":"trace-span.js","sources":["../../src/utils/trace-span.ts"],"sourcesContent":["/**\r\n * 追踪Span管理模块\r\n * \r\n * 提供Span的创建、管理和操作功能\r\n */\r\n\r\nimport { generateId } from './index'\r\n\r\n/**\r\n * 追踪span类型\r\n */\r\nexport enum SpanType {\r\n  /** HTTP请求 */\r\n  HTTP = 'http',\r\n  /** 数据库查询 */\r\n  DATABASE = 'database',\r\n  /** 缓存操作 */\r\n  CACHE = 'cache',\r\n  /** 自定义 */\r\n  CUSTOM = 'custom',\r\n  /** 中间件 */\r\n  MIDDLEWARE = 'middleware',\r\n  /** 服务调用 */\r\n  SERVICE = 'service',\r\n  /** 消息队列 */\r\n  MESSAGE = 'message',\r\n}\r\n\r\n/**\r\n * 追踪span状态\r\n */\r\nexport enum SpanStatus {\r\n  /** 进行中 */\r\n  PENDING = 'pending',\r\n  /** 成功 */\r\n  SUCCESS = 'success',\r\n  /** 失败 */\r\n  ERROR = 'error',\r\n  /** 取消 */\r\n  CANCELLED = 'cancelled',\r\n  /** 超时 */\r\n  TIMEOUT = 'timeout',\r\n  /** 警告 */\r\n  WARNING = 'warning',\r\n}\r\n\r\n/**\r\n * 追踪标签\r\n */\r\nexport interface TraceTag {\r\n  key: string\r\n  value: string | number | boolean\r\n}\r\n\r\n/**\r\n * 追踪日志\r\n */\r\nexport interface TraceLog {\r\n  timestamp: number\r\n  level?: 'debug' | 'info' | 'warn' | 'error'\r\n  message: string\r\n  data?: any\r\n}\r\n\r\n/**\r\n * 追踪事件\r\n */\r\nexport interface TraceEvent {\r\n  name: string\r\n  timestamp: number\r\n  attributes?: Record<string, any>\r\n}\r\n\r\n/**\r\n * 追踪span\r\n */\r\nexport interface TraceSpan {\r\n  /** Span ID */\r\n  spanId: string\r\n  /** 父Span ID */\r\n  parentSpanId?: string\r\n  /** Trace ID */\r\n  traceId: string\r\n  /** Span名称 */\r\n  name: string\r\n  /** Span类型 */\r\n  type: SpanType\r\n  /** 开始时间 */\r\n  startTime: number\r\n  /** 结束时间 */\r\n  endTime?: number\r\n  /** 持续时间(ms) */\r\n  duration?: number\r\n  /** 状态 */\r\n  status: SpanStatus\r\n  /** 标签 */\r\n  tags: TraceTag[]\r\n  /** 日志 */\r\n  logs: TraceLog[]\r\n  /** 事件 */\r\n  events?: TraceEvent[]\r\n  /** 错误信息 */\r\n  error?: { \r\n    message: string\r\n    stack?: string\r\n    code?: string | number\r\n    type?: string\r\n  }\r\n  /** 属性 */\r\n  attributes?: Record<string, any>\r\n  /** 子Span ID列表 */\r\n  childSpanIds?: string[]\r\n}\r\n\r\n/**\r\n * Span构建器\r\n */\r\nexport class SpanBuilder {\r\n  private span: TraceSpan\r\n\r\n  constructor(traceId: string, name: string, type: SpanType = SpanType.CUSTOM) {\r\n    this.span = {\r\n      spanId: this.generateSpanId(),\r\n      traceId,\r\n      name,\r\n      type,\r\n      startTime: Date.now(),\r\n      status: SpanStatus.PENDING,\r\n      tags: [],\r\n      logs: [],\r\n      events: [],\r\n      childSpanIds: [],\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置父Span\r\n   */\r\n  setParent(parentSpanId: string): this {\r\n    this.span.parentSpanId = parentSpanId\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 设置类型\r\n   */\r\n  setType(type: SpanType): this {\r\n    this.span.type = type\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 添加标签\r\n   */\r\n  addTag(key: string, value: string | number | boolean): this {\r\n    this.span.tags.push({ key, value })\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 批量添加标签\r\n   */\r\n  addTags(tags: Record<string, string | number | boolean>): this {\r\n    Object.entries(tags).forEach(([key, value]) => {\r\n      this.addTag(key, value)\r\n    })\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 设置属性\r\n   */\r\n  setAttribute(key: string, value: any): this {\r\n    if (!this.span.attributes) {\r\n      this.span.attributes = {}\r\n    }\r\n    this.span.attributes[key] = value\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 批量设置属性\r\n   */\r\n  setAttributes(attributes: Record<string, any>): this {\r\n    if (!this.span.attributes) {\r\n      this.span.attributes = {}\r\n    }\r\n    Object.assign(this.span.attributes, attributes)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 构建Span\r\n   */\r\n  build(): TraceSpan {\r\n    return { ...this.span }\r\n  }\r\n\r\n  private generateSpanId(): string {\r\n    return `span-${generateId()}`\r\n  }\r\n}\r\n\r\n/**\r\n * Span操作器\r\n */\r\nexport class SpanOperator {\r\n  constructor(private span: TraceSpan) {}\r\n\r\n  /**\r\n   * 添加标签\r\n   */\r\n  addTag(key: string, value: string | number | boolean): this {\r\n    this.span.tags.push({ key, value })\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 添加日志\r\n   */\r\n  addLog(message: string, data?: any, level: TraceLog['level'] = 'info'): this {\r\n    this.span.logs.push({\r\n      timestamp: Date.now(),\r\n      level,\r\n      message,\r\n      data,\r\n    })\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 添加事件\r\n   */\r\n  addEvent(name: string, attributes?: Record<string, any>): this {\r\n    if (!this.span.events) {\r\n      this.span.events = []\r\n    }\r\n    this.span.events.push({\r\n      name,\r\n      timestamp: Date.now(),\r\n      attributes,\r\n    })\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 设置错误\r\n   */\r\n  setError(error: Error | string | { message: string; code?: string | number; type?: string }): this {\r\n    this.span.status = SpanStatus.ERROR\r\n    \r\n    if (typeof error === 'string') {\r\n      this.span.error = { message: error }\r\n    } else if (error instanceof Error) {\r\n      this.span.error = {\r\n        message: error.message,\r\n        stack: error.stack,\r\n        type: error.name,\r\n      }\r\n    } else {\r\n      this.span.error = error\r\n    }\r\n    \r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 设置状态\r\n   */\r\n  setStatus(status: SpanStatus): this {\r\n    this.span.status = status\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 结束Span\r\n   */\r\n  finish(status?: SpanStatus): void {\r\n    const now = Date.now()\r\n    this.span.endTime = now\r\n    this.span.duration = now - this.span.startTime\r\n    \r\n    if (status !== undefined) {\r\n      this.span.status = status\r\n    } else if (this.span.status === SpanStatus.PENDING) {\r\n      this.span.status = SpanStatus.SUCCESS\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取Span数据\r\n   */\r\n  getSpan(): TraceSpan {\r\n    return this.span\r\n  }\r\n\r\n  /**\r\n   * 添加子Span ID\r\n   */\r\n  addChildSpanId(spanId: string): this {\r\n    if (!this.span.childSpanIds) {\r\n      this.span.childSpanIds = []\r\n    }\r\n    this.span.childSpanIds.push(spanId)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 获取持续时间\r\n   */\r\n  getDuration(): number | undefined {\r\n    if (this.span.duration !== undefined) {\r\n      return this.span.duration\r\n    }\r\n    \r\n    if (this.span.endTime) {\r\n      return this.span.endTime - this.span.startTime\r\n    }\r\n    \r\n    return Date.now() - this.span.startTime\r\n  }\r\n\r\n  /**\r\n   * 是否已完成\r\n   */\r\n  isFinished(): boolean {\r\n    return this.span.endTime !== undefined\r\n  }\r\n\r\n  /**\r\n   * 是否有错误\r\n   */\r\n  hasError(): boolean {\r\n    return this.span.status === SpanStatus.ERROR || this.span.error !== undefined\r\n  }\r\n}\r\n\r\n/**\r\n * Span集合管理器\r\n */\r\nexport class SpanCollection {\r\n  private spans: Map<string, TraceSpan> = new Map()\r\n  private spansByTrace: Map<string, Set<string>> = new Map()\r\n  private childToParent: Map<string, string> = new Map()\r\n\r\n  /**\r\n   * 添加Span\r\n   */\r\n  add(span: TraceSpan): void {\r\n    this.spans.set(span.spanId, span)\r\n    \r\n    // 按trace ID分组\r\n    if (!this.spansByTrace.has(span.traceId)) {\r\n      this.spansByTrace.set(span.traceId, new Set())\r\n    }\r\n    this.spansByTrace.get(span.traceId)!.add(span.spanId)\r\n    \r\n    // 记录父子关系\r\n    if (span.parentSpanId) {\r\n      this.childToParent.set(span.spanId, span.parentSpanId)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取Span\r\n   */\r\n  get(spanId: string): TraceSpan | undefined {\r\n    return this.spans.get(spanId)\r\n  }\r\n\r\n  /**\r\n   * 获取trace的所有Spans\r\n   */\r\n  getByTraceId(traceId: string): TraceSpan[] {\r\n    const spanIds = this.spansByTrace.get(traceId)\r\n    if (!spanIds) {\r\n      return []\r\n    }\r\n    \r\n    return Array.from(spanIds)\r\n      .map(id => this.spans.get(id))\r\n      .filter((span): span is TraceSpan => span !== undefined)\r\n  }\r\n\r\n  /**\r\n   * 获取根Spans\r\n   */\r\n  getRootSpans(traceId: string): TraceSpan[] {\r\n    return this.getByTraceId(traceId).filter(span => !span.parentSpanId)\r\n  }\r\n\r\n  /**\r\n   * 获取子Spans\r\n   */\r\n  getChildSpans(parentSpanId: string): TraceSpan[] {\r\n    const children: TraceSpan[] = []\r\n    \r\n    this.spans.forEach(span => {\r\n      if (span.parentSpanId === parentSpanId) {\r\n        children.push(span)\r\n      }\r\n    })\r\n    \r\n    return children\r\n  }\r\n\r\n  /**\r\n   * 获取Span路径（从根到当前Span）\r\n   */\r\n  getSpanPath(spanId: string): TraceSpan[] {\r\n    const path: TraceSpan[] = []\r\n    let currentId: string | undefined = spanId\r\n    \r\n    while (currentId) {\r\n      const span = this.spans.get(currentId)\r\n      if (span) {\r\n        path.unshift(span)\r\n        currentId = span.parentSpanId\r\n      } else {\r\n        break\r\n      }\r\n    }\r\n    \r\n    return path\r\n  }\r\n\r\n  /**\r\n   * 删除Span\r\n   */\r\n  remove(spanId: string): boolean {\r\n    const span = this.spans.get(spanId)\r\n    if (!span) {\r\n      return false\r\n    }\r\n    \r\n    this.spans.delete(spanId)\r\n    this.spansByTrace.get(span.traceId)?.delete(spanId)\r\n    this.childToParent.delete(spanId)\r\n    \r\n    return true\r\n  }\r\n\r\n  /**\r\n   * 删除trace的所有Spans\r\n   */\r\n  removeByTraceId(traceId: string): number {\r\n    const spanIds = this.spansByTrace.get(traceId)\r\n    if (!spanIds) {\r\n      return 0\r\n    }\r\n    \r\n    let count = 0\r\n    spanIds.forEach(spanId => {\r\n      if (this.remove(spanId)) {\r\n        count++\r\n      }\r\n    })\r\n    \r\n    this.spansByTrace.delete(traceId)\r\n    \r\n    return count\r\n  }\r\n\r\n  /**\r\n   * 清空所有Spans\r\n   */\r\n  clear(): void {\r\n    this.spans.clear()\r\n    this.spansByTrace.clear()\r\n    this.childToParent.clear()\r\n  }\r\n\r\n  /**\r\n   * 获取大小\r\n   */\r\n  size(): number {\r\n    return this.spans.size\r\n  }\r\n\r\n  /**\r\n   * 获取trace数量\r\n   */\r\n  traceCount(): number {\r\n    return this.spansByTrace.size\r\n  }\r\n\r\n  /**\r\n   * 构建Span树\r\n   */\r\n  buildSpanTree(traceId: string): SpanTreeNode[] {\r\n    const spans = this.getByTraceId(traceId)\r\n    const roots = spans.filter(span => !span.parentSpanId)\r\n    \r\n    return roots.map(root => this.buildTreeNode(root, spans))\r\n  }\r\n\r\n  private buildTreeNode(span: TraceSpan, allSpans: TraceSpan[]): SpanTreeNode {\r\n    const children = allSpans\r\n      .filter(s => s.parentSpanId === span.spanId)\r\n      .map(child => this.buildTreeNode(child, allSpans))\r\n    \r\n    return {\r\n      span,\r\n      children,\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Span树节点\r\n */\r\nexport interface SpanTreeNode {\r\n  span: TraceSpan\r\n  children: SpanTreeNode[]\r\n}\r\n\r\n/**\r\n * 创建Span构建器\r\n */\r\nexport function createSpanBuilder(\r\n  traceId: string,\r\n  name: string,\r\n  type: SpanType = SpanType.CUSTOM,\r\n): SpanBuilder {\r\n  return new SpanBuilder(traceId, name, type)\r\n}\r\n\r\n/**\r\n * 创建Span操作器\r\n */\r\nexport function createSpanOperator(span: TraceSpan): SpanOperator {\r\n  return new SpanOperator(span)\r\n}\r\n\r\n/**\r\n * 创建Span集合\r\n */\r\nexport function createSpanCollection(): SpanCollection {\r\n  return new SpanCollection()\r\n}"],"names":["SpanType","SpanStatus","HTTP","DATABASE","CACHE","CUSTOM","MIDDLEWARE","SERVICE","MESSAGE","PENDING","SUCCESS","ERROR","CANCELLED","TIMEOUT","WARNING","SpanBuilder","constructor","traceId","name","type","this","span","spanId","generateSpanId","startTime","Date","now","status","tags","logs","events","childSpanIds","setParent","parentSpanId","setType","addTag","key","value","push","addTags","Object","entries","forEach","setAttribute","attributes","setAttributes","assign","build","generateId","SpanOperator","addLog","message","data","level","timestamp","addEvent","setError","error","Error","stack","setStatus","finish","endTime","duration","getSpan","addChildSpanId","getDuration","isFinished","hasError","SpanCollection","spans","Map","spansByTrace","childToParent","add","set","has","Set","get","getByTraceId","spanIds","Array","from","map","id","filter","getRootSpans","getChildSpans","children","getSpanPath","path","currentId","unshift","remove","delete","removeByTraceId","count","clear","size","traceCount","buildSpanTree","root","buildTreeNode","allSpans","s","child","createSpanBuilder","createSpanOperator","createSpanCollection","p","d","h","r","i","c","l","o"],"mappings":"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"}