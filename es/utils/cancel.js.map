{"version":3,"file":"cancel.js","sources":["../../src/utils/cancel.ts"],"sourcesContent":["import type { RequestConfig } from '../types'\r\nimport { ErrorHandler } from './error'\r\n\r\n/**\r\n * 取消令牌接口\r\n */\r\nexport interface CancelToken {\r\n  /** 取消原因 */\r\n  reason?: string\r\n  /** 是否已取消 */\r\n  isCancelled: boolean\r\n  /** 取消回调 */\r\n  promise: Promise<string>\r\n  /** 抛出取消错误 */\r\n  throwIfRequested: () => void\r\n}\r\n\r\n/**\r\n * 取消令牌实现\r\n */\r\nexport class CancelTokenImpl implements CancelToken {\r\n  public isCancelled = false\r\n  public reason?: string\r\n  public promise: Promise<string>\r\n\r\n  private resolvePromise!: (reason: string) => void\r\n\r\n  constructor() {\r\n    this.promise = new Promise<string>((resolve) => {\r\n      this.resolvePromise = resolve\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 取消请求\r\n   */\r\n  cancel(reason = 'Request cancelled'): void {\r\n    if (this.isCancelled) {\r\n      return\r\n    }\r\n\r\n    this.isCancelled = true\r\n    this.reason = reason\r\n    this.resolvePromise(reason)\r\n  }\r\n\r\n  /**\r\n   * 如果已取消则抛出错误\r\n   */\r\n  throwIfRequested(): void {\r\n    if (this.isCancelled) {\r\n      throw ErrorHandler.createCancelError({} as RequestConfig)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 取消令牌源\r\n */\r\nexport class CancelTokenSource {\r\n  public token: CancelToken\r\n\r\n  constructor() {\r\n    this.token = new CancelTokenImpl()\r\n  }\r\n\r\n  /**\r\n   * 取消请求\r\n   */\r\n  cancel(reason?: string): void {\r\n    ;(this.token as CancelTokenImpl).cancel(reason)\r\n  }\r\n}\r\n\r\n/**\r\n * 请求取消管理器\r\n */\r\nexport class CancelManager {\r\n  private requests = new Map<string, AbortController>()\r\n  private cancelTokens = new Map<string, CancelToken>()\r\n\r\n  /**\r\n   * 创建取消令牌源\r\n   */\r\n  static source(): CancelTokenSource {\r\n    return new CancelTokenSource()\r\n  }\r\n\r\n  /**\r\n   * 注册请求\r\n   */\r\n  register(\r\n    requestId: string,\r\n    controller: AbortController,\r\n    token?: CancelToken,\r\n  ): void {\r\n    this.requests.set(requestId, controller)\r\n    if (token) {\r\n      this.cancelTokens.set(requestId, token)\r\n\r\n      // 监听取消令牌\r\n      token.promise\r\n        .then(() => {\r\n          this.cancel(requestId)\r\n        })\r\n        .catch(() => {\r\n          // 忽略错误\r\n        })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 取消指定请求\r\n   */\r\n  cancel(requestId: string, reason = 'Request cancelled'): void {\r\n    const controller = this.requests.get(requestId)\r\n    if (controller) {\r\n      controller.abort()\r\n      this.requests.delete(requestId)\r\n    }\r\n\r\n    const token = this.cancelTokens.get(requestId)\r\n    if (token && !token.isCancelled) {\r\n      ;(token as CancelTokenImpl).cancel(reason)\r\n      this.cancelTokens.delete(requestId)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 取消所有请求\r\n   */\r\n  cancelAll(reason = 'All requests cancelled'): void {\r\n    this.requests.forEach((controller, _requestId) => {\r\n      controller.abort()\r\n    })\r\n    this.requests.clear()\r\n\r\n    this.cancelTokens.forEach((token, _requestId) => {\r\n      if (!token.isCancelled) {\r\n        ;(token as CancelTokenImpl).cancel(reason)\r\n      }\r\n    })\r\n    this.cancelTokens.clear()\r\n  }\r\n\r\n  /**\r\n   * 清理已完成的请求\r\n   */\r\n  cleanup(requestId: string): void {\r\n    this.requests.delete(requestId)\r\n    this.cancelTokens.delete(requestId)\r\n  }\r\n\r\n  /**\r\n   * 获取活跃请求数量\r\n   */\r\n  getActiveRequestCount(): number {\r\n    return this.requests.size\r\n  }\r\n\r\n  /**\r\n   * 检查请求是否已取消\r\n   */\r\n  isCancelled(requestId: string): boolean {\r\n    const token = this.cancelTokens.get(requestId)\r\n    return token ? token.isCancelled : false\r\n  }\r\n\r\n  /**\r\n   * 创建合并的 AbortSignal\r\n   */\r\n  createMergedSignal(signals: (AbortSignal | undefined)[]): AbortSignal {\r\n    const validSignals = signals.filter(\r\n      (signal): signal is AbortSignal => signal !== undefined,\r\n    )\r\n\r\n    if (validSignals.length === 0) {\r\n      return new AbortController().signal\r\n    }\r\n\r\n    if (validSignals.length === 1) {\r\n      return validSignals[0]!\r\n    }\r\n\r\n    // 创建一个新的控制器来合并多个信号\r\n    const controller = new AbortController()\r\n\r\n    const abortHandler = () => {\r\n      controller.abort()\r\n    }\r\n\r\n    validSignals.forEach((signal) => {\r\n      if (signal.aborted) {\r\n        controller.abort()\r\n        return\r\n      }\r\n      signal.addEventListener('abort', abortHandler, { once: true })\r\n    })\r\n\r\n    return controller.signal\r\n  }\r\n}\r\n\r\n/**\r\n * 请求元数据\r\n */\r\ninterface RequestMetadata {\r\n  source: CancelTokenSource\r\n  tags: Set<string>\r\n  createdAt: number\r\n  config?: RequestConfig\r\n}\r\n\r\n/**\r\n * 增强的取消管理器配置\r\n */\r\nexport interface EnhancedCancelConfig {\r\n  /** 默认超时时间（毫秒） */\r\n  defaultTimeout?: number\r\n  /** 是否自动清理已完成的请求 */\r\n  autoCleanup?: boolean\r\n  /** 清理间隔（毫秒） */\r\n  cleanupInterval?: number\r\n}\r\n\r\n/**\r\n * 增强的取消管理器\r\n * \r\n * 在基础取消管理器之上添加了标签管理、批量操作、统计等功能\r\n */\r\nexport class EnhancedCancelManager extends CancelManager {\r\n  private metadata = new Map<string, RequestMetadata>()\r\n  private config: Required<EnhancedCancelConfig>\r\n  private cleanupTimer?: ReturnType<typeof setInterval>\r\n\r\n  constructor(config: EnhancedCancelConfig = {}) {\r\n    super()\r\n\r\n    this.config = {\r\n      defaultTimeout: config.defaultTimeout || 30000,\r\n      autoCleanup: config.autoCleanup !== false,\r\n      cleanupInterval: config.cleanupInterval || 60000,\r\n    }\r\n\r\n    if (this.config?.autoCleanup) {\r\n      this.startAutoCleanup()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 创建并注册带标签的取消令牌\r\n   */\r\n  createWithTags(\r\n    requestId: string,\r\n    tags: string[] = [],\r\n    config?: RequestConfig,\r\n  ): CancelTokenSource {\r\n    const source = createCancelTokenSource()\r\n\r\n    this.metadata.set(requestId, {\r\n      source,\r\n      tags: new Set(tags),\r\n      createdAt: Date.now(),\r\n      config,\r\n    })\r\n\r\n    // 注册基础取消管理器\r\n    const controller = new AbortController()\r\n    this.register(requestId, controller, source.token)\r\n\r\n    return source\r\n  }\r\n\r\n  /**\r\n   * 批量取消请求\r\n   */\r\n  cancelBatch(requestIds: string[], reason?: string): number {\r\n    let cancelledCount = 0\r\n\r\n    for (const id of requestIds) {\r\n      if (this.metadata.has(id)) {\r\n        this.cancel(id, reason || 'Batch cancelled')\r\n        cancelledCount++\r\n      }\r\n    }\r\n\r\n    return cancelledCount\r\n  }\r\n\r\n  /**\r\n   * 按标签取消请求\r\n   */\r\n  cancelByTag(tag: string, reason?: string): number {\r\n    const idsToCancel = this.getRequestIdsByTag(tag)\r\n    return this.cancelBatch(idsToCancel, reason || `Cancelled by tag: ${tag}`)\r\n  }\r\n\r\n  /**\r\n   * 按多个标签取消请求（满足任一标签）\r\n   */\r\n  cancelByTags(tags: string[], reason?: string): number {\r\n    const idsToCancel = new Set<string>()\r\n\r\n    tags.forEach((tag) => {\r\n      this.getRequestIdsByTag(tag).forEach(id => idsToCancel.add(id))\r\n    })\r\n\r\n    return this.cancelBatch(Array.from(idsToCancel), reason)\r\n  }\r\n\r\n  /**\r\n   * 取消超时的请求\r\n   */\r\n  cancelTimeout(timeout: number, reason?: string): number {\r\n    const now = Date.now()\r\n    const idsToCancel: string[] = []\r\n\r\n    this.metadata.forEach((meta, requestId) => {\r\n      if (now - meta.createdAt > timeout) {\r\n        idsToCancel.push(requestId)\r\n      }\r\n    })\r\n\r\n    return this.cancelBatch(\r\n      idsToCancel,\r\n      reason || `Timeout exceeded: ${timeout}ms`,\r\n    )\r\n  }\r\n\r\n  /**\r\n   * 取消匹配条件的请求\r\n   */\r\n  cancelWhere(\r\n    predicate: (metadata: RequestMetadata, requestId: string) => boolean,\r\n    reason?: string,\r\n  ): number {\r\n    const idsToCancel: string[] = []\r\n\r\n    this.metadata.forEach((meta, requestId) => {\r\n      if (predicate(meta, requestId)) {\r\n        idsToCancel.push(requestId)\r\n      }\r\n    })\r\n\r\n    return this.cancelBatch(idsToCancel, reason)\r\n  }\r\n\r\n  /**\r\n   * 获取指定标签的所有请求ID\r\n   */\r\n  getRequestIdsByTag(tag: string): string[] {\r\n    const ids: string[] = []\r\n\r\n    this.metadata.forEach((meta, requestId) => {\r\n      if (meta.tags.has(tag)) {\r\n        ids.push(requestId)\r\n      }\r\n    })\r\n\r\n    return ids\r\n  }\r\n\r\n  /**\r\n   * 获取按标签分组的请求数量\r\n   */\r\n  getRequestCountByTag(): Map<string, number> {\r\n    const counts = new Map<string, number>()\r\n\r\n    this.metadata.forEach((meta) => {\r\n      meta.tags.forEach((tag) => {\r\n        counts.set(tag, (counts.get(tag) || 0) + 1)\r\n      })\r\n    })\r\n\r\n    return counts\r\n  }\r\n\r\n  /**\r\n   * 获取所有活跃请求的详细信息\r\n   */\r\n  getActiveRequests(): Array<{\r\n    id: string\r\n    tags: string[]\r\n    age: number\r\n    url?: string\r\n  }> {\r\n    const now = Date.now()\r\n    const requests: Array<{\r\n      id: string\r\n      tags: string[]\r\n      age: number\r\n      url?: string\r\n    }> = []\r\n\r\n    this.metadata.forEach((meta, id) => {\r\n      requests.push({\r\n        id,\r\n        tags: Array.from(meta.tags),\r\n        age: now - meta.createdAt,\r\n        url: meta.config?.url,\r\n      })\r\n    })\r\n\r\n    return requests\r\n  }\r\n\r\n  /**\r\n   * 获取统计信息\r\n   */\r\n  getStats() {\r\n    const now = Date.now()\r\n    let totalAge = 0\r\n    let oldestAge = 0\r\n    const tagCounts = this.getRequestCountByTag()\r\n\r\n    this.metadata.forEach((meta) => {\r\n      const age = now - meta.createdAt\r\n      totalAge += age\r\n      oldestAge = Math.max(oldestAge, age)\r\n    })\r\n\r\n    return {\r\n      active: this.metadata.size,\r\n      byTag: Object.fromEntries(tagCounts),\r\n      averageAge: this.metadata.size > 0 ? totalAge / this.metadata.size : 0,\r\n      oldestAge,\r\n      oldestRequest: this.getOldestRequest(),\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取最老的请求信息\r\n   */\r\n  getOldestRequest(): { id: string, age: number, url?: string } | null {\r\n    if (this.metadata.size === 0) {\r\n      return null\r\n    }\r\n\r\n    const now = Date.now()\r\n    let oldestId = ''\r\n    let oldestAge = 0\r\n    let oldestUrl: string | undefined\r\n\r\n    this.metadata.forEach((meta, id) => {\r\n      const age = now - meta.createdAt\r\n      if (age > oldestAge) {\r\n        oldestAge = age\r\n        oldestId = id\r\n        oldestUrl = meta.config?.url\r\n      }\r\n    })\r\n\r\n    return {\r\n      id: oldestId,\r\n      age: oldestAge,\r\n      url: oldestUrl,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 检查请求是否存在\r\n   */\r\n  has(requestId: string): boolean {\r\n    return this.metadata.has(requestId)\r\n  }\r\n\r\n  /**\r\n   * 获取请求的标签\r\n   */\r\n  getTags(requestId: string): string[] {\r\n    const meta = this.metadata.get(requestId)\r\n    return meta ? Array.from(meta.tags) : []\r\n  }\r\n\r\n  /**\r\n   * 为请求添加标签\r\n   */\r\n  addTags(requestId: string, ...tags: string[]): boolean {\r\n    const meta = this.metadata.get(requestId)\r\n    if (!meta) {\r\n      return false\r\n    }\r\n\r\n    tags.forEach(tag => meta.tags.add(tag))\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * 移除请求的标签\r\n   */\r\n  removeTags(requestId: string, ...tags: string[]): boolean {\r\n    const meta = this.metadata.get(requestId)\r\n    if (!meta) {\r\n      return false\r\n    }\r\n\r\n    tags.forEach(tag => meta.tags.delete(tag))\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * 清理指定请求\r\n   */\r\n  cleanup(requestId: string): void {\r\n    super.cleanup(requestId)\r\n    this.metadata.delete(requestId)\r\n  }\r\n\r\n  /**\r\n   * 清理所有已完成的请求\r\n   */\r\n  cleanupAll(): void {\r\n    const idsToCleanup: string[] = []\r\n\r\n    this.metadata.forEach((_meta, requestId) => {\r\n      if (this.isCancelled(requestId)) {\r\n        idsToCleanup.push(requestId)\r\n      }\r\n    })\r\n\r\n    idsToCleanup.forEach(id => this.cleanup(id))\r\n  }\r\n\r\n  /**\r\n   * 启动自动清理\r\n   */\r\n  private startAutoCleanup(): void {\r\n    this.cleanupTimer = setInterval(() => {\r\n      this.cleanupAll()\r\n    }, this.config?.cleanupInterval)\r\n  }\r\n\r\n  /**\r\n   * 停止自动清理\r\n   */\r\n  stopAutoCleanup(): void {\r\n    if (this.cleanupTimer) {\r\n      clearInterval(this.cleanupTimer)\r\n      this.cleanupTimer = undefined\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 更新配置\r\n   */\r\n  updateConfig(config: Partial<EnhancedCancelConfig>): void {\r\n    const oldAutoCleanup = this.config?.autoCleanup\r\n\r\n    this.config = { ...this.config, ...config }\r\n\r\n    // 处理自动清理配置变化\r\n    if (oldAutoCleanup && !this.config?.autoCleanup) {\r\n      this.stopAutoCleanup()\r\n    }\r\n    else if (!oldAutoCleanup && this.config?.autoCleanup) {\r\n      this.startAutoCleanup()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 销毁管理器\r\n   */\r\n  destroy(): void {\r\n    this.stopAutoCleanup()\r\n    this.cancelAll('Manager destroyed')\r\n    this.metadata.clear()\r\n  }\r\n}\r\n\r\n/**\r\n * 全局取消管理器实例（使用增强版）\r\n */\r\nexport const globalCancelManager = new EnhancedCancelManager()\r\n\r\n/**\r\n * 创建取消令牌源\r\n */\r\nexport function createCancelTokenSource(): CancelTokenSource {\r\n  return CancelManager.source()\r\n}\r\n\r\n/**\r\n * 创建增强的取消管理器\r\n */\r\nexport function createEnhancedCancelManager(\r\n  config?: EnhancedCancelConfig,\r\n): EnhancedCancelManager {\r\n  return new EnhancedCancelManager(config)\r\n}\r\n\r\n/**\r\n * 检查是否为取消错误\r\n */\r\nexport function isCancelError(error: any): boolean {\r\n  return (\r\n    error\r\n    && (error.isCancelError\r\n      || error.name === 'AbortError'\r\n      || error.code === 'CANCELED'\r\n      || error.message?.includes('cancelled')\r\n      || error.message?.includes('aborted'))\r\n  )\r\n}\r\n\r\n/**\r\n * 超时取消令牌\r\n */\r\nexport function createTimeoutCancelToken(timeout: number): CancelTokenSource {\r\n  const source = createCancelTokenSource()\r\n\r\n  setTimeout(() => {\r\n    source.cancel(`Request timeout after ${timeout}ms`)\r\n  }, timeout)\r\n\r\n  return source\r\n}\r\n"],"names":["CancelTokenImpl","constructor","this","isCancelled","promise","Promise","resolve","resolvePromise","cancel","reason","throwIfRequested","ErrorHandler","createCancelError","CancelTokenSource","token","CancelManager","requests","Map","cancelTokens","source","register","requestId","controller","set","then","catch","get","abort","delete","cancelAll","forEach","_requestId","clear","cleanup","getActiveRequestCount","size","createMergedSignal","signals","validSignals","filter","signal","length","AbortController","abortHandler","aborted","addEventListener","once","EnhancedCancelManager","config","super","metadata","defaultTimeout","autoCleanup","cleanupInterval","startAutoCleanup","createWithTags","tags","createCancelTokenSource","Set","createdAt","Date","now","cancelBatch","requestIds","cancelledCount","id","has","cancelByTag","tag","idsToCancel","getRequestIdsByTag","cancelByTags","add","Array","from","cancelTimeout","timeout","meta","push","cancelWhere","predicate","ids","getRequestCountByTag","counts","getActiveRequests","age","url","getStats","totalAge","oldestAge","tagCounts","Math","max","active","byTag","Object","fromEntries","averageAge","oldestRequest","getOldestRequest","oldestUrl","oldestId","getTags","addTags","removeTags","cleanupAll","idsToCleanup","_meta","cleanupTimer","setInterval","stopAutoCleanup","clearInterval","updateConfig","oldAutoCleanup","destroy","globalCancelManager","createEnhancedCancelManager","isCancelError","error","name","code","message","includes","createTimeoutCancelToken","setTimeout","o","h","d","l","i","m","C","f","p"],"mappings":"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"}