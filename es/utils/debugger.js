var e,t;(t=e||(e={}))[t.NONE=0]="NONE",t[t.ERROR=1]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=3]="INFO",t[t.DEBUG=4]="DEBUG",t[t.TRACE=5]="TRACE";class s{constructor(t={}){this.requestLogs=new Map,this.responseLogs=[],this.events=[],this.performanceData=new Map,this.isApplied=!1,this.config={level:t.level??e.INFO,logRequests:t.logRequests??!0,logResponses:t.logResponses??!0,logHeaders:t.logHeaders??!0,logBody:t.logBody??!1,logResponseBody:t.logResponseBody??!1,maxLogs:t.maxLogs??1e3,console:t.console??!0,handler:t.handler||(()=>{}),performance:t.performance??!0,cacheTracking:t.cacheTracking??!0}}apply(e){if(this.isApplied)throw new Error("HttpDebugger is already applied");e.interceptors.request.use(e=>(this.logRequest(e),e)),e.interceptors.response.use(e=>(this.logResponse(e),e),e=>(this.logError(e),Promise.reject(e))),this.isApplied=!0}logRequest(t){if(!this.config?.logRequests)return;const s=this.generateId(),o={id:s,config:t,timestamp:Date.now(),method:t.method||"GET",url:t.url||"",headers:this.config?.logHeaders?t.headers:void 0,data:this.config?.logBody?t.data:void 0};this.requestLogs.set(s,o),this.config?.performance&&this.performanceData.set(s,{totalTime:0}),this.recordEvent({type:"request",data:o,timestamp:Date.now(),level:e.DEBUG}),this.config?.console&&(this.config,e.DEBUG)}logResponse(t){if(!this.config?.logResponses)return;const s=this.findRequestId(t.config),o=s?this.requestLogs.get(s):null,r=Date.now(),n=o?r-o.timestamp:0,i={requestId:s||"unknown",response:this.config?.logResponseBody?t:{...t,data:"[Response Body Hidden]"},timestamp:r,duration:n,status:t.status,size:this.estimateSize(t.data)};if(this.responseLogs.push(i),this.trimLogs(),this.config?.performance&&s){const e=this.performanceData.get(s);e&&(e.totalTime=n,e.responseSize=i.size)}this.recordEvent({type:"response",data:i,timestamp:r,level:e.DEBUG}),this.config?.console&&(this.config,e.DEBUG)}logError(t){const s=t.config?this.findRequestId(t.config):null,o=s?this.requestLogs.get(s):null,r=Date.now(),n={requestId:s||"unknown",error:t,timestamp:r,duration:o?r-o.timestamp:0,status:t.response?.status};this.responseLogs.push(n),this.trimLogs(),this.recordEvent({type:"error",data:n,timestamp:r,level:e.ERROR}),this.config?.console&&(this.config,e.ERROR)}recordEvent(e){this.events.push(e),this.events.length>this.config?.maxLogs&&this.events.shift(),this.config?.handler(e)}getRequestLogs(){return Array.from(this.requestLogs.values())}getResponseLogs(){return[...this.responseLogs]}getEvents(){return[...this.events]}getPerformanceReport(){const e=this.responseLogs,t=e.length,s=e.reduce((e,t)=>e+t.duration,0),o=t>0?s/t:0,r=e.reduce((e,t)=>t.duration>(e?.duration||0)?t:e,e[0]||null),n=e.reduce((e,t)=>t.duration<(e?.duration||Number.POSITIVE_INFINITY)?t:e,e[0]||null),i=e.filter(e=>e.error).length;return{totalRequests:t,averageDuration:o,slowestRequest:r,fastestRequest:n,errorRate:t>0?i/t:0,totalDataTransferred:e.reduce((e,t)=>e+(t.size||0),0)}}clearLogs(){this.requestLogs.clear(),this.responseLogs=[],this.events=[],this.performanceData.clear()}exportLogs(){return JSON.stringify({requests:this.getRequestLogs(),responses:this.getResponseLogs(),events:this.getEvents(),performance:this.getPerformanceReport(),timestamp:Date.now()},null,2)}updateConfig(e){Object.assign(this.config,e)}getConfig(){return{...this.config}}generateId(){return`${Date.now()}-${Math.random().toString(36).slice(2,11)}`}findRequestId(e){for(const[t,s]of this.requestLogs.entries())if(s.config===e)return t;return null}estimateSize(e){if(!e)return 0;if("string"==typeof e)return e.length;if(e instanceof Blob)return e.size;if(e instanceof ArrayBuffer)return e.byteLength;try{return JSON.stringify(e).length}catch{return 0}}trimLogs(){if(this.responseLogs.length>this.config?.maxLogs&&(this.responseLogs=this.responseLogs.slice(-this.config?.maxLogs)),this.requestLogs.size>this.config?.maxLogs){const e=this.requestLogs.size-this.config?.maxLogs,t=Array.from(this.requestLogs.keys());for(let s=0;s<e;s++)this.requestLogs.delete(t[s])}}}function o(e){return new s(e)}function r(t){const o=new s(t);return{request:t=>(o.recordEvent({type:"request",data:t,timestamp:Date.now(),level:e.DEBUG}),t),response:t=>(o.recordEvent({type:"response",data:t,timestamp:Date.now(),level:e.DEBUG}),t),error:t=>(o.recordEvent({type:"error",data:t,timestamp:Date.now(),level:e.ERROR}),Promise.reject(t)),debugger:o}}export{e as DebugLevel,s as HttpDebugger,r as createDebugInterceptor,o as createHttpDebugger};
//# sourceMappingURL=debugger.js.map
