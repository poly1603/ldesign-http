class e{constructor(){this.startTime=Date.now(),this.lastLoaded=0,this.lastTime=Date.now(),this.speeds=[]}calculate(e,t,n){const a=Date.now(),o=a-this.lastTime,s=e-this.lastLoaded,i=o>0?s/o*1e3:0;this.speeds.push(i),this.speeds.length>10&&this.speeds.shift();const r=this.speeds.reduce((e,t)=>e+t,0)/this.speeds.length,p=r>0?(t-e)/r:0;return this.lastLoaded=e,this.lastTime=a,{loaded:e,total:t,percentage:t>0?Math.round(e/t*100):0,speed:r,timeRemaining:p,elapsed:a-this.startTime,filename:n}}reset(){this.startTime=Date.now(),this.lastLoaded=0,this.lastTime=Date.now(),this.speeds=[]}}function t(e){const t=e["content-disposition"]||e["Content-Disposition"];if(!t)return null;const n=t.match(/filename\*=UTF-8''(.+)/i);if(n)return decodeURIComponent(n[1]);const a=t.match(/filename="(.+)"/i);if(a)return a[1];const o=t.match(/filename=([^;]+)/i);return o?o[1].trim():null}function n(e){try{return(new URL(e).pathname.split("/").pop()||"download").split("?")[0]}catch{return"download"}}function a(e){const t=e.split(".").pop()?.toLowerCase();return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",svg:"image/svg+xml",pdf:"application/pdf",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",txt:"text/plain",csv:"text/csv",json:"application/json",xml:"application/xml",html:"text/html",css:"text/css",js:"application/javascript",mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg",mp4:"video/mp4",avi:"video/x-msvideo",mov:"video/quicktime",zip:"application/zip",rar:"application/x-rar-compressed","7z":"application/x-7z-compressed",tar:"application/x-tar",gz:"application/gzip"}[t||""]||"application/octet-stream"}function o(e,t){const n=URL.createObjectURL(e),a=document.createElement("a");a.href=n,a.download=t,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(()=>{URL.revokeObjectURL(n)},100)}function s(e,t){const n=[],a=Math.ceil(e/t);for(let o=0;o<a;o++){const a=o*t,s=Math.min(a+t-1,e-1);n.push({index:o,start:a,end:s,size:s-a+1,completed:!1})}return n}function i(e){e.sort((e,t)=>e.index-t.index);const t=e.reduce((e,t)=>e+t.size,0),n=new Uint8Array(t);let a=0;for(const t of e)if(t.data){const e=new Uint8Array(t.data);n.set(e,a),a+=e.length}return n.buffer}function r(e){return"bytes"===(e["accept-ranges"]||e["Accept-Ranges"])}function p(e,t){return void 0!==t?`bytes=${e}-${t}`:`bytes=${e}-`}function c(e){const t=e.match(/bytes (\d+)-(\d+)\/(\d+)/);return t?{start:Number.parseInt(t[1],10),end:Number.parseInt(t[2],10),total:Number.parseInt(t[3],10)}:null}function l(e){const t=["B/s","KB/s","MB/s","GB/s"];let n=e,a=0;for(;n>=1024&&a<t.length-1;)n/=1024,a++;return`${n.toFixed(1)} ${t[a]}`}function d(e){if(!Number.isFinite(e)||e<0)return"未知";if(e<60)return`${Math.round(e)}秒`;if(e<3600){return`${Math.floor(e/60)}分${Math.round(e%60)}秒`}return`${Math.floor(e/3600)}小时${Math.floor(e%3600/60)}分钟`}function m(e){const t=e.split(".").pop()?.toLowerCase();return["jpg","jpeg","png","gif","webp","svg","pdf","txt","json","xml","html","css","js","mp3","wav","ogg","mp4","avi","mov"].includes(t||"")}export{e as DownloadProgressCalculator,s as createDownloadChunks,p as createRangeHeader,l as formatDownloadSpeed,d as formatTimeRemaining,t as getFilenameFromResponse,n as getFilenameFromURL,a as getMimeTypeFromFilename,m as isPreviewableFile,i as mergeDownloadChunks,c as parseContentRange,o as saveFileToLocal,r as supportsRangeRequests};
//# sourceMappingURL=download.js.map
