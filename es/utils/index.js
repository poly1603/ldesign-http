import{BatchManager as e,createBatchManager as r}from"./batch.js";import{createBatchRequest as a,createChainBuilder as t,debounce as n,deepFreeze as s,get as o,memoize as i,once as c,parallelLimit as u,retry as l,set as f,sleep as m,throttle as g,timeout as p}from"./helpers.js";import{MemoryCleaner as y,MemoryMonitor as E,createMemoryMonitor as M,globalMemoryCleaner as d,globalMemoryMonitor as h}from"./memory.js";import{OfflineQueueManager as b,createOfflineQueueManager as C}from"./offline.js";import{SignatureManager as w,createSignatureInterceptor as R,createSignatureManager as S}from"./signature.js";import{KeepAliveManager as A,WarmupManager as j,createKeepAliveManager as T,createWarmupManager as k,warmupConnections as O}from"./warmup.js";function B(e,r={}){if(!e||"object"!=typeof e)throw new TypeError("defaultConfig must be a valid object");if(!r||"object"!=typeof r||0===Object.keys(r).length)return{...e};const a={...e,...r};return e.headers&&r.headers&&(a.headers={...e.headers,...r.headers}),e.params&&r.params&&(a.params={...e.params,...r.params}),a}const N=new Map;function v(e){if(e.length<=20){const r=N.get(e);if(void 0!==r)return r;const a=encodeURIComponent(e).replace(/%20/g,"+");return N.size<1e3&&N.set(e,a),a}return encodeURIComponent(e).replace(/%20/g,"+")}function L(e){if(!e||"object"!=typeof e)return"";const r=Object.keys(e);if(0===r.length)return"";const a=Array.from({length:2*r.length});let t=0;for(const n of r){const r=e[n];if(null==r)continue;const s=v(n);if(Array.isArray(r)){const e=r.length;for(let n=0;n<e;n++){const e=r[n];null!=e&&(a[t++]=`${s}=${v(String(e))}`)}}else a[t++]=`${s}=${v(String(r))}`}return a.slice(0,t).join("&")}function U(){N.clear()}function D(e,r,a){let t=e;if(r&&!$(e)&&(t=z(r,e)),a&&Object.keys(a).length>0){const e=L(a);if(e){const r=t.includes("?")?"&":"?";t+=r+e}}return t}function $(e){return/^(?:[a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function z(e,r){return r?`${e.replace(/\/+$/,"")}/${r.replace(/^\/+/,"")}`:e}function F(e,r,a,t){const n=new Error(e);return n.config=r,n.code=a,n.response=t,n.isNetworkError=!1,n.isTimeoutError=!1,n.isCancelError=!1,"ECONNABORTED"===a||e.includes("timeout")?n.isTimeoutError=!0:"NETWORK_ERROR"===a||e.includes("Network Error")?n.isNetworkError=!0:("CANCELED"===a||e.includes("canceled"))&&(n.isCancelError=!0),n}function I(e){return new Promise(r=>setTimeout(r,e))}function K(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}function Q(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(Array.isArray(e))return e.map(e=>Q(e));if("object"==typeof e){const r={};for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(r[a]=Q(e[a]));return r}return e}function W(e){return typeof FormData<"u"&&e instanceof FormData}function P(e){return typeof Blob<"u"&&e instanceof Blob}function q(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function H(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}const _={isSuccess:e=>e>=200&&e<300,isRedirect:e=>e>=300&&e<400,isClientError:e=>e>=400&&e<500,isServerError:e=>e>=500,isAuthError:e=>401===e||403===e,isNotFound:e=>404===e,isTimeout:e=>408===e},x={isNetworkError:e=>e?.isNetworkError||"NetworkError"===e?.name||"NETWORK_ERROR"===e?.code||!e?.response&&e?.message?.includes("network"),isTimeoutError:e=>e?.isTimeoutError||"TimeoutError"===e?.name||"TIMEOUT"===e?.code||e?.message?.includes("timeout"),isCancelError:e=>e?.isCancelError||"AbortError"===e?.name||"CANCELED"===e?.code||e?.message?.includes("aborted"),getErrorType:e=>{if(x.isNetworkError(e))return"network";if(x.isTimeoutError(e))return"timeout";if(x.isCancelError(e))return"cancel";if(e?.response?.status){const r=e.response.status;if(_.isClientError(r))return"client";if(_.isServerError(r))return"server"}return"unknown"},getUserFriendlyMessage:e=>{const r=x.getErrorType(e),a={network:"网络连接失败，请检查网络设置",timeout:"请求超时，请重试",cancel:"请求已取消",client:`请求失败 (${e?.response?.status||"客户端错误"})`,server:"服务器内部错误，请稍后重试",unknown:"未知错误，请重试"};return a[r]||a.unknown}};export{e as BatchManager,x as ErrorClassifier,_ as HttpStatus,A as KeepAliveManager,y as MemoryCleaner,E as MemoryMonitor,b as OfflineQueueManager,w as SignatureManager,j as WarmupManager,L as buildQueryString,D as buildURL,U as clearQueryStringCache,z as combineURLs,r as createBatchManager,a as createBatchRequest,t as createChainBuilder,F as createHttpError,T as createKeepAliveManager,M as createMemoryMonitor,C as createOfflineQueueManager,R as createSignatureInterceptor,S as createSignatureManager,k as createWarmupManager,n as debounce,Q as deepClone,s as deepFreeze,I as delay,K as generateId,o as get,d as globalMemoryCleaner,h as globalMemoryMonitor,$ as isAbsoluteURL,q as isArrayBuffer,P as isBlob,W as isFormData,H as isURLSearchParams,i as memoize,B as mergeConfig,c as once,u as parallelLimit,l as retry,f as set,m as sleep,g as throttle,p as timeout,O as warmupConnections};
//# sourceMappingURL=index.js.map
