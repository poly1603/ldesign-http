var t,e;(e=t||(t={}))[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR",e[e.WARN=2]="WARN",e[e.INFO=3]="INFO",e[e.DEBUG=4]="DEBUG",e[e.TRACE=5]="TRACE";class s{constructor(t={}){this.entries=new Map,this.entryOrder=[],this.currentSize=0,this.config={maxEntries:t.maxEntries??1e3,maxSize:t.maxSize??10485760,ttl:t.ttl??864e5,persist:t.persist??!1,persistKey:t.persistKey??"http-debug-logs"},this.config.persist&&this.loadFromStorage()}add(t){this.removeExpired();const e=this.estimateSize(t);for(;(this.entries.size>=this.config.maxEntries||this.currentSize+e>this.config.maxSize)&&this.entryOrder.length>0;)this.removeOldest();this.entries.set(t.id,t),this.entryOrder.push(t.id),this.currentSize+=e,this.config.persist&&this.saveToStorage()}get(t){return this.entries.get(t)}query(t={}){return Array.from(this.entries.values()).filter(e=>this.matchesFilter(e,t)).sort((t,e)=>e.timestamp-t.timestamp)}remove(t){const e=this.entries.get(t);if(!e)return!1;this.entries.delete(t);const s=this.entryOrder.indexOf(t);return-1!==s&&this.entryOrder.splice(s,1),this.currentSize-=this.estimateSize(e),this.config.persist&&this.saveToStorage(),!0}clear(){this.entries.clear(),this.entryOrder=[],this.currentSize=0,this.config.persist&&this.removeFromStorage()}getStats(){const e=Array.from(this.entries.values()),s={},r={};e.forEach(e=>{s[e.type]=(s[e.type]||0)+1,r[t[e.level]]=(r[t[e.level]]||0)+1});const i=e.sort((t,e)=>t.timestamp-e.timestamp);return{totalEntries:this.entries.size,totalSize:this.currentSize,oldestEntry:i[0],newestEntry:i[i.length-1],typeDistribution:s,levelDistribution:r}}export(e="json"){const s=this.query();if("json"===e)return JSON.stringify(s,null,2);const r=s.map(e=>{const s=[e.id,e.type,t[e.level],new Date(e.timestamp).toISOString()];return"method"in e?s.push(e.method):s.push(""),"url"in e?s.push(e.url):s.push(""),"status"in e?s.push(e.status):s.push(""),"duration"in e?s.push(e.duration):s.push(""),"message"in e?s.push(e.message):s.push(""),s});return[["id","type","level","timestamp","method","url","status","duration","message"].join(","),...r.map(t=>t.map(t=>JSON.stringify(t??"")).join(","))].join("\n")}matchesFilter(t,e){if(e.types&&!e.types.includes(t.type)||void 0!==e.minLevel&&t.level<e.minLevel||e.startTime&&t.timestamp<e.startTime||e.endTime&&t.timestamp>e.endTime)return!1;if(e.urlPattern&&"url"in t){const s=e.urlPattern;if("string"==typeof s){if(!t.url?.includes(s))return!1}else if(!s.test(t.url||""))return!1}if(e.statusRange&&"status"in t){const[s,r]=e.statusRange,i=t.status;if(i<s||i>r)return!1}return!(e.tags&&e.tags.length>0&&(!t.tags||!e.tags.some(e=>t.tags?.includes(e)))||e.sessionId&&t.sessionId!==e.sessionId||e.traceId&&t.traceId!==e.traceId)}removeOldest(){if(0===this.entryOrder.length)return;const t=this.entryOrder.shift(),e=this.entries.get(t);e&&(this.currentSize-=this.estimateSize(e),this.entries.delete(t))}removeExpired(){if(this.config.ttl<=0)return;const t=Date.now(),e=[];this.entries.forEach((s,r)=>{t-s.timestamp>this.config.ttl&&e.push(r)}),e.forEach(t=>this.remove(t))}estimateSize(t){try{return JSON.stringify(t).length}catch{return 1024}}loadFromStorage(){if(!(typeof localStorage>"u"))try{const t=localStorage.getItem(this.config.persistKey);if(!t)return;JSON.parse(t).forEach(t=>{this.add(t)})}catch(t){}}saveToStorage(){if(!(typeof localStorage>"u"))try{const t=Array.from(this.entries.values());localStorage.setItem(this.config.persistKey,JSON.stringify(t))}catch(t){}}removeFromStorage(){if(!(typeof localStorage>"u"))try{localStorage.removeItem(this.config.persistKey)}catch(t){}}}function r(t){return new s(t)}export{t as LogLevel,s as LogStorage,r as createLogStorage};
//# sourceMappingURL=debug-logger.js.map
