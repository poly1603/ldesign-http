var n,e,t;(e=n||(n={})).ONLINE="online",e.OFFLINE="offline",e.UNKNOWN="unknown",function(n){n.WIFI="wifi",n.CELLULAR_4G="4g",n.CELLULAR_3G="3g",n.CELLULAR_2G="2g",n.UNKNOWN="unknown"}(t||(t={}));class i{constructor(e={}){this.currentStatus=n.UNKNOWN,this.listeners=[],this.isMonitoring=!1,this.config={enabled:e.enabled??!0,pauseOnOffline:e.pauseOnOffline??!0,retryOnOnline:e.retryOnOnline??!0,onStatusChange:e.onStatusChange,onOffline:e.onOffline,onOnline:e.onOnline},this.updateStatus()}start(){if(!this.config?.enabled||this.isMonitoring||typeof window>"u")return;this.isMonitoring=!0;const e=()=>{this.handleStatusChange(n.ONLINE),this.config?.onOnline?.()},t=()=>{this.handleStatusChange(n.OFFLINE),this.config?.onOffline?.()};if(window.addEventListener("online",e),window.addEventListener("offline",t),this.listeners.push(()=>window.removeEventListener("online",e),()=>window.removeEventListener("offline",t)),"connection"in navigator||"mozConnection"in navigator||"webkitConnection"in navigator){const n=navigator.connection||navigator.mozConnection||navigator.webkitConnection,e=()=>{this.updateStatus()};n.addEventListener("change",e),this.listeners.push(()=>n.removeEventListener("change",e))}}stop(){this.isMonitoring&&(this.isMonitoring=!1,this.listeners.forEach(n=>n()),this.listeners=[])}getStatus(){return this.currentStatus}isOnline(){return this.currentStatus===n.ONLINE}isOffline(){return this.currentStatus===n.OFFLINE}getNetworkInfo(){const n={online:this.isOnline(),connectionType:t.UNKNOWN,metered:!1};if(typeof navigator>"u")return n;const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return e&&(e.effectiveType&&(n.effectiveType=e.effectiveType,n.connectionType=this.parseConnectionType(e.effectiveType)),"boolean"==typeof e.saveData&&(n.metered=e.saveData),"number"==typeof e.downlink&&(n.downlink=e.downlink),"number"==typeof e.rtt&&(n.rtt=e.rtt)),n}handleStatusChange(n){if(this.currentStatus===n)return;this.currentStatus=n;const e=this.getNetworkInfo();this.config?.onStatusChange?.(n,e)}updateStatus(){typeof navigator<"u"&&"onLine"in navigator?this.currentStatus=navigator.onLine?n.ONLINE:n.OFFLINE:this.currentStatus=n.UNKNOWN}parseConnectionType(n){switch(n.toLowerCase()){case"4g":return t.CELLULAR_4G;case"3g":return t.CELLULAR_3G;case"2g":return t.CELLULAR_2G;case"wifi":return t.WIFI;default:return t.UNKNOWN}}isSuitableForLargeTransfer(){const n=this.getNetworkInfo();return!(!n.online||n.metered||n.connectionType===t.CELLULAR_2G||n.connectionType===t.CELLULAR_3G||n.downlink&&n.downlink<1)}destroy(){this.stop()}}function o(n){return new i(n)}const r=new i;function s(n){const e=new i(n);e.start();const t=[];return e.start(),{request:{onFulfilled:async n=>{if(e.isOffline()){if(e.config.pauseOnOffline)return new Promise((i,o)=>{t.push({config:n,resolve:i,reject:o});const r=setInterval(()=>{if(e.isOnline()){const n=t.shift();n&&i(n.config)}},1e3);setTimeout(()=>{clearInterval(r);const e=t.findIndex(e=>e.config===n);-1!==e&&(t.splice(e,1),o(new Error("Network timeout: request cancelled after 5 minutes")))},3e5)});throw new Error("Network is offline")}return n}},destroy:()=>{e.destroy()}}}function a(n=6e4){return new Promise((e,t)=>{if(r.isOnline())return void e();const i=setTimeout(()=>{t(new Error("Timeout waiting for network"))},n),o=setInterval(()=>{r.isOnline()&&(clearTimeout(i),e())},1e3);setTimeout(()=>clearInterval(o),n)})}typeof window<"u"&&r.start();export{t as ConnectionType,i as NetworkMonitor,n as NetworkStatus,s as createNetworkInterceptor,o as createNetworkMonitor,r as globalNetworkMonitor,a as waitForOnline};
//# sourceMappingURL=network.js.map
