import{ref as a,computed as e,watch as t,unref as n,onUnmounted as r}from"vue";import{createHttpClient as l}from"../factory.js";function s(s,u={}){const o=l(u.clientConfig),c=a([]),i=a(null),v=a(!1),m=a(null),d=e(()=>null!==m.value);let f=null;const g=async(a,e)=>{try{v.value=!0,m.value=null,f&&f.abort(),f=new AbortController;const t=await e();return("list"===a||"get"===a)&&u.onSuccess?.(t,a),t}catch(e){const t=e;return"AbortError"!==t.name&&(m.value=t,u.onError?.(t,a)),null}finally{v.value=!1}},y=async a=>await g("list",async()=>{const e={...a,signal:f?.signal};let t=(await o.get(n(s),e)).data;return u.transform&&(t=Array.isArray(t)?t.map(u.transform):t),c.value=t,t})||[];return!1!==u.immediate&&t(()=>n(s),()=>{y()},{immediate:!0}),!1!==u.cancelOnUnmount&&r(()=>{f&&f.abort()}),{items:c,current:i,loading:v,error:m,hasError:d,list:y,get:async(a,e)=>await g("get",async()=>{const t=`${n(s)}/${a}`,r={...e,signal:f?.signal};let l=(await o.get(t,r)).data;return u.transform&&(l=u.transform(l)),i.value=l,l}),create:async(a,e)=>await g("create",async()=>{const t={...e,signal:f?.signal};let r=(await o.post(n(s),a,t)).data;return u.transform&&(r=u.transform(r)),c.value.push(r),i.value=r,u.onSuccess?.(r,"create"),r}),update:async(a,e,t)=>await g("update",async()=>{const r=`${n(s)}/${a}`,l={...t,signal:f?.signal};let v=(await o.put(r,e,l)).data;u.transform&&(v=u.transform(v));const m=c.value.findIndex(e=>e.id===a);return-1!==m&&(c.value[m]=v),i.value=v,u.onSuccess?.(v,"update"),v}),remove:async(a,e)=>null!==await g("delete",async()=>{const t=`${n(s)}/${a}`,r={...e,signal:f?.signal};await o.delete(t,r);const l=c.value.findIndex(e=>e.id===a);return-1!==l&&c.value.splice(l,1),i.value&&i.value.id===a&&(i.value=null),u.onSuccess?.(null,"delete"),!0}),reset:()=>{c.value=[],i.value=null,v.value=!1,m.value=null},clearError:()=>{m.value=null},refresh:()=>y()}}export{s as useResource};
//# sourceMappingURL=useResource.js.map
