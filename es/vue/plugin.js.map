{"version":3,"file":"plugin.js","sources":["../../src/vue/plugin.ts"],"sourcesContent":["import type { App, Plugin } from 'vue'\r\nimport type { HttpClient, RequestConfig } from '../types'\r\nimport type { HttpPluginOptions } from '../types/vue'\r\nimport { provide, ref } from 'vue'\r\nimport { createAdapter } from '../adapters'\r\nimport { HttpClientImpl } from '../client'\r\nimport { HTTP_CLIENT_KEY, HTTP_CONFIG_KEY } from './useHttp'\r\n\r\n/**\r\n * Vue 3 HTTP 插件\r\n */\r\nexport const HttpPlugin: Plugin = {\r\n  install(app: App, options: unknown = {}) {\r\n    const httpOptions = options as HttpPluginOptions\r\n    // 创建或使用提供的 HTTP 客户端\r\n    const client: HttpClient\r\n      = httpOptions.client\r\n        || new HttpClientImpl(httpOptions.globalConfig || {}, createAdapter())\r\n\r\n    // 提供 HTTP 客户端到应用上下文\r\n    app.provide(HTTP_CLIENT_KEY, client)\r\n    if (httpOptions.globalConfig) {\r\n      app.provide(HTTP_CONFIG_KEY, ref(httpOptions.globalConfig))\r\n    }\r\n\r\n    // 注册全局属性\r\n    const globalProperty = httpOptions.globalProperty || '$http'\r\n    ;(app.config.globalProperties as any)[globalProperty] = client\r\n\r\n    // 提供全局方法\r\n    app.provide('httpClient', client)\r\n\r\n    // 注册全局组件（如果需要）\r\n    // app.component('HttpProvider', HttpProvider)\r\n  },\r\n}\r\n\r\n/**\r\n * 安装插件的便利函数\r\n */\r\nexport function install(app: App, options?: HttpPluginOptions): void {\r\n  app.use(HttpPlugin, options)\r\n}\r\n\r\n/**\r\n * HTTP Provider 组件\r\n * 用于在组件树中提供 HTTP 客户端\r\n */\r\nexport const HttpProvider = {\r\n  name: 'HttpProvider',\r\n  props: {\r\n    client: {\r\n      type: Object as () => HttpClient,\r\n      required: false,\r\n    },\r\n    config: {\r\n      type: Object as () => RequestConfig,\r\n      required: false,\r\n    },\r\n  },\r\n  setup(\r\n    props: { client?: HttpClient, config?: RequestConfig },\r\n    { slots }: any,\r\n  ) {\r\n    // 使用提供的客户端或创建新的客户端\r\n    const client\r\n      = props.client || new HttpClientImpl(props.config || {}, createAdapter())\r\n\r\n    // 提供客户端到子组件\r\n    provide(HTTP_CLIENT_KEY, client)\r\n    if (props.config) {\r\n      provide(HTTP_CONFIG_KEY, ref(props.config))\r\n    }\r\n\r\n    return () => slots.default?.()\r\n  },\r\n}\r\n\r\n/**\r\n * 创建 HTTP 插件实例\r\n */\r\nexport function createHttpPlugin(options: HttpPluginOptions = {}): Plugin {\r\n  return {\r\n    install(app: App) {\r\n      HttpPlugin.install?.(app, options)\r\n    },\r\n  }\r\n}\r\n\r\n/**\r\n * 默认导出\r\n */\r\nexport default HttpPlugin\r\n\r\n// 扩展 Vue 应用实例类型\r\ndeclare module 'vue' {\r\n  interface ComponentCustomProperties {\r\n    $http: HttpClient\r\n  }\r\n\r\n  interface GlobalComponents {\r\n    HttpProvider: typeof HttpProvider\r\n  }\r\n}\r\n"],"names":["HttpPlugin","install","app","options","httpOptions","client","HttpClientImpl","globalConfig","createAdapter","provide","HTTP_CLIENT_KEY","HTTP_CONFIG_KEY","ref","globalProperty","config","globalProperties","use","HttpProvider","name","props","type","Object","required","setup","slots","default","createHttpPlugin","i","u","d","g"],"mappings":"8MAWO,MAAMA,EAAqB,CAChC,OAAAC,CAAQC,EAAUC,EAAmB,CAAA,GACnC,MAAMC,EAAcD,EAEdE,EACFD,EAAYC,QACT,IAAIC,EAAeF,EAAYG,cAAgB,CAAA,EAAIC,KAG1DN,EAAIO,QAAQC,EAAiBL,GACzBD,EAAYG,cACdL,EAAIO,QAAQE,EAAiBC,EAAIR,EAAYG,eAI/C,MAAMM,EAAiBT,EAAYS,gBAAkB,QACnDX,EAAIY,OAAOC,iBAAyBF,GAAkBR,EAGxDH,EAAIO,QAAQ,aAAcJ,EAI5B,GAMI,SAAUJ,EAAQC,EAAUC,GAChCD,EAAIc,IAAIhB,EAAYG,EACtB,CAMO,MAAMc,EAAe,CAC1BC,KAAM,eACNC,MAAO,CACLd,OAAQ,CACNe,KAAMC,OACNC,UAAU,GAEZR,OAAQ,CACNM,KAAMC,OACNC,UAAU,IAGd,KAAAC,CACEJ,GACEK,MAAAA,IAGF,MAAMnB,EACFc,EAAMd,QAAU,IAAIC,EAAea,EAAML,QAAU,CAAA,EAAIN,KAG3D,OAAAC,EAAQC,EAAiBL,GACrBc,EAAML,QACRL,EAAQE,EAAiBC,EAAIO,EAAML,SAG9B,IAAMU,EAAMC,WACrB,GAMI,SAAUC,EAAiBvB,EAA6B,CAAA,GAC5D,MAAO,CACL,OAAAF,CAAQC,GACNF,EAAWC,UAAUC,EAAKC,EAC5B,EAEJ,QAAAwB,gBAAAC,kBAAAC,sBAAAF,aAAAG"}