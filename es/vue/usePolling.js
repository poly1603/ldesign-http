import{ref as e,onUnmounted as n}from"vue";import{createHttpClient as t}from"../factory.js";function i(i,o){const a=o.client||t(),l=e(null),u=e(!1),r=e(null),s=e(!1),d=e(0);let c=null,v=!0,f=!0;function m(){c&&clearTimeout(c),c=setTimeout(h,o.interval)}const p=()=>{s.value=!1,c&&(clearTimeout(c),c=null)};async function w(){try{u.value=!0,r.value=null;const e=await a.request(i);return l.value=e.data,d.value++,o.onSuccess?.(e.data),o.stopWhen?.(e.data)&&p(),o.maxPolls&&d.value>=o.maxPolls&&p(),e.data}catch(e){const n=e;return r.value=n,o.onError?.(n),o.stopOnError&&p(),null}finally{u.value=!1}}async function h(){if(s.value){if(o.pauseWhenHidden&&!v)return void m();if(o.pauseWhenOffline&&!f)return void m();await w(),s.value&&m()}}function y(){s.value||(s.value=!0,d.value=0,!1!==o.immediate?h():m())}if(o.pauseWhenHidden&&typeof document<"u"){const e=()=>{v=!document.hidden};document.addEventListener("visibilitychange",e),n(()=>{document.removeEventListener("visibilitychange",e)})}if(o.pauseWhenOffline&&typeof window<"u"){const e=()=>{f=!0},t=()=>{f=!1};window.addEventListener("online",e),window.addEventListener("offline",t),n(()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)})}return n(()=>{p()}),!1!==o.immediate&&y(),{data:l,loading:u,error:r,isPolling:s,pollCount:d,start:y,stop:p,restart:function(){p(),y()},execute:w}}function o(e,n,t=3e3){return i(e,{interval:t,stopWhen:n,immediate:!0})}function a(e,n,t=3e3){return i(e,{interval:t,maxPolls:n,immediate:!0})}export{i as usePolling,a as usePollingTimes,o as usePollingUntil};
//# sourceMappingURL=usePolling.js.map
