import{ref as e,computed as n,onUnmounted as a,watch as l,unref as t}from"vue";import{createCancelTokenSource as u,isCancelError as o}from"../utils/cancel.js";function c(c,r,s={}){const i=e(s.initialData??null),f=e(!1),v=e(null),y=e(!1);let d=u();const m=n(()=>f.value),p=async e=>{f.value=!0,v.value=null,y.value=!1,d=u();try{const n={...t(r),...e,signal:d.token.promise},a=await c.request(n);let l=a.data;return"function"==typeof s.transform&&(l=s.transform(a.data)),i.value=l,y.value=!0,"function"==typeof s.onSuccess&&s.onSuccess(l,a),a}catch(e){const n=e;throw o(n)||(v.value=n,y.value=!0,"function"==typeof s.onError&&s.onError(n)),n}finally{f.value=!1,"function"==typeof s.onFinally&&s.onFinally()}},h=()=>{m.value&&d.cancel("Request cancelled by user")};return!1!==s.immediate&&l(()=>t(r),()=>{p()},{immediate:!0,deep:!0}),!1!==s.cancelOnUnmount&&a(()=>{h()}),{data:i,loading:f,error:v,finished:y,execute:p,refresh:()=>p(),cancel:h,reset:()=>{i.value=s.initialData??null,f.value=!1,v.value=null,y.value=!1},canCancel:m}}function r(l,t,c={}){const r=e(c.initialData??null),s=e(!1),i=e(null),f=e(!1);let v=u();const y=n(()=>s.value),d=async()=>{s.value=!0,i.value=null,f.value=!1,v=u();try{const e=await t();let n=e.data;return"function"==typeof c.transform&&(n=c.transform(e.data)),r.value=n,f.value=!0,"function"==typeof c.onSuccess&&c.onSuccess(n,e),e}catch(e){const n=e;throw o(n)||(i.value=n,f.value=!0,"function"==typeof c.onError&&c.onError(n)),n}finally{s.value=!1,"function"==typeof c.onFinally&&c.onFinally()}},m=d,p=()=>{y.value&&v.cancel("Request cancelled by user")};return!1!==c.cancelOnUnmount&&a(()=>{p()}),{data:r,loading:s,error:i,finished:f,execute:d,refresh:m,cancel:p,reset:()=>{r.value=c.initialData??null,s.value=!1,i.value=null,f.value=!1},canCancel:y}}export{r as useAsyncRequest,c as useRequest};
//# sourceMappingURL=useRequest.js.map
