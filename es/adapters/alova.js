import{BaseAdapter as e}from"./base.js";class t extends e{constructor(e){if(super(),this.name="alova",this.alovaInstance=e,!e)try{this.alova=require("alova")}catch{this.alova=null}}isSupported(){return null!==this.alovaInstance||null!==this.alova}async request(e){if(!this.isSupported())throw new Error("Alova is not available. Please install alova: npm install alova");const t=this.processConfig(e);try{const e=this.alovaInstance||this.createDefaultAlovaInstance(),a=await this.createAlovaMethod(e,t).send();return this.convertFromAlovaResponse(a,t)}catch(e){throw this.handleAlovaError(e,t)}}createDefaultAlovaInstance(){if(!this.alova)throw new Error("Alova is not available");try{const{createAlova:e}=this.alova;let t;try{t=require("alova/fetch"),"object"==typeof t&&t.default&&(t=t.default)}catch{t=()=>(e,t)=>fetch(e,t)}return e({baseURL:"",requestAdapter:t(),responded:e=>e.json()})}catch(e){throw new Error(`Failed to create Alova instance: ${e}`)}}createAlovaMethod(e,t){const{url:a,method:r="GET",data:s,headers:o,timeout:n,params:l}=t;if(!a)throw new Error("URL is required");let c=a;const i=l||{},h=a.split("?");if(h.length>1){c=h[0];const e=h[1];new URLSearchParams(e).forEach((e,t)=>{const a=Number(e);i[t]=Number.isNaN(a)||""===e?e:a})}let u=c;!c.startsWith("http")&&!c.startsWith("//")&&t.baseURL&&(u=`${t.baseURL.replace(/\/$/,"")}/${c.replace(/^\//,"")}`);const p={headers:o,timeout:n};let v;i&&Object.keys(i).length>0&&(p.params=i),t.signal&&(p.signal=t.signal);try{switch(r.toUpperCase()){case"GET":v=e.Get(u,p);break;case"POST":v=e.Post(u,s,p);break;case"PUT":v=e.Put(u,s,p);break;case"DELETE":v=e.Delete(u,p);break;case"PATCH":v=e.Patch(u,s,p);break;case"HEAD":v=e.Head(u,p);break;case"OPTIONS":v=e.Options(u,p);break;default:throw new Error(`Unsupported HTTP method: ${r}`)}}catch(e){throw new Error(`Failed to parse URL from ${a}: ${e.message}`)}return t.signal&&(v.abort=()=>{t.signal&&!t.signal.aborted&&t.signal.abort()}),v}convertFromAlovaResponse(e,t){return this.processResponse(e,200,"OK",{},t,e)}handleAlovaError(e,t){if(e.status||e.response?.status){const a=e.status||e.response.status,r=`Request failed with status code ${a}`,s=this.processError(new Error(r),t,e.response);return s.status=a,s}if("AlovaError"===e.name)return this.processError(e,t);const a=this.processError(e,t);return e.message&&e.message.includes("fetch")&&(a.isNetworkError=!0),a}}export{t as AlovaAdapter};
//# sourceMappingURL=alova.js.map
