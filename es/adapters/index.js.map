{"version":3,"file":"index.js","sources":["../../src/adapters/index.ts"],"sourcesContent":["import type { HttpAdapter } from '../types'\r\nimport { AlovaAdapter } from './alova'\r\nimport { AxiosAdapter } from './axios'\r\nimport { FetchAdapter } from './fetch'\r\n\r\nexport { AlovaAdapter } from './alova'\r\nexport { AxiosAdapter } from './axios'\r\nexport { BaseAdapter } from './base'\r\nexport { FetchAdapter } from './fetch'\r\n\r\n/**\r\n * 适配器工厂（优化版）\r\n */\r\nexport class AdapterFactory {\r\n  private static adapters = new Map<string, () => HttpAdapter>([\r\n    ['fetch', () => new FetchAdapter()],\r\n    ['axios', () => new AxiosAdapter()],\r\n    ['alova', () => new AlovaAdapter()],\r\n  ])\r\n\r\n  // 缓存已创建的适配器实例\r\n  private static adapterCache = new Map<string, HttpAdapter>()\r\n\r\n  // 缓存可用性检查结果\r\n  private static availabilityCache = new Map<string, boolean>()\r\n\r\n  /**\r\n   * 注册适配器\r\n   */\r\n  static register(name: string, factory: () => HttpAdapter): void {\r\n    this.adapters.set(name, factory)\r\n  }\r\n\r\n  /**\r\n   * 创建适配器（带缓存）\r\n   */\r\n  static create(name: string): HttpAdapter {\r\n    // 检查缓存\r\n    if (this.adapterCache.has(name)) {\r\n      return this.adapterCache.get(name)!\r\n    }\r\n\r\n    const factory = this.adapters.get(name)\r\n    if (!factory) {\r\n      throw new Error(`Unknown adapter: ${name}`)\r\n    }\r\n\r\n    const adapter = factory()\r\n\r\n    // 验证适配器是否可用\r\n    if (!adapter.isSupported()) {\r\n      throw new Error(\r\n        `Adapter '${name}' is not supported in current environment`,\r\n      )\r\n    }\r\n\r\n    // 缓存适配器实例\r\n    this.adapterCache.set(name, adapter)\r\n    return adapter\r\n  }\r\n\r\n  /**\r\n   * 获取可用的适配器（带缓存）\r\n   */\r\n  static getAvailable(): string[] {\r\n    const available: string[] = []\r\n\r\n    this.adapters.forEach((factory, name) => {\r\n      // 检查缓存\r\n      if (this.availabilityCache.has(name)) {\r\n        if (this.availabilityCache.get(name)) {\r\n          available.push(name)\r\n        }\r\n        return\r\n      }\r\n\r\n      try {\r\n        const adapter = factory()\r\n        const isSupported = adapter.isSupported()\r\n\r\n        // 缓存可用性结果\r\n        this.availabilityCache.set(name, isSupported)\r\n\r\n        if (isSupported) {\r\n          available.push(name)\r\n        }\r\n      }\r\n      catch {\r\n        // 缓存不可用结果\r\n        this.availabilityCache.set(name, false)\r\n      }\r\n    })\r\n\r\n    return available\r\n  }\r\n\r\n  /**\r\n   * 获取默认适配器\r\n   */\r\n  static getDefault(): HttpAdapter {\r\n    const available = this.getAvailable()\r\n\r\n    if (available.length === 0) {\r\n      throw new Error('No available HTTP adapter found')\r\n    }\r\n\r\n    // 优先级：fetch > axios > alova\r\n    const priority = ['fetch', 'axios', 'alova']\r\n\r\n    for (const name of priority) {\r\n      if (available.includes(name)) {\r\n        return this.create(name)\r\n      }\r\n    }\r\n\r\n    // 如果没有找到优先的适配器，使用第一个可用的\r\n    return this.create(available[0]!)\r\n  }\r\n\r\n  /**\r\n   * 获取所有注册的适配器名称\r\n   */\r\n  static getRegistered(): string[] {\r\n    return Array.from(this.adapters.keys())\r\n  }\r\n\r\n  /**\r\n   * 清理缓存（用于测试或重置）\r\n   */\r\n  static clearCache(): void {\r\n    this.adapterCache.clear()\r\n    this.availabilityCache.clear()\r\n  }\r\n\r\n  /**\r\n   * 预热适配器（提前检查可用性）\r\n   */\r\n  static warmup(): void {\r\n    this.getAvailable() // 触发可用性检查和缓存\r\n  }\r\n}\r\n\r\n/**\r\n * 创建 HTTP 适配器\r\n */\r\nexport function createAdapter(adapter?: string | HttpAdapter): HttpAdapter {\r\n  if (!adapter) {\r\n    return AdapterFactory.getDefault()\r\n  }\r\n\r\n  if (typeof adapter === 'string') {\r\n    return AdapterFactory.create(adapter)\r\n  }\r\n\r\n  if (\r\n    typeof adapter === 'object'\r\n    && 'request' in adapter\r\n    && 'isSupported' in adapter\r\n  ) {\r\n    return adapter\r\n  }\r\n\r\n  throw new Error('Invalid adapter configuration')\r\n}\r\n\r\n/**\r\n * 检查适配器是否可用\r\n */\r\nexport function isAdapterAvailable(name: string): boolean {\r\n  try {\r\n    const adapter = AdapterFactory.create(name)\r\n    return adapter.isSupported()\r\n  }\r\n  catch {\r\n    return false\r\n  }\r\n}\r\n"],"names":["AdapterFactory","register","name","factory","this","adapters","set","create","adapterCache","has","get","Error","adapter","isSupported","getAvailable","available","forEach","availabilityCache","push","getDefault","length","priority","includes","getRegistered","Array","from","keys","clearCache","clear","warmup","createAdapter","isAdapterAvailable","Map","FetchAdapter","AxiosAdapter","AlovaAdapter","i","o","c","w","n","h","p"],"mappings":"4KAaaA,EAgBX,eAAOC,CAASC,EAAcC,GAC5BC,KAAKC,SAASC,IAAIJ,EAAMC,EAC1B,CAKA,aAAOI,CAAOL,GAEZ,GAAIE,KAAKI,aAAaC,IAAIP,GACxB,OAAOE,KAAKI,aAAaE,IAAIR,GAG/B,MAAMC,EAAUC,KAAKC,SAASK,IAAIR,GAClC,IAAKC,EACH,MAAM,IAAIQ,MAAM,oBAAoBT,KAGtC,MAAMU,EAAUT,IAGhB,IAAKS,EAAQC,cACX,MAAM,IAAIF,MACR,YAAYT,8CAKhB,OAAAE,KAAKI,aAAaF,IAAIJ,EAAMU,GACrBA,CACT,CAKA,mBAAOE,GACL,MAAMC,EAAsB,GAE5B,OAAAX,KAAKC,SAASW,QAAQ,CAACb,EAASD,KAE9B,GAAIE,KAAKa,kBAAkBR,IAAIP,GACzBE,KAAKa,kBAAkBP,IAAIR,IAC7Ba,EAAUG,KAAKhB,QAKnB,IAEE,MAAMW,EADUV,IACYU,cAG5BT,KAAKa,kBAAkBX,IAAIJ,EAAMW,GAE7BA,GACFE,EAAUG,KAAKhB,EAEnB,CAAA,MAGEE,KAAKa,kBAAkBX,IAAIJ,GAAM,EACnC,IAGKa,CACT,CAKA,iBAAOI,GACL,MAAMJ,EAAYX,KAAKU,eAEvB,GAAyB,IAArBC,EAAUK,OACZ,MAAM,IAAIT,MAAM,mCAIlB,MAAMU,EAAW,CAAC,QAAS,QAAS,SAEpC,IAAA,MAAWnB,KAAQmB,EACjB,GAAIN,EAAUO,SAASpB,GACrB,OAAOE,KAAKG,OAAOL,GAKvB,OAAOE,KAAKG,OAAOQ,EAAU,GAC/B,CAKA,oBAAOQ,GACL,OAAOC,MAAMC,KAAKrB,KAAKC,SAASqB,OAClC,CAKA,iBAAOC,GACLvB,KAAKI,aAAaoB,QAClBxB,KAAKa,kBAAkBW,OACzB,CAKA,aAAOC,GACLzB,KAAKU,cACP,WAMcgB,EAAclB,GAC5B,IAAKA,EACH,OAAOZ,EAAemB,aAGxB,GAAuB,iBAAZP,EACT,OAAOZ,EAAeO,OAAOK,GAG/B,GACqB,iBAAZA,GACJ,YAAaA,GACb,gBAAiBA,EAEpB,OAAOA,EAGT,MAAM,IAAID,MAAM,gCAClB,UAKgBoB,EAAmB7B,GACjC,IAEE,OADgBF,EAAeO,OAAOL,GACvBW,aACjB,OAEE,OAAO,CACT,CACF,CAlKiBb,EAAAK,SAAW,IAAI2B,IAA+B,CAC3D,CAAC,QAAS,IAAM,IAAIC,GACpB,CAAC,QAAS,IAAM,IAAIC,GACpB,CAAC,QAAS,IAAM,IAAIC,KAIPnC,EAAAQ,aAAe,IAAIwB,IAGnBhC,EAAAiB,kBAAoB,IAAIe,WAwJzCI,oBAAAC,kBAAAC,kBAAAC,iBAAAC,kBAAAC,mBAAAC"}