import{isFormData as t,isURLSearchParams as e,isBlob as s,isArrayBuffer as a}from"../utils/index.js";import{BaseAdapter as r}from"./base.js";class n extends r{constructor(){super(...arguments),this.name="fetch"}isSupported(){return typeof fetch<"u"&&typeof AbortController<"u"}async request(t){const e=this.processConfig(t);try{const t=this.createTimeoutController(e.timeout),s=this.mergeAbortSignals([e.signal,t.signal]),a={method:e.method,headers:this.buildHeaders(e),signal:s,credentials:e.withCredentials?"include":"same-origin"};e.data&&"GET"!==e.method&&"HEAD"!==e.method&&(a.body=this.buildBody(e.data,e.headers));const r=await fetch(e.url,a);return t.cleanup(),await this.handleResponse(r,e)}catch(t){throw this.processError(t,e)}}buildHeaders(s){const a={...s.headers};return s.data&&!a["content-type"]&&!a["Content-Type"]&&("string"==typeof s.data?a["Content-Type"]="text/plain":t(s.data)?delete a["Content-Type"]:e(s.data)?a["Content-Type"]="application/x-www-form-urlencoded":"object"==typeof s.data&&(a["Content-Type"]="application/json")),a}buildBody(r,n){if(null!=r){if("string"==typeof r||t(r)||s(r)||a(r)||e(r)||r instanceof ReadableStream)return r;if((n?.["content-type"]||n?.["Content-Type"]||"").includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;return Object.keys(r).forEach(e=>{const s=r[e];null!=s&&t.append(e,String(s))}),t}return JSON.stringify(r)}}async handleResponse(t,e){const s=this.parseHeaders(t.headers),a=await this.parseResponseData(t,e.responseType);if(!t.ok)throw this.processError(new Error(`Request failed with status ${t.status}`),e,this.processResponse(a,t.status,t.statusText,s,e,t));return this.processResponse(a,t.status,t.statusText,s,e,t)}async parseResponseData(t,e){if(!t.body)return null;try{switch(e){case"text":return await t.text();case"blob":return await t.blob();case"arrayBuffer":return await t.arrayBuffer();case"stream":return t.body;default:{const e=t.headers.get("content-type")||"";if(e.includes("application/json"))return await t.json();if(e.includes("text/"))return await t.text();{const e=await t.text();try{return JSON.parse(e)}catch{return e}}}}}catch{return null}}}export{n as FetchAdapter};
//# sourceMappingURL=fetch.js.map
