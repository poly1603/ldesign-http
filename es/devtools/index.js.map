{"version":3,"file":"index.js","sources":["../../src/devtools/index.ts"],"sourcesContent":["/**\n * HTTPÂºÄÂèëÂ∑•ÂÖ∑\n *\n * Êèê‰æõËØ∑Ê±ÇÁõëÊéß„ÄÅÊÄßËÉΩÂàÜÊûê„ÄÅË∞ÉËØïÁ≠âÂºÄÂèëÂ∑•ÂÖ∑\n */\n\nimport type { HttpClient, HttpError, RequestConfig, ResponseData } from '../types'\nimport { logger } from '../utils/logger'\n\n// ÊµèËßàÂô®ÂÖºÂÆπÁöÑ process.env ËÆøÈóÆ\nconst isBrowser = typeof window !== 'undefined'\nconst env = isBrowser ? (import.meta.env || {}) : (globalThis.process?.env || {})\n\n/**\n * ËØ∑Ê±ÇËÆ∞ÂΩï\n */\nexport interface RequestRecord {\n  id: string\n  timestamp: number\n  config: RequestConfig\n  duration?: number\n  response?: ResponseData<any>\n  error?: HttpError\n  status: 'pending' | 'success' | 'error' | 'cancelled'\n}\n\n/**\n * ÂºÄÂèëÂ∑•ÂÖ∑ÈÖçÁΩÆ\n */\nexport interface DevToolsConfig {\n  /** ÊòØÂê¶ÂêØÁî® */\n  enabled?: boolean\n  /** ÊúÄÂ§ßËÆ∞ÂΩïÊï∞ */\n  maxRecords?: number\n  /** ÊòØÂê¶ÊòæÁ§∫console */\n  showConsole?: boolean\n  /** ÊòØÂê¶Âú®ÊµèËßàÂô®consoleÊòæÁ§∫ */\n  logToConsole?: boolean\n  /** ÊÄßËÉΩÈòàÂÄº(ms) */\n  performanceThreshold?: number\n}\n\n/**\n * HTTPÂºÄÂèëÂ∑•ÂÖ∑\n *\n * @example\n * ```typescript\n * // ÂàõÂª∫ÂºÄÂèëÂ∑•ÂÖ∑\n * const devtools = new HttpDevTools({\n *   enabled: process.env.NODE_ENV === 'development',\n *   maxRecords: 100\n * })\n *\n * // ÈôÑÂä†Âà∞ÂÆ¢Êà∑Á´Ø\n * devtools.attach(client)\n *\n * // Êü•ÁúãËØ∑Ê±ÇËÆ∞ÂΩï\n * )\n *\n * // Êü•ÁúãÁªüËÆ°\n * )\n *\n * // ÂØºÂá∫Êï∞ÊçÆ\n * devtools.export()\n * ```\n */\nexport class HttpDevTools {\n  private config: Required<DevToolsConfig>\n  private records: RequestRecord[] = []\n  private client: HttpClient | null = null\n  private interceptorIds: { request: number, response: number, error: number } | null = null\n\n  constructor(config: DevToolsConfig = {}) {\n    this.config = {\n      enabled: config.enabled ?? (env.NODE_ENV !== 'production' && env.MODE !== 'production'),\n      maxRecords: config.maxRecords ?? 100,\n      showConsole: config.showConsole ?? true,\n      logToConsole: config.logToConsole ?? true,\n      performanceThreshold: config.performanceThreshold ?? 1000,\n    }\n\n    // Âú®ÊµèËßàÂô®‰∏≠Êö¥Èú≤Âà∞window\n    if (typeof window !== 'undefined' && this.config?.enabled) {\n      ; (window as any).__HTTP_DEVTOOLS__ = this\n    }\n  }\n\n  /**\n   * ÈôÑÂä†Âà∞HTTPÂÆ¢Êà∑Á´Ø\n   */\n  attach(client: HttpClient): void {\n    if (!this.config?.enabled || this.client) {\n      return\n    }\n\n    this.client = client\n\n    // Ê∑ªÂä†Êã¶Êà™Âô®\n    const requestId = client.addRequestInterceptor((config: RequestConfig) => {\n      this.onRequestStart(config)\n      return config\n    })\n\n    const responseId = client.addResponseInterceptor((response: ResponseData<any>) => {\n      this.onRequestSuccess(response)\n      return response\n    }, (error: HttpError) => {\n      this.onRequestError(error)\n      throw error\n    })\n\n    this.interceptorIds = {\n      request: requestId,\n      response: responseId,\n      error: -1,\n    }\n\n    if (this.config?.logToConsole) {\n      logger.info('DevTools attached to HTTP client')\n    }\n  }\n\n  /**\n   * ÂàÜÁ¶ª\n   */\n  detach(): void {\n    if (!this.client || !this.interceptorIds) {\n      return\n    }\n\n    this.client.removeRequestInterceptor(this.interceptorIds.request)\n    this.client.removeResponseInterceptor(this.interceptorIds.response)\n\n    this.client = null\n    this.interceptorIds = null\n\n    if (this.config?.logToConsole) {\n      logger.info('DevTools detached from HTTP client')\n    }\n  }\n\n  /**\n   * ËØ∑Ê±ÇÂºÄÂßã\n   */\n  private onRequestStart(config: RequestConfig): void {\n    const id = this.generateId()\n    const record: RequestRecord = {\n      id,\n      timestamp: Date.now(),\n      config,\n      status: 'pending',\n    }\n\n      // ‰øùÂ≠òÂà∞ÈÖçÁΩÆ‰∏≠,Áî®‰∫éÂêéÁª≠ÂåπÈÖç\n      ; (config as any).__devtools_id__ = id\n\n    this.addRecord(record)\n\n    if (this.config?.logToConsole) {\n      logger.group(`‚û°Ô∏è ${config.method?.toUpperCase()} ${config.url}`)\n      logger.debug('Config:', config)\n      logger.groupEnd()\n    }\n  }\n\n  /**\n   * ËØ∑Ê±ÇÊàêÂäü\n   */\n  private onRequestSuccess(response: ResponseData<any>): void {\n    const id = (response.config as any).__devtools_id__\n    if (!id) return\n\n    const record = this.findRecord(id)\n    if (!record) return\n\n    record.duration = Date.now() - record.timestamp\n    record.response = response\n    record.status = 'success'\n\n    if (this.config?.logToConsole) {\n      const isSlow = record.duration > this.config?.performanceThreshold\n      const emoji = isSlow ? 'üêå' : '‚úÖ'\n\n      logger.group(\n        `${emoji} ${response.config.method?.toUpperCase()} ${response.config.url} (${record.duration}ms)`,\n      )\n      logger.debug('Status:', response.status)\n      logger.debug('Data:', response.data)\n      if (isSlow) {\n        logger.warn(`ÊÖ¢ËØ∑Ê±ÇË≠¶Âëä: ËÄóÊó∂ ${record.duration}ms`)\n      }\n      logger.groupEnd()\n    }\n  }\n\n  /**\n   * ËØ∑Ê±ÇÂ§±Ë¥•\n   */\n  private onRequestError(error: HttpError): void {\n    const id = (error.config as any).__devtools_id__\n    if (!id) return\n\n    const record = this.findRecord(id)\n    if (!record) return\n\n    record.duration = Date.now() - record.timestamp\n    record.error = error\n    record.status = 'error'\n\n    if (this.config?.logToConsole) {\n      logger.group(\n        `‚ùå ${error.config?.method?.toUpperCase()} ${error.config?.url} (${record.duration}ms)`,\n      )\n      logger.error('Error:', error.message)\n      logger.error('Details:', error)\n      logger.groupEnd()\n    }\n  }\n\n  /**\n   * Ê∑ªÂä†ËÆ∞ÂΩï\n   */\n  private addRecord(record: RequestRecord): void {\n    this.records.unshift(record)\n\n    // ÈôêÂà∂ËÆ∞ÂΩïÊï∞Èáè\n    if (this.records.length > this.config?.maxRecords) {\n      this.records = this.records.slice(0, this.config?.maxRecords)\n    }\n  }\n\n  /**\n   * Êü•ÊâæËÆ∞ÂΩï\n   */\n  private findRecord(id: string): RequestRecord | undefined {\n    return this.records.find(r => r.id === id)\n  }\n\n  /**\n   * ÁîüÊàêID\n   */\n  private generateId(): string {\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n  }\n\n  /**\n   * Ëé∑ÂèñÊâÄÊúâËÆ∞ÂΩï\n   */\n  getRecords(): RequestRecord[] {\n    return [...this.records]\n  }\n\n  /**\n   * Ëé∑ÂèñÂ§±Ë¥•ÁöÑËØ∑Ê±Ç\n   */\n  getFailedRequests(): RequestRecord[] {\n    return this.records.filter(r => r.status === 'error')\n  }\n\n  /**\n   * Ëé∑ÂèñÊÖ¢ËØ∑Ê±Ç\n   */\n  getSlowRequests(): RequestRecord[] {\n    return this.records.filter(\n      r => r.duration && r.duration > this.config?.performanceThreshold,\n    )\n  }\n\n  /**\n   * Ëé∑ÂèñÁªüËÆ°‰ø°ÊÅØ\n   */\n  getStats() {\n    const stats = {\n      total: this.records.length,\n      pending: 0,\n      success: 0,\n      error: 0,\n      cancelled: 0,\n      averageDuration: 0,\n      slowRequests: 0,\n    }\n\n    let totalDuration = 0\n    let completedCount = 0\n\n    this.records.forEach((record) => {\n      stats[record.status]++\n\n      if (record.duration) {\n        totalDuration += record.duration\n        completedCount++\n\n        if (record.duration > this.config?.performanceThreshold) {\n          stats.slowRequests++\n        }\n      }\n    })\n\n    if (completedCount > 0) {\n      stats.averageDuration = Math.round(totalDuration / completedCount)\n    }\n\n    return stats\n  }\n\n  /**\n   * Ê∏ÖÈô§ÊâÄÊúâËÆ∞ÂΩï\n   */\n  clear(): void {\n    this.records = []\n    if (this.config?.logToConsole) {\n      logger.info('DevTools records cleared')\n    }\n  }\n\n  /**\n   * ÂØºÂá∫Êï∞ÊçÆ‰∏∫JSON\n   */\n  export(): string {\n    const data = {\n      records: this.records,\n      stats: this.getStats(),\n      exportedAt: new Date().toISOString(),\n    }\n    return JSON.stringify(data, null, 2)\n  }\n\n  /**\n   * ‰∏ãËΩΩÂØºÂá∫Êñá‰ª∂\n   */\n  download(): void {\n    if (typeof window === 'undefined') {\n      logger.warn('Download is only available in browser')\n      return\n    }\n\n    const json = this.export()\n    const blob = new Blob([json], { type: 'application/json' })\n    const url = URL.createObjectURL(blob)\n    const a = document.createElement('a')\n    a.href = url\n    a.download = `http-devtools-${Date.now()}.json`\n    a.click()\n    URL.revokeObjectURL(url)\n\n    logger.info('DevTools data exported')\n  }\n\n  /**\n   * Âú®ÊµèËßàÂô®consoleÊâìÂç∞ÁªüËÆ°\n   */\n  printStats(): void {\n    const stats = this.getStats()\n\n    // ‰ΩøÁî® console.group/groupEnd ÊòØÂÖÅËÆ∏ÁöÑÔºàË∞ÉËØïÂ∑•ÂÖ∑ÁâπÊÄßÔºâ\n    console.group('HTTP DevTools Statistics')\n    console.info(`Total Requests: ${stats.total}`)\n    console.info(`Pending: ${stats.pending}`)\n    console.info(`Success: ${stats.success}`)\n    console.info(`Error: ${stats.error}`)\n    console.info(`Cancelled: ${stats.cancelled}`)\n    console.info(`Average Duration: ${stats.averageDuration}ms`)\n    console.info(`Slow Requests: ${stats.slowRequests}`)\n    console.groupEnd()\n  }\n}\n\n/**\n * ÂàõÂª∫ÂºÄÂèëÂ∑•ÂÖ∑\n */\nexport function createDevTools(config?: DevToolsConfig): HttpDevTools {\n  return new HttpDevTools(config)\n}\n\n/**\n * ÂÖ®Â±ÄÂºÄÂèëÂ∑•ÂÖ∑ÂÆû‰æã\n */\nexport const globalDevTools = new HttpDevTools()\n\n/**\n * Âú®ÊµèËßàÂô®console‰∏≠ÂèØÁî®ÁöÑÂø´Êç∑ÂëΩ‰ª§\n */\nif (typeof window !== 'undefined') {\n  ; (window as any).httpDevTools = {\n    getRecords: () => globalDevTools.getRecords(),\n    getStats: () => globalDevTools.getStats(),\n    printStats: () => globalDevTools.printStats(),\n    clear: () => globalDevTools.clear(),\n    export: () => globalDevTools.download(),\n  }\n}\n"],"names":["env","window","globalThis","process","HttpDevTools","constructor","config","this","records","client","interceptorIds","enabled","NODE_ENV","MODE","maxRecords","showConsole","logToConsole","performanceThreshold","__HTTP_DEVTOOLS__","attach","requestId","addRequestInterceptor","onRequestStart","responseId","addResponseInterceptor","response","onRequestSuccess","error","onRequestError","request","logger","info","detach","removeRequestInterceptor","removeResponseInterceptor","id","generateId","record","timestamp","Date","now","status","__devtools_id__","addRecord","group","method","toUpperCase","url","debug","groupEnd","findRecord","duration","isSlow","emoji","data","warn","message","unshift","length","slice","find","r","Math","random","toString","substr","getRecords","getFailedRequests","filter","getSlowRequests","getStats","stats","total","pending","success","cancelled","averageDuration","slowRequests","totalDuration","completedCount","forEach","round","clear","exportedAt","toISOString","JSON","stringify","download","json","export","blob","Blob","type","URL","createObjectURL","a","document","createElement","href","click","revokeObjectURL","printStats","createDevTools","globalDevTools","httpDevTools"],"mappings":"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"}