import{logger as e}from"../utils/logger.js";const t=typeof window<"u"?import.meta.env||{}:globalThis.process?.env||{};class o{constructor(e={}){this.records=[],this.client=null,this.interceptorIds=null,this.config={enabled:e.enabled??("production"!==t.NODE_ENV&&"production"!==t.MODE),maxRecords:e.maxRecords??100,showConsole:e.showConsole??!0,logToConsole:e.logToConsole??!0,performanceThreshold:e.performanceThreshold??1e3},typeof window<"u"&&this.config?.enabled&&(window.__HTTP_DEVTOOLS__=this)}attach(t){if(!this.config?.enabled||this.client)return;this.client=t;const o=t.addRequestInterceptor(e=>(this.onRequestStart(e),e)),s=t.addResponseInterceptor(e=>(this.onRequestSuccess(e),e),e=>{throw this.onRequestError(e),e});this.interceptorIds={request:o,response:s,error:-1},this.config?.logToConsole&&e.info("DevTools attached to HTTP client")}detach(){!this.client||!this.interceptorIds||(this.client.removeRequestInterceptor(this.interceptorIds.request),this.client.removeResponseInterceptor(this.interceptorIds.response),this.client=null,this.interceptorIds=null,this.config?.logToConsole&&e.info("DevTools detached from HTTP client"))}onRequestStart(t){const o=this.generateId(),s={id:o,timestamp:Date.now(),config:t,status:"pending"};t.__devtools_id__=o,this.addRecord(s),this.config?.logToConsole&&(e.group(`âž¡ï¸ ${t.method?.toUpperCase()} ${t.url}`),e.debug("Config:",t),e.groupEnd())}onRequestSuccess(t){const o=t.config.__devtools_id__;if(!o)return;const s=this.findRecord(o);if(s&&(s.duration=Date.now()-s.timestamp,s.response=t,s.status="success",this.config?.logToConsole)){const o=s.duration>this.config?.performanceThreshold,r=o?"ðŸŒ":"âœ…";e.group(`${r} ${t.config.method?.toUpperCase()} ${t.config.url} (${s.duration}ms)`),e.debug("Status:",t.status),e.debug("Data:",t.data),o&&e.warn(`æ…¢è¯·æ±‚è­¦å‘Š: è€—æ—¶ ${s.duration}ms`),e.groupEnd()}}onRequestError(t){const o=t.config.__devtools_id__;if(!o)return;const s=this.findRecord(o);s&&(s.duration=Date.now()-s.timestamp,s.error=t,s.status="error",this.config?.logToConsole&&(e.group(`âŒ ${t.config?.method?.toUpperCase()} ${t.config?.url} (${s.duration}ms)`),e.error("Error:",t.message),e.error("Details:",t),e.groupEnd()))}addRecord(e){this.records.unshift(e),this.records.length>this.config?.maxRecords&&(this.records=this.records.slice(0,this.config?.maxRecords))}findRecord(e){return this.records.find(t=>t.id===e)}generateId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getRecords(){return[...this.records]}getFailedRequests(){return this.records.filter(e=>"error"===e.status)}getSlowRequests(){return this.records.filter(e=>e.duration&&e.duration>this.config?.performanceThreshold)}getStats(){const e={total:this.records.length,pending:0,success:0,error:0,cancelled:0,averageDuration:0,slowRequests:0};let t=0,o=0;return this.records.forEach(s=>{e[s.status]++,s.duration&&(t+=s.duration,o++,s.duration>this.config?.performanceThreshold&&e.slowRequests++)}),o>0&&(e.averageDuration=Math.round(t/o)),e}clear(){this.records=[],this.config?.logToConsole&&e.info("DevTools records cleared")}export(){const e={records:this.records,stats:this.getStats(),exportedAt:(new Date).toISOString()};return JSON.stringify(e,null,2)}download(){if(typeof window>"u")return void e.warn("Download is only available in browser");const t=this.export(),o=new Blob([t],{type:"application/json"}),s=URL.createObjectURL(o),r=document.createElement("a");r.href=s,r.download=`http-devtools-${Date.now()}.json`,r.click(),URL.revokeObjectURL(s),e.info("DevTools data exported")}printStats(){this.getStats()}}function s(e){return new o(e)}const r=new o;typeof window<"u"&&(window.httpDevTools={getRecords:()=>r.getRecords(),getStats:()=>r.getStats(),printStats:()=>r.printStats(),clear:()=>r.clear(),export:()=>r.download()});export{o as HttpDevTools,s as createDevTools,r as globalDevTools};
//# sourceMappingURL=index.js.map
